"use strict";(self.webpackChunkfed_doc=self.webpackChunkfed_doc||[]).push([[788],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return k}});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=r.createContext({}),c=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},d=function(e){var n=c(e.components);return r.createElement(p.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,l=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),m=c(t),k=o,u=m["".concat(p,".").concat(k)]||m[k]||s[k]||l;return t?r.createElement(u,a(a({ref:n},d),{},{components:t})):r.createElement(u,a({ref:n},d))}));function k(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var l=t.length,a=new Array(l);a[0]=m;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var c=2;c<l;c++)a[c]=t[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},28393:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return p},default:function(){return k},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return s}});var r=t(87462),o=t(63366),l=(t(67294),t(3905)),a=["components"],i={},p=void 0,c={unversionedId:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/Docker",id:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/Docker",title:"Docker",description:"Docker",source:"@site/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/2-Docker.md",sourceDirName:"19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316",slug:"/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/Docker",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/Docker",editUrl:"https://github.com/Guing/FED-DOC/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/2-Docker.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"GitHub actions",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/GitHub actions"},next:{title:"\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883"}},d={},s=[{value:"Docker",id:"docker",level:2},{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",level:3},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:3},{value:"\u5e38\u7528\u547d\u4ee4",id:"\u5e38\u7528\u547d\u4ee4",level:3},{value:"image\u955c\u50cf",id:"image\u955c\u50cf",level:3},{value:"container",id:"container",level:3},{value:"\u529f\u80fd\u6f14\u793a",id:"\u529f\u80fd\u6f14\u793a",level:3},{value:"Dockerfile",id:"dockerfile",level:2},{value:"\u6784\u5efa",id:"\u6784\u5efa",level:3},{value:"\u4ee3\u7801\u6f14\u793a",id:"\u4ee3\u7801\u6f14\u793a",level:3},{value:"Docker-compose",id:"docker-compose",level:2},{value:"\u914d\u7f6e\u6587\u4ef6",id:"\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u5bb9\u5668\u4e4b\u95f4\u7aef\u53e3\u7684\u95ee\u9898",id:"\u5bb9\u5668\u4e4b\u95f4\u7aef\u53e3\u7684\u95ee\u9898",level:3},{value:"\u547d\u4ee4",id:"\u547d\u4ee4",level:3},{value:"\u94fe\u63a5Mysql\u548cMongodb",id:"\u94fe\u63a5mysql\u548cmongodb",level:2},{value:"\u533a\u522b",id:"\u533a\u522b",level:3},{value:"\u4ee3\u7801\u4fee\u6539",id:"\u4ee3\u7801\u4fee\u6539",level:3},{value:"\u6f14\u793a",id:"\u6f14\u793a",level:3}],m={toc:s};function k(e){var n=e.components,i=(0,o.Z)(e,a);return(0,l.kt)("wrapper",(0,r.Z)({},m,i,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"docker"},"Docker"),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(96370).Z,width:"660",height:"330"})),(0,l.kt)("h3",{id:"\u4ecb\u7ecd"},"\u4ecb\u7ecd"),(0,l.kt)("p",null,"Docker\u5c31\u662f\u4e00\u79cd\u865a\u62df\u673a\u6280\u672f\uff0c\u6bd4\u4f20\u7edf\u865a\u62df\u673a(\u5982vmware,virtualbox)\u8981\u66f4\u52a0\u7b80\u5355\uff0c\u8f7b\u91cf"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u542f\u52a8\u5feb"),(0,l.kt)("li",{parentName:"ul"},"\u8d44\u6e90\u5360\u7528\u5c11"),(0,l.kt)("li",{parentName:"ul"},"\u4f53\u79ef\u5c0f")),(0,l.kt)("h3",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docs.docker.com/get-docker/"},"\u6587\u6863")),(0,l.kt)("p",null,"\u5b89\u88c5\u5b8c\u8bb0\u5f97\u955c\u50cf\u52a0\u901f"),(0,l.kt)("p",null,"\u5b89\u88c5\u5b8c\uff0c\u8fd0\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"docker version"),"\u53ef\u67e5\u770b\u7248\u672c"),(0,l.kt)("h3",{id:"\u57fa\u672c\u6982\u5ff5"},"\u57fa\u672c\u6982\u5ff5"),(0,l.kt)("p",null,"\u4f7f\u7528vmware\u3001virtualbox\u65f6\uff0c\u6b65\u9aa4\u5982\u4e0b"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e0b\u8f7d\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"li"},"centos.iso"),"\u6587\u4ef6"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528vmwaire\u5b89\u88c5\u4e00\u4e2a\u7cfb\u7edfA"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528vmwaire\u5b89\u88c5\u4e00\u4e2a\u7cfb\u7edfB"),(0,l.kt)("li",{parentName:"ul"},"......")),(0,l.kt)("p",null,"\u6b64\u5904\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"centos.iso"),"\u6587\u4ef6\u5c31\u662f\u4e00\u4e2aimage\u955c\u50cf\uff0c\u5b89\u88c5\u51fa\u6765\u7684\u7cfb\u7edf\u5c31\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684container\u5bb9\u5668\u3002"),(0,l.kt)("p",null,"docker\u7684\u6240\u6709image\u90fd\u53ef\u4ee5\u5728",(0,l.kt)("a",{parentName:"p",href:"https://hub.docker.com/%E6%90%9C%E7%B4%A2%E5%B9%B6%E4%B8%8B%E8%BD%BD%EF%BC%8C%E8%BF%98%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E4%B9%89image%E4%B8%8A%E4%BC%A0%E5%88%B0%E8%BF%99%E4%B8%AA%E4%BB%93%E5%BA%93"},"https://hub.docker.com/\u641c\u7d22\u5e76\u4e0b\u8f7d\uff0c\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49image\u4e0a\u4f20\u5230\u8fd9\u4e2a\u4ed3\u5e93")),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(2034).Z,width:"1532",height:"818"})),(0,l.kt)("h3",{id:"\u5e38\u7528\u547d\u4ee4"},"\u5e38\u7528\u547d\u4ee4"),(0,l.kt)("p",null,"\u5982\u679c\u6ca1\u6709\u5b89\u88c5\uff0c\u53ef\u4ee5\u5728",(0,l.kt)("a",{parentName:"p",href:"https://labs.play-with-docker.com/"},"play with docker"),"\u4f53\u9a8c\u4e00\u4e0b\u3002"),(0,l.kt)("h3",{id:"image\u955c\u50cf"},"image\u955c\u50cf"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e0b\u8f7d\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker pull <image-name>:<tag>")),(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u6240\u6709\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker images")),(0,l.kt)("li",{parentName:"ul"},"\u5220\u9664\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker rmi <image-id>")),(0,l.kt)("li",{parentName:"ul"},"\u4e0a\u4f20\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker push <username>/<respository>:<tag>"),",\u8981\u5148\u6ce8\u518c",(0,l.kt)("a",{parentName:"li",href:"https://hub.docker.com/"},"https://hub.docker.com/"))),(0,l.kt)("p",null,"\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"docker images"),"\u51fa\u73b0REPOSITORY\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"<none>"),"\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u8fd0\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"docker image prune"),"\u5220\u9664\u3002"),(0,l.kt)("h3",{id:"container"},"container"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u542f\u52a8\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"docker run -p xxxx:xxxx -v=hostPath:containerPath -d --name <container-name><image-name>")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"-p\u7aef\u53e3\u6620\u5c04"),(0,l.kt)("li",{parentName:"ul"},"-v\u6570\u636e\u5377\uff0c\u6587\u4ef6\u6620\u5c04"),(0,l.kt)("li",{parentName:"ul"},"-d\u540e\u53f0\u8fd0\u884c"),(0,l.kt)("li",{parentName:"ul"},"--name\u5b9a\u4e49\u5bb9\u5668\u540d\u79f0"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u770b\u6240\u6709\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"docker ps"),"\uff0c\u52a0",(0,l.kt)("inlineCode",{parentName:"p"},"-a"),"\u663e\u793a\u9690\u85cf\u7684\u5bb9\u5668")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u505c\u6b62\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"docker stop <container-id>"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5220\u9664\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"docker rm <container-id>"),"\uff0c\u52a0",(0,l.kt)("inlineCode",{parentName:"p"},"-f"),"\u662f\u5f3a\u5236\u5220\u9664")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u770b\u5bb9\u5668\u4fe1\u606f\uff0c\u5982IP\u5730\u5740",(0,l.kt)("inlineCode",{parentName:"p"},"docker inspect <container-id>"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u770b\u5bb9\u5668\u65e5\u5fd7",(0,l.kt)("inlineCode",{parentName:"p"},"docker logs <container-id>"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8fdb\u5165\u5bb9\u5668\u63a7\u5236\u53f0",(0,l.kt)("inlineCode",{parentName:"p"},"docker exec -it <container-id> /bin/sh")))),(0,l.kt)("h3",{id:"\u529f\u80fd\u6f14\u793a"},"\u529f\u80fd\u6f14\u793a"),(0,l.kt)("p",null,"\u4ee5nginx\u4e3a\u4f8b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker run -p 81:80 -d --name nginx1 nginx\ndocker ps\n\n# \u8bbf\u95ee localhost:81 \uff0c\u5e76\u67e5\u770b log\n\ndocker exec -it <container-id> /bin/sh\ncd /usr/share/nginx/html\necho hello docker world index.html\nexit\n\n# \u91cd\u65b0\u8bbf\u95ee localhost:81 \uff0c\u5f3a\u5236\u5237\u65b0\n\ndocker stop <container-id>\ndocker rm <container-id>\n\n")),(0,l.kt)("p",null,"\u5355\u72ec\u6f14\u793a\u4e00\u4e0b",(0,l.kt)("inlineCode",{parentName:"p"},"-v"),"\u6570\u636e\u5377\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"# 1. \u65b0\u5efa /Users/wfp/html/index.html \uff0c\u5185\u5bb9\u81ea\u5b9a\u4e49\u5373\u53ef\n\n# 2. \u8fd0\u884c\ndocker run -p 81:80 -v=/Users/wfp/html:/usr/share/nginx/html  -d --name nginx1 nginx\n\n# 3. \u8bbf\u95ee \u91cd\u65b0\u8bbf\u95ee localhost:81 \uff0c\u770b\u662f\u5426\u4f60\u521b\u5efa\u7684\u9875\u9762\uff1f\n\n")),(0,l.kt)("h2",{id:"dockerfile"},"Dockerfile"),(0,l.kt)("p",null,"\u4e00\u4e2a\u7b80\u5355\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u63cf\u8ff0\u5982\u4f55\u6784\u5efa\u4e00\u4e2a\u65b0\u7684image\u955c\u50cf"),(0,l.kt)("p",null,"\u6ce8\u610f:\u5fc5\u987b\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"Dockerfile"),"\u8fd9\u4e2a\u6587\u4ef6\u540d\uff0c\u5fc5\u987b\u5728\u9879\u76ee\u7684\u6839\u76ee\u5f55"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"# node\u73af\u5883\nFROM node:14\nWORKDIR /app  #\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55\nCOPY . /app  #\u62f7\u8d1d\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u5230\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55\uff0c\u5982\u679c\u60f3\u5ffd\u7565\u4e00\u4e9b\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7.dockerignore\u6587\u4ef6\u8bbe\u7f6e\n\n# \u6784\u5efa\u955c\u50cf\u65f6\uff0c\u4e00\u822c\u7528\u4e8e\u505a\u4e00\u4e9b\u7cfb\u7edf\u914d\u7f6e\uff0c\u5b89\u88c5\u5fc5\u5907\u7684\u8f6f\u4ef6\u3002\u53ef\u6709\u591a\u4e2a RUN\nRUN xxx\nRUN xxx\nRUN xxx\n\n# \u542f\u52a8\u5bb9\u5668\u65f6\uff0c\u53ea\u80fd\u6709\u4e00\u4e2a CMD\nCMD xxx\n\n# \u73af\u5883\u53d8\u91cf\nENV K1=v1\nENV K2=v2\n\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"RUN"),"\u4e0e",(0,l.kt)("inlineCode",{parentName:"p"},"CMD"),"\u7684\u533a\u522b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"- `RUN`\u4e00\u822c\u7528\u5728\u6784\u5efa\u955c\u50cf\u7684\u65f6\u5019\uff0c`CMD`\u662f\u4f7f\u7528\u5728\u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\n- \u6784\u5efa\u955c\u50cf\u4e00\u822c\u53ea\u6709\u4e00\u6b21\uff0c\u800c\u542f\u52a8\u5bb9\u5668\u53ef\u4ee5\u6709\u591a\u6b21\u3002\u6240\u4ee5\u8981\u533a\u5206\u51fa\u6765\uff0c\u6784\u5efa\u955c\u50cf\u7684\u914d\u7f6e\u548c\u5b89\u88c5\u8f6f\u4ef6\u653e\u5728`RUN`\u4e2d\uff0c\u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5feb\u5f88\u591a\u3002\n")),(0,l.kt)("h3",{id:"\u6784\u5efa"},"\u6784\u5efa"),(0,l.kt)("p",null,"\u6587\u4ef6\u6839\u76ee\u5f55\u6267\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker build -t <name> . # \u6700\u540e\u7684 `.` \u6307 Dockerfile \u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u3002\ndocker images\n")),(0,l.kt)("h3",{id:"\u4ee3\u7801\u6f14\u793a"},"\u4ee3\u7801\u6f14\u793a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},".dockerignore\u6587\u4ef6\u5ffd\u7565")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},".git\nnode_modules\nlogs\n.docker-volumes\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Dockerfile\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'# Dockerfile\nFROM node:14\nWORKDIR /app\nCOPY . /app\n\n# \u8bbe\u7f6e\u65f6\u533a\nRUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo \'Asia/Shanghai\' >/etc/timezone\n\n# \u5b89\u88c5\nRUN npm set registry https://registry.npm.taobao.org\nRUN npm install\nRUN npm install pm2 -g\n\n# \u542f\u52a8\nCMD echo $SERVER_NAME && echo $AUTHOR_NAME &&npm run server && npx pm2 log #\u4e00\u5b9a\u8981\u662f\u963b\u585e\u63a7\u5236\u53f0\u7684\u7a0b\u5e8f\uff0c\u4f7f\u7528npx pm2 log\u963b\u585e\u540e\u53f0\u7a0b\u5e8f\uff0c\u4e0d\u7136\u7a0b\u5e8f\u5c31\u4f1a\u9000\u51fa\n\n# \u73af\u5883\u53d8\u91cf\nENV SERVER_NAME="tanchidemao"\nENV AUTHOR_NAME="roy"\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u672c\u5730\u5b89\u88c5pm2 ",(0,l.kt)("inlineCode",{parentName:"li"},"npm i pm2 --save-dev"),"\uff0c\u6216\u8005Dockerfile\u4e2d\u5168\u5c40\u5b89\u88c5pm2")),(0,l.kt)("p",null,"\u6d4b\u8bd5\u8fc7\u7a0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker build -t editor-server .  # \u6784\u5efa image\ndocker images\n\ndocker run -p 8081:3000 -d --name server1 editor-server  # \u521b\u5efa\u5bb9\u5668\uff0c\u6ce8\u610f\u7aef\u53e3\u6620\u5c04\ndocker ps\ndocker logs <container-id>  # \u9700\u7b49\u5f85\u6784\u5efa\u5b8c\u6210\n\n# \u8bbf\u95ee localhost:8081 \uff0c\u67e5\u770b docker logs\n\ndocker stop <container-id>\ndocker rm <container-id>\ndocker rmi <image-id>\n\n")),(0,l.kt)("h2",{id:"docker-compose"},"Docker-compose"),(0,l.kt)("p",null,"\u8f6f\u4ef6\u8bbe\u8ba1\u548c\u5f00\u53d1\uff0c\u6709\u5355\u4e00\u804c\u8d23\u539f\u5219\u3002Docker\u4e5f\u4e00\u6837\uff0c\u6bcf\u4e2a\u5bb9\u5668\u90fd\u53ea\u8d1f\u8d23\u4e00\u4e2a\u670d\u52a1\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u5f00\u53d1\u73af\u5883\u9700\u8981\u591a\u4e2a\u670d\u52a1(nodejs mysql mongodb redis),\u5c31\u9700\u8981\u542f\u52a8\u591a\u4e2aDocker\u5bb9\u5668\u3002"),(0,l.kt)("p",null,"\u8981\u8fde\u540c\u8fd9\u591a\u4e2aDocker\u5bb9\u5668\uff0c\u5c31\u9700\u8981Docker-compose\u3002"),(0,l.kt)("h3",{id:"\u914d\u7f6e\u6587\u4ef6"},"\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("p",null,"\u65b0\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),"\u6587\u4ef6\u3002\u5148\u4ee5redis\u4e3a\u4f8b\uff0c\u6f14\u793a\u591a\u4e2a\u5bb9\u5668\u5982\u4f55\u5173\u8054\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"version: '3'\nservices:\n    editor-server:  # service name\n        build:\n            context: .  # \u5f53\u524d\u76ee\u5f55\n            dockerfile: Dockerfile  # \u57fa\u4e8e Dockerfile \u6784\u5efa\n        image: editor-server # \u4f9d\u8d56\u4e8e\u5f53\u524d Dockerfile \u521b\u5efa\u51fa\u6765\u7684\u955c\u50cf\n        container_name: editor-server\n        ports:\n            - 8081:3000 # \u5bbf\u4e3b\u673a\u901a\u8fc7 8081 \u8bbf\u95ee\n    editor-redis:  # service name\uff0c\u91cd\u8981\uff01\n        image: redis  # \u5f15\u7528\u5b98\u7f51 redis \u955c\u50cf\n        container_name: editor-redis\n        ports:\n            # \u5bbf\u4e3b\u673a\uff0c\u53ef\u4ee5\u7528 127.0.0.1:6378 \u5373\u53ef\u8fde\u63a5\u5bb9\u5668\u4e2d\u7684\u6570\u636e\u5e93 `redis-cli -h 127.0.0.1 -p 6378`\n            # \u4f46\u662f\uff0c\u5176\u4ed6 docker \u5bb9\u5668\u4e0d\u80fd\uff0c\u56e0\u4e3a\u6b64\u65f6 127.0.0.1 \u662f docker \u5bb9\u5668\u672c\u8eab\uff0c\u800c\u4e0d\u662f\u5bbf\u4e3b\u673a\n            - 6378:6379\n        environment:\n            - TZ=Asia/Shanghai # \u8bbe\u7f6e\u65f6\u533a\n\n")),(0,l.kt)("h3",{id:"\u5bb9\u5668\u4e4b\u95f4\u7aef\u53e3\u7684\u95ee\u9898"},"\u5bb9\u5668\u4e4b\u95f4\u7aef\u53e3\u7684\u95ee\u9898"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"image-20220421170553860",src:t(17442).Z,width:"1171",height:"589"})),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5982\u679c\u542f\u52a8\u591a\u4e2a\u5bb9\u5668\uff0c\u800c\u4e14\u5b83\u4eec\u4e4b\u95f4\u9700\u8981\u76f8\u4e92\u8fde\u63a5\u3002\u5219\u56e0\u4e3a\u6bcf\u4e2a\u5bb9\u5668\u90fd\u662f\u72ec\u7acb\u7684\u865a\u62df\u673a\uff0c\u65e0\u6cd5\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"127.0.0.1:<\u7aef\u53e3>"),"\u8fde\u63a5\u5230\u5176\u4ed6\u5bb9\u5668\u3002")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u89e3\u51b3\uff1a\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\uff0c\u5c06",(0,l.kt)("inlineCode",{parentName:"p"},"127.0.0.1:<\u7aef\u53e3>"),"\u6539\u6210",(0,l.kt)("inlineCode",{parentName:"p"},"<\u5bb9\u5668\u7684\u540d\u79f0>:<\u5bb9\u5668\u7684\u7aef\u53e3>"),"\uff0c\u5982\u4ee5\u4e0a\uff0c\u8fde\u63a5redis\u670d\u52a1\uff0c\u53ef\u4ee5\u6539\u6210",(0,l.kt)("inlineCode",{parentName:"p"},"editor-redis:6379"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff0c\u662f\u6539\u6210\u5bb9\u5668\u7684\u7aef\u53e36379\uff0c\u800c\u4e0d\u662f\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684\u7aef\u53e36378\u3002\u56e0\u4e3a\u53ef\u4ee5\u76f4\u63a5\u8fde\u63a5\u5230\u5bb9\u5668\u7684\u7aef\u53e3\uff0c\u4e0d\u9700\u8981\u5728\u901a\u8fc7\u5bbf\u4e3b\u673a\u4e86\u3002")))),(0,l.kt)("h3",{id:"\u547d\u4ee4"},"\u547d\u4ee4"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6784\u5efa\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose build <service-name>")),(0,l.kt)("li",{parentName:"ul"},"\u542f\u52a8\u6240\u6709\u670d\u52a1\u5668",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose up -d"),"\uff0c\u540e\u53f0\u542f\u52a8"),(0,l.kt)("li",{parentName:"ul"},"\u505c\u6b62\u6240\u6709\u670d\u52a1",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose down")),(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u670d\u52a1",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose ps")," \uff0c\u5217\u51fadocker-compose.yml\u6587\u4ef6\u7684\u5bb9\u5668\uff0c\u800c\u4e0d\u662f\u5168\u90e8\u7684\u3002\u800cdocker ps\u662f\u5168\u90e8\u7684\u5bb9\u5668")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker-compose build editor-server # \u914d\u7f6e\u6587\u4ef6\u7684 service name\ndocker-compose up -d\ndocker-compose ps\n\n# \u8bbf\u95ee localhost:8081 \uff0c\u67e5\u770b docker logs\n\ndocker-compose down\n\n")),(0,l.kt)("h2",{id:"\u94fe\u63a5mysql\u548cmongodb"},"\u94fe\u63a5Mysql\u548cMongodb"),(0,l.kt)("p",null,"\u6210\u529f\u8fde\u63a5redis\u4e4b\u540e\uff0c\u8981\u7ee7\u7eed\u8fde\u63a5mysql\u548cmongodb"),(0,l.kt)("h3",{id:"\u533a\u522b"},"\u533a\u522b"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"redis\u65e0\u6570\u636e\u770b\uff0c\u800cmysql\u548cmongodb\u9700\u8981\u521b\u5efa\u6570\u636e\u5e93"),(0,l.kt)("li",{parentName:"ul"},"redis\u662f\u7f13\u5b58\uff0c\u65e0\u5e8f\u6570\u636e\u6301\u4e45\u5316\uff0c\u800cmysql\u548cmongodb\u9700\u8981")),(0,l.kt)("h3",{id:"\u4ee3\u7801\u4fee\u6539"},"\u4ee3\u7801\u4fee\u6539"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4fee\u6539",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose.yml"),",\u4ee3\u7801\u5982\u4e0b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"version: '3'\nservices:\n    editor-server:  # service name\n        build:\n            context: .  # \u5f53\u524d\u76ee\u5f55\n            dockerfile: Dockerfile  # \u57fa\u4e8e Dockerfile \u6784\u5efa\n        image: editor-server # \u4f9d\u8d56\u4e8e\u5f53\u524d Dockerfile \u521b\u5efa\u51fa\u6765\u7684\u955c\u50cf\n        container_name: editor-server\n        ports:\n            - 8081:3000 # \u5bbf\u4e3b\u673a\u901a\u8fc7 8081 \u8bbf\u95ee\n    editor-redis:  # service name\uff0c\u91cd\u8981\uff01\n        image: redis  # \u5f15\u7528\u5b98\u7f51 redis \u955c\u50cf\n        container_name: editor-redis\n        ports:\n            # \u5bbf\u4e3b\u673a\uff0c\u53ef\u4ee5\u7528 127.0.0.1:6378 \u5373\u53ef\u8fde\u63a5\u5bb9\u5668\u4e2d\u7684\u6570\u636e\u5e93 `redis-cli -h 127.0.0.1 -p 6378`\n            # \u4f46\u662f\uff0c\u5176\u4ed6 docker \u5bb9\u5668\u4e0d\u80fd\uff0c\u56e0\u4e3a\u6b64\u65f6 127.0.0.1 \u662f docker \u5bb9\u5668\u672c\u8eab\uff0c\u800c\u4e0d\u662f\u5bbf\u4e3b\u673a\n            - 6378:6379\n        environment:\n            - TZ=Asia/Shanghai # \u8bbe\u7f6e\u65f6\u533a\n    \n    editor-mysql:\n        image: mysql # \u5f15\u7528\u5b98\u7f51 mysql \u955c\u50cf\n        container_name: editor-mysql\n        restart: always # \u51fa\u9519\u5219\u91cd\u542f\n        privileged: true # \u9ad8\u6743\u9650\uff0c\u6267\u884c\u4e0b\u9762\u7684 mysql/init\n        command: --default-authentication-plugin=mysql_native_password # \u8fdc\u7a0b\u8bbf\u95ee\n        ports:\n            - 3305:3306 # \u5bbf\u4e3b\u673a\u53ef\u4ee5\u7528 127.0.0.1:3305 \u5373\u53ef\u8fde\u63a5\u5bb9\u5668\u4e2d\u7684\u6570\u636e\u5e93\uff0c\u548c redis \u4e00\u6837\n        volumes:\n            - .docker-volumes/mysql/log:/var/log/mysql  # \u8bb0\u5f55\u65e5\u5fd7\n            - .docker-volumes/mysql/data:/var/lib/mysql # \u6570\u636e\u6301\u4e45\u5316\n            - ./mysql/init:/docker-entrypoint-initdb.d/ # \u521d\u59cb\u5316 sql\n        environment:\n            - MYSQL_DATABASE=imooc_lego_course # \u521d\u59cb\u5316\u5bb9\u5668\u65f6\u521b\u5efa\u6570\u636e\u5e93\n            - MYSQL_ROOT_PASSWORD=Mysql_2019\n            - TZ=Asia/Shanghai # \u8bbe\u7f6e\u65f6\u533a\n    editor-mongo:\n        image: mongo # \u5f15\u7528\u5b98\u7f51 mongo \u955c\u50cf\n        container_name: editor-mongo\n        restart: always\n        volumes:\n            - '.docker-volumes/mongo/data:/data/db' # \u6570\u636e\u6301\u4e45\u5316\n        environment:\n            - MONGO_INITDB_DATABASE=imooc_lego_course\n            - TZ=Asia/Shanghai # \u8bbe\u7f6e\u65f6\u533a\n        ports:\n            - '27016:27017' # \u5bbf\u4e3b\u673a\u53ef\u4ee5\u7528 127.0.0.1:27016 \u5373\u53ef\u8fde\u63a5\u5bb9\u5668\u4e2d\u7684\u6570\u636e\u5e93\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u589e\u52a0",(0,l.kt)("inlineCode",{parentName:"li"},"mysql/init/init.sql"),"\uff0c\u521d\u59cb\u5316mysql")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"-- docker-compose \u542f\u52a8 mysql \u65f6\u7684\u521d\u59cb\u5316\u4ee3\u7801\n\nselect \"init start...\";\n\n-- \u8bbe\u7f6e root \u7528\u6237\u53ef\u5916\u7f51\u8bbf\u95ee\nuse mysql;\nSET SQL_SAFE_UPDATES=0; -- \u89e3\u9664\u5b89\u5168\u6a21\u5f0f\uff0c\u6d4b\u8bd5\u73af\u5883\uff0c\u6ca1\u5173\u7cfb\nupdate user set host='%' where user='root';\nflush privileges;\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'Mysql_2019'; -- \u5bc6\u7801\u53c2\u8003 docker-compose.yml\nflush privileges;\n\nselect \"init end...\";\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4fee\u6539",(0,l.kt)("inlineCode",{parentName:"li"},"config/envs/prd-dev.js"),"\uff0c\u589e\u52a0mysql\u548cmongodb\u7684\u914d\u7f6e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const devConf = require('./dev');\n\n//\u4fee\u6539redis\u8fde\u63a5\u914d\u7f6e\nObject.assign(devConf.redisConf, {\n  //\u548cdocker-compose\u4e2d\u914d\u7f6e\u7684service\u540d\u5b57\u4e00\u81f4\n  //\u3010\u6ce8\u610f\u3011\u7aef\u53e3\u4f9d\u7136\u662f6379\uff0c\u800c\u4e0d\u662f6378\uff0c\u540e\u8005\u662f\u5bbf\u4e3b\u673a\u7684\u7aef\u53e3\n  host: 'editor-redis'\n});\n\n//\u4fee\u6539mongodb\u8fde\u63a5\u914d\u7f6e\nObject.assign(devConf.mongodbConf,{\n  host: 'editor-mongo',//\u548cdocler-compose\u4e2d\u914d\u7f6e\u7684service\u540d\u5b57\u4e00\u81f4\n});\n\n//\u4fee\u6539mysql\u8fde\u63a5\u914d\u7f6e\nObject.assign(devConf.mysqlConf,{\n  host: 'editor-mysql',//\u548cdocler-compose\u4e2d\u914d\u7f6e\u7684service\u540d\u5b57\u4e00\u81f4\n});\n\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4fee\u6539",(0,l.kt)("inlineCode",{parentName:"li"},".gitignore"),"\u6587\u4ef6\uff0c\u589e\u52a0\u4e00\u884c",(0,l.kt)("inlineCode",{parentName:"li"},".docker-volumes"))),(0,l.kt)("h3",{id:"\u6f14\u793a"},"\u6f14\u793a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker-compose build editor-server # \u914d\u7f6e\u6587\u4ef6\u7684 service name\ndocker-compose up -d\ndocker-compose ps\n\n# \u8bbf\u95ee localhost:8081 \uff0c\u67e5\u770b docker logs\n\ndocker-compose down\n\n")),(0,l.kt)("h2",{id:""}))}k.isMDXComponent=!0},96370:function(e,n,t){n.Z=t.p+"assets/images/604e0e91092dc2c506600330-47e53da6dde0e8d2b0bd37ac52d99308.png"},2034:function(e,n,t){n.Z=t.p+"assets/images/604e0e9d090ea8f415320818-47e518be2bab364829e6d586bbf5083d.png"},17442:function(e,n,t){n.Z=t.p+"assets/images/image-20220421170553860-7a85cd0b160c8aedb790d8b093ca254c.png"}}]);