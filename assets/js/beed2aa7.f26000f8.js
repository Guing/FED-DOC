"use strict";(self.webpackChunkfed_doc=self.webpackChunkfed_doc||[]).push([[6113],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return k}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=r.createContext({}),s=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=s(e.components);return r.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=s(t),k=a,m=c["".concat(p,".").concat(k)]||c[k]||d[k]||l;return t?r.createElement(m,i(i({ref:n},u),{},{components:t})):r.createElement(m,i({ref:n},u))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,i=new Array(l);i[0]=c;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var s=2;s<l;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},14020:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return p},default:function(){return k},frontMatter:function(){return o},metadata:function(){return s},toc:function(){return d}});var r=t(87462),a=t(63366),l=(t(67294),t(3905)),i=["components"],o={},p=void 0,s={unversionedId:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/GitHub actions",id:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/GitHub actions",title:"GitHub actions",description:"Github actions",source:"@site/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/1-GitHub actions.md",sourceDirName:"19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316",slug:"/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/GitHub actions",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/GitHub actions",editUrl:"https://github.com/Guing/FED-DOC/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/1-GitHub actions.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u5bfc\u5b66",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/\u5bfc\u5b66"},next:{title:"Docker",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u7b2c15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/Docker"}},u={},d=[{value:"Github actions",id:"github-actions",level:2},{value:"\u5e94\u7528\u573a\u666f",id:"\u5e94\u7528\u573a\u666f",level:3},{value:"\u4ee3\u7801\u6f14\u793a",id:"\u4ee3\u7801\u6f14\u793a",level:3},{value:"\u64cd\u4f5c",id:"\u64cd\u4f5c",level:3},{value:"\u65b0\u5efaworkflow",id:"\u65b0\u5efaworkflow",level:4},{value:"Docker",id:"docker",level:2},{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",level:3},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:3},{value:"\u5e38\u7528\u547d\u4ee4",id:"\u5e38\u7528\u547d\u4ee4",level:3},{value:"image\u955c\u50cf",id:"image\u955c\u50cf",level:3},{value:"container",id:"container",level:3},{value:"\u529f\u80fd\u6f14\u793a",id:"\u529f\u80fd\u6f14\u793a",level:3},{value:"Dockerfile",id:"dockerfile",level:2},{value:"\u6784\u5efa",id:"\u6784\u5efa",level:3},{value:"\u4ee3\u7801\u6f14\u793a",id:"\u4ee3\u7801\u6f14\u793a-1",level:3},{value:"Docker-compose",id:"docker-compose",level:2},{value:"\u914d\u7f6e\u6587\u4ef6",id:"\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u547d\u4ee4",id:"\u547d\u4ee4",level:3},{value:"\u914d\u7f6e\u6d4b\u8bd5\u673a",id:"\u914d\u7f6e\u6d4b\u8bd5\u673a",level:2},{value:"\u521b\u5efawork\u8d26\u53f7",id:"\u521b\u5efawork\u8d26\u53f7",level:2},{value:"\u767b\u5f55\u4fe1\u4efb",id:"\u767b\u5f55\u4fe1\u4efb",level:3},{value:"\u5b89\u88c5\u5fc5\u5907\u8f6f\u4ef6",id:"\u5b89\u88c5\u5fc5\u5907\u8f6f\u4ef6",level:3},{value:"git",id:"git",level:4},{value:"docker",id:"docker-1",level:4},{value:"\u5f00\u653e\u7aef\u53e3",id:"\u5f00\u653e\u7aef\u53e3",level:3},{value:"\u53d1\u5e03\u5230\u6d4b\u8bd5\u673a",id:"\u53d1\u5e03\u5230\u6d4b\u8bd5\u673a",level:2},{value:"\u68b3\u7406\u601d\u8def",id:"\u68b3\u7406\u601d\u8def",level:3},{value:"\u4ee3\u7801\u6f14\u793a",id:"\u4ee3\u7801\u6f14\u793a-2",level:3},{value:"\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5",id:"\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5",level:3}],c={toc:d};function k(e){var n=e.components,o=(0,a.Z)(e,i);return(0,l.kt)("wrapper",(0,r.Z)({},c,o,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"github-actions"},"Github actions"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docs.github.com/cn/actions/learn-github-actions"},"\u4e2d\u6587\u6587\u6863")),(0,l.kt)("p",null,"\u4ee3\u7801\u5728\u9879\u76ee\u7684",(0,l.kt)("inlineCode",{parentName:"p"},".github/workflows"),"\u76ee\u5f55\u4e0b\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},".yml"),"\u683c\u5f0f\u6587\u4ef6\u3002"),(0,l.kt)("h3",{id:"\u5e94\u7528\u573a\u666f"},"\u5e94\u7528\u573a\u666f"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"master\u5206\u652f\uff0c\u81ea\u52a8\u5316\u6d4b\u8bd5"),(0,l.kt)("li",{parentName:"ul"},"dev\u5206\u652f\uff0c\u81ea\u52a8\u90e8\u7f72\u5230\u6d4b\u8bd5\u673a"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"v*.*.*"),"\u683c\u5f0f\u7684tag\uff0c\u81ea\u52a8\u4e0a\u7ebf(\u652f\u6301\u56de\u6eda)")),(0,l.kt)("h3",{id:"\u4ee3\u7801\u6f14\u793a"},"\u4ee3\u7801\u6f14\u793a"),(0,l.kt)("p",null,"\u89e6\u53d1\u6761\u4ef6",(0,l.kt)("inlineCode",{parentName:"p"},"on")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"push"),(0,l.kt)("li",{parentName:"ul"},"branches"),(0,l.kt)("li",{parentName:"ul"},"paths")),(0,l.kt)("p",null,"\u4efb\u52a1",(0,l.kt)("inlineCode",{parentName:"p"},"jobs")),(0,l.kt)("p",null,"\u6b65\u9aa4",(0,l.kt)("inlineCode",{parentName:"p"},"steps"),"\uff0c\u53ef\u81ea\u5b9a\u4e49\uff0c\u4e5f\u53ef\u4f7f\u7528\u7b2c\u4e09\u65b9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"# \u7b2c\u4e00\u79cd\uff1a\u7b2c\u4e09\u65b9\uff1a\u76f4\u63a5\u4f7f\u7528 uses \n- uses: actions/checkout@v2 #\u76f8\u5f53\u4e8egit pull \u83b7\u53d6\u5f53\u524d\u6700\u65b0\u4ee3\u7801\n\n# \u7b2c\u4e8c\u79cd\uff1a\u7b2c\u4e09\u65b9\uff1a\u4f7f\u7528 name \u548c uses\n- name: Use Node.js\n  uses: actions/setup-node@v1 #\u5b89\u88c5nodejs\n  with:  #\u9644\u52a0\u53c2\u6570\n    node-version: 14\n\n# \u7b2c\u4e09\u79cd\uff1a\u81ea\u5b9a\u4e49\uff1a\u4f7f\u7528 name \u548c \u4e00\u4e2arun\n- name: lint and test\n  run: |  #\u9700\u8981\u4e00\u4e2a|\n    npm i\n    npm run lint\n    npm run test\n\n# \u7b2c\u56db\u79cd\uff1a\u81ea\u5b9a\u4e49\uff1a\u76f4\u63a5\u4f7f\u7528 \u591a\u4e2arun\n- run: npm i\n- run: npm run lint\n- run: npm run test\n\n\n")),(0,l.kt)("h3",{id:"\u64cd\u4f5c"},"\u64cd\u4f5c"),(0,l.kt)("h4",{id:"\u65b0\u5efaworkflow"},"\u65b0\u5efaworkflow"),(0,l.kt)("p",null,"\u65b0\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"deno.yml")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"name: Deno\n\non:\n  push:\n    branches: #\u5206\u652f\n      - main\n    paths: #\u89e6\u53d1\u6761\u4ef6\n      - '.github/workflows/**'\n      # - '__test__/**' # dev \u4e0d\u9700\u8981\u7acb\u5373\u6d4b\u8bd5\n      - 'src/**'\n\njobs:\n  test:\n    runs-on: ${{ matrix.os }} # runs a test on Ubuntu, Windows and macOS\n\n    strategy:\n      matrix:\n        deno: [\"v1.x\", \"nightly\"]\n        os: [macOS-latest, windows-latest, ubuntu-latest]\n\n    steps:\n      - uses: actions/checkout@v2\n      - name: print node version\n        run: |  #\u6267\u884c\u81ea\u5b9a\u4e49\u547d\u4ee4\n          node -v\n          npm -v\n")),(0,l.kt)("p",null,"\u5f53\u6211\u4eec\u6267\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"git push"),"\u7684\u65f6\u5019\uff0c\u63a8\u9001\u5230",(0,l.kt)("inlineCode",{parentName:"p"},"github"),"\uff0c\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"Actions"),"\u91cc\u9762\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u63a8\u9001\u7684\u5185\u5bb9\uff0c\u8fd9\u65f6\u5019\u72b6\u6001\u672a\u672a\u6267\u884c\uff0c\u6709\u4e2a\u9ec4\u8272\u5c0f\u5706\u70b9\uff0c\u5f53\u6b63\u5728\u6267\u884c\u7684\u65f6\u5019\u662f\u4e00\u4e2aloading\u7684\u5c0f\u5706\u70b9\uff0c\u6267\u884c\u6210\u529f\u4e3a\u5bf9\u52fe\uff0c\u5931\u8d25\u4e3a\u7ea2\u8272\u53c9\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(23250).Z,width:"2640",height:"1362"})),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(11624).Z,width:"2804",height:"1084"})),(0,l.kt)("p",null,"\u5982\u679c\u5931\u8d25\uff0c\u8bf7\u67e5\u770b\u5931\u8d25\u8bf4\u660e\u3002"),(0,l.kt)("h2",{id:"docker"},"Docker"),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(96370).Z,width:"660",height:"330"})),(0,l.kt)("h3",{id:"\u4ecb\u7ecd"},"\u4ecb\u7ecd"),(0,l.kt)("p",null,"Docker\u5c31\u662f\u4e00\u79cd\u865a\u62df\u673a\u6280\u672f\uff0c\u6bd4\u4f20\u7edf\u865a\u62df\u673a(\u5982vmware,virtualbox)\u8981\u66f4\u52a0\u7b80\u5355\uff0c\u8f7b\u91cf"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u542f\u52a8\u5feb"),(0,l.kt)("li",{parentName:"ul"},"\u8d44\u6e90\u5360\u7528\u5c11"),(0,l.kt)("li",{parentName:"ul"},"\u4f53\u79ef\u5c0f")),(0,l.kt)("h3",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docs.docker.com/get-docker/"},"\u6587\u6863")),(0,l.kt)("p",null,"\u5b89\u88c5\u5b8c\u8bb0\u5f97\u955c\u50cf\u52a0\u901f"),(0,l.kt)("p",null,"\u5b89\u88c5\u5b8c\uff0c\u8fd0\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"docker version"),"\u53ef\u67e5\u770b\u7248\u672c"),(0,l.kt)("h3",{id:"\u57fa\u672c\u6982\u5ff5"},"\u57fa\u672c\u6982\u5ff5"),(0,l.kt)("p",null,"\u4f7f\u7528vmware\u3001virtualbox\u65f6\uff0c\u6b65\u9aa4\u5982\u4e0b"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e0b\u8f7d\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"li"},"centos.iso"),"\u6587\u4ef6"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528vmwaire\u5b89\u88c5\u4e00\u4e2a\u7cfb\u7edfA"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528vmwaire\u5b89\u88c5\u4e00\u4e2a\u7cfb\u7edfB"),(0,l.kt)("li",{parentName:"ul"},"......")),(0,l.kt)("p",null,"\u6b64\u5904\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"centos.iso"),"\u6587\u4ef6\u5c31\u662f\u4e00\u4e2aimage\u955c\u50cf\uff0c\u5b89\u88c5\u51fa\u6765\u7684\u7cfb\u7edf\u5c31\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684container\u5bb9\u5668\u3002"),(0,l.kt)("p",null,"docker\u7684\u6240\u6709image\u90fd\u53ef\u4ee5\u5728",(0,l.kt)("a",{parentName:"p",href:"https://hub.docker.com/%E6%90%9C%E7%B4%A2%E5%B9%B6%E4%B8%8B%E8%BD%BD%EF%BC%8C%E8%BF%98%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E4%B9%89image%E4%B8%8A%E4%BC%A0%E5%88%B0%E8%BF%99%E4%B8%AA%E4%BB%93%E5%BA%93"},"https://hub.docker.com/\u641c\u7d22\u5e76\u4e0b\u8f7d\uff0c\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49image\u4e0a\u4f20\u5230\u8fd9\u4e2a\u4ed3\u5e93")),(0,l.kt)("p",null,(0,l.kt)("img",{src:t(2034).Z,width:"1532",height:"818"})),(0,l.kt)("h3",{id:"\u5e38\u7528\u547d\u4ee4"},"\u5e38\u7528\u547d\u4ee4"),(0,l.kt)("p",null,"\u5982\u679c\u6ca1\u6709\u5b89\u88c5\uff0c\u53ef\u4ee5\u5728",(0,l.kt)("a",{parentName:"p",href:"https://labs.play-with-docker.com/"},"play with docker"),"\u4f53\u9a8c\u4e00\u4e0b\u3002"),(0,l.kt)("h3",{id:"image\u955c\u50cf"},"image\u955c\u50cf"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e0b\u8f7d\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker pull <image-name>:<tag>")),(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u6240\u6709\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker images")),(0,l.kt)("li",{parentName:"ul"},"\u5220\u9664\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker rmi <image-id>")),(0,l.kt)("li",{parentName:"ul"},"\u4e0a\u4f20\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker push <username>/<respository>:<tag>"),",\u8981\u5148\u6ce8\u518c",(0,l.kt)("a",{parentName:"li",href:"https://hub.docker.com/"},"https://hub.docker.com/"))),(0,l.kt)("p",null,"\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"docker images"),"\u51fa\u73b0REPOSITORY\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"<none>"),"\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u8fd0\u884c",(0,l.kt)("inlineCode",{parentName:"p"},"docker image prune"),"\u5220\u9664\u3002"),(0,l.kt)("h3",{id:"container"},"container"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u542f\u52a8\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"docker run -p xxxx:xxxx -v=hostPath:containerPath -d --name <container-name><image-name>")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"-p\u7aef\u53e3\u6620\u5c04"),(0,l.kt)("li",{parentName:"ul"},"-v\u6570\u636e\u5377\uff0c\u6587\u4ef6\u6620\u5c04"),(0,l.kt)("li",{parentName:"ul"},"-d\u540e\u53f0\u8fd0\u884c"),(0,l.kt)("li",{parentName:"ul"},"--name\u5b9a\u4e49\u5bb9\u5668\u540d\u79f0"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u770b\u6240\u6709\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"docker ps"),"\uff0c\u52a0",(0,l.kt)("inlineCode",{parentName:"p"},"-a"),"\u663e\u793a\u9690\u85cf\u7684\u5bb9\u5668")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u505c\u6b62\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"docker stop <container-id>"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5220\u9664\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"p"},"docker rm <container-id>"),"\uff0c\u52a0",(0,l.kt)("inlineCode",{parentName:"p"},"-f"),"\u662f\u5f3a\u5236\u5220\u9664")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u770b\u5bb9\u5668\u4fe1\u606f\uff0c\u5982IP\u5730\u5740",(0,l.kt)("inlineCode",{parentName:"p"},"docker inspect <container-id>"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u67e5\u770b\u5bb9\u5668\u65e5\u5fd7",(0,l.kt)("inlineCode",{parentName:"p"},"docker logs <container-id>"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u8fdb\u5165\u5bb9\u5668\u63a7\u5236\u53f0",(0,l.kt)("inlineCode",{parentName:"p"},"docker exec -it <container-id> /bin/sh")))),(0,l.kt)("h3",{id:"\u529f\u80fd\u6f14\u793a"},"\u529f\u80fd\u6f14\u793a"),(0,l.kt)("p",null,"\u4ee5nginx\u4e3a\u4f8b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker run -p 81:80 -d --name nginx1 nginx\ndocker ps\n\n# \u8bbf\u95ee localhost:81 \uff0c\u5e76\u67e5\u770b log\n\ndocker exec -it <container-id> /bin/sh\ncd /usr/share/nginx/html\necho hello docker world index.html\nexit\n\n# \u91cd\u65b0\u8bbf\u95ee localhost:81 \uff0c\u5f3a\u5236\u5237\u65b0\n\ndocker stop <container-id>\ndocker rm <container-id>\n\n")),(0,l.kt)("p",null,"\u5355\u72ec\u6f14\u793a\u4e00\u4e0b",(0,l.kt)("inlineCode",{parentName:"p"},"-v"),"\u6570\u636e\u5377\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"# 1. \u65b0\u5efa /Users/wfp/html/index.html \uff0c\u5185\u5bb9\u81ea\u5b9a\u4e49\u5373\u53ef\n\n# 2. \u8fd0\u884c\ndocker run -p 81:80 -v=/Users/wfp/html:/usr/share/nginx/html  -d --name nginx1 nginx\n\n# 3. \u8bbf\u95ee \u91cd\u65b0\u8bbf\u95ee localhost:81 \uff0c\u770b\u662f\u5426\u4f60\u521b\u5efa\u7684\u9875\u9762\uff1f\n\n")),(0,l.kt)("h2",{id:"dockerfile"},"Dockerfile"),(0,l.kt)("p",null,"\u4e00\u4e2a\u7b80\u5355\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u63cf\u8ff0\u5982\u4f55\u6784\u5efa\u4e00\u4e2a\u65b0\u7684image\u955c\u50cf"),(0,l.kt)("p",null,"\u6ce8\u610f:\u5fc5\u987b\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"Dockerfile"),"\u8fd9\u4e2a\u6587\u4ef6\u540d\uff0c\u5fc5\u987b\u5728\u9879\u76ee\u7684\u6839\u76ee\u5f55"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"# node\u73af\u5883\nFROM node:14\nWORKDIR /app\nCOPY . /app\n\n# \u6784\u5efa\u955c\u50cf\u65f6\uff0c\u4e00\u822c\u7528\u4e8e\u505a\u4e00\u4e9b\u7cfb\u7edf\u914d\u7f6e\uff0c\u5b89\u88c5\u5fc5\u5907\u7684\u8f6f\u4ef6\u3002\u53ef\u6709\u591a\u4e2a RUN\nRUN xxx\nRUN xxx\nRUN xxx\n\n# \u542f\u52a8\u5bb9\u5668\u65f6\uff0c\u53ea\u80fd\u6709\u4e00\u4e2a CMD\nCMD xxx\n\n# \u73af\u5883\u53d8\u91cf\nENV K1=v1\nENV K2=v2\n\n")),(0,l.kt)("h3",{id:"\u6784\u5efa"},"\u6784\u5efa"),(0,l.kt)("p",null,"\u6587\u4ef6\u6839\u76ee\u5f55\u6267\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker build -t <name> . # \u6700\u540e\u7684 `.` \u6307 Dockerfile \u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u3002\ndocker images\n")),(0,l.kt)("h3",{id:"\u4ee3\u7801\u6f14\u793a-1"},"\u4ee3\u7801\u6f14\u793a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},".dockerignore\u6587\u4ef6\u5ffd\u7565")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},".git\nnode_modules\nlogs\n.docker-volumes\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Dockerfile\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'# Dockerfile\nFROM node:14\nWORKDIR /app\nCOPY . /app\n\n# \u8bbe\u7f6e\u65f6\u533a\nRUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo \'Asia/Shanghai\' >/etc/timezone\n\n# \u5b89\u88c5\nRUN npm set registry https://registry.npm.taobao.org\nRUN npm install\nRUN npm install pm2 -g\n\n# \u542f\u52a8\nCMD echo $SERVER_NAME && echo $AUTHOR_NAME &&npm run server && npx pm2 log #\u4e00\u5b9a\u8981\u662f\u963b\u585e\u63a7\u5236\u53f0\u7684\u7a0b\u5e8f\n\n# \u73af\u5883\u53d8\u91cf\nENV SERVER_NAME="tanchidemao"\nENV AUTHOR_NAME="roy"\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u672c\u5730\u5b89\u88c5pm2 ",(0,l.kt)("inlineCode",{parentName:"li"},"npm i pm2 --save-dev"),"\uff0c\u6216\u8005Dockerfile\u4e2d\u5168\u5c40\u5b89\u88c5pm2")),(0,l.kt)("p",null,"\u6d4b\u8bd5\u8fc7\u7a0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker build -t editor-server .  # \u6784\u5efa image\ndocker images\n\ndocker run -p 8081:3000 -d --name server1 editor-server  # \u521b\u5efa\u5bb9\u5668\uff0c\u6ce8\u610f\u7aef\u53e3\u6620\u5c04\ndocker ps\ndocker logs <container-id>  # \u9700\u7b49\u5f85\u6784\u5efa\u5b8c\u6210\n\n# \u8bbf\u95ee localhost:8081 \uff0c\u67e5\u770b docker logs\n\ndocker stop <container-id>\ndocker rm <container-id>\ndocker rmi <image-id>\n\n")),(0,l.kt)("h2",{id:"docker-compose"},"Docker-compose"),(0,l.kt)("p",null,"\u8f6f\u4ef6\u8bbe\u8ba1\u548c\u5f00\u53d1\uff0c\u6709\u5355\u4e00\u804c\u8d23\u539f\u5219\u3002Docker\u4e5f\u4e00\u6837\uff0c\u6bcf\u4e2a\u5bb9\u5668\u90fd\u53ea\u8d1f\u8d23\u4e00\u4e2a\u670d\u52a1\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u5f00\u53d1\u73af\u5883\u9700\u8981\u591a\u4e2a\u670d\u52a1(nodejs mysql mongodb redis),\u5c31\u9700\u8981\u542f\u52a8\u591a\u4e2aDocker\u5bb9\u5668\u3002"),(0,l.kt)("p",null,"\u8981\u8fde\u540c\u8fd9\u591a\u4e2aDocker\u5bb9\u5668\uff0c\u5c31\u9700\u8981Docker-compose\u3002"),(0,l.kt)("h3",{id:"\u914d\u7f6e\u6587\u4ef6"},"\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("p",null,"\u65b0\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),"\u6587\u4ef6\u3002\u5148\u4ee5redis\u4e3a\u4f8b\uff0c\u6f14\u793a\u591a\u4e2a\u5bb9\u5668\u5982\u4f55\u5173\u8054\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"version: '3'\nservices:\n    editor-server:  # service name\n        build:\n            context: .  # \u5f53\u524d\u76ee\u5f55\n            dockerfile: Dockerfile  # \u57fa\u4e8e Dockerfile \u6784\u5efa\n        image: editor-server # \u4f9d\u8d56\u4e8e\u5f53\u524d Dockerfile \u521b\u5efa\u51fa\u6765\u7684\u955c\u50cf\n        container_name: editor-server\n        ports:\n            - 8081:3000 # \u5bbf\u4e3b\u673a\u901a\u8fc7 8081 \u8bbf\u95ee\n    editor-redis:  # service name\uff0c\u91cd\u8981\uff01\n        image: redis  # \u5f15\u7528\u5b98\u7f51 redis \u955c\u50cf\n        container_name: editor-redis\n        ports:\n            # \u5bbf\u4e3b\u673a\uff0c\u53ef\u4ee5\u7528 127.0.0.1:6378 \u5373\u53ef\u8fde\u63a5\u5bb9\u5668\u4e2d\u7684\u6570\u636e\u5e93 `redis-cli -h 127.0.0.1 -p 6378`\n            # \u4f46\u662f\uff0c\u5176\u4ed6 docker \u5bb9\u5668\u4e0d\u80fd\uff0c\u56e0\u4e3a\u6b64\u65f6 127.0.0.1 \u662f docker \u5bb9\u5668\u672c\u8eab\uff0c\u800c\u4e0d\u662f\u5bbf\u4e3b\u673a\n            - 6378:6379\n        environment:\n            - TZ=Asia/Shanghai # \u8bbe\u7f6e\u65f6\u533a\n\n")),(0,l.kt)("h3",{id:"\u547d\u4ee4"},"\u547d\u4ee4"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6784\u5efa\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose build <service-name>")),(0,l.kt)("li",{parentName:"ul"},"\u542f\u52a8\u6240\u6709\u670d\u52a1\u5668",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose up -d"),"\uff0c\u540e\u53f0\u542f\u52a8"),(0,l.kt)("li",{parentName:"ul"},"\u505c\u6b62\u6240\u6709\u670d\u52a1",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose down")),(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u670d\u52a1",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose ps"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker-compose build editor-server # \u914d\u7f6e\u6587\u4ef6\u7684 service name\ndocker-compose up -d\ndocker-compose ps\n\n# \u8bbf\u95ee localhost:8081 \uff0c\u67e5\u770b docker logs\n\ndocker-compose down\n\n")),(0,l.kt)("h2",{id:"\u914d\u7f6e\u6d4b\u8bd5\u673a"},"\u914d\u7f6e\u6d4b\u8bd5\u673a"),(0,l.kt)("h2",{id:"\u521b\u5efawork\u8d26\u53f7"},"\u521b\u5efawork\u8d26\u53f7"),(0,l.kt)("p",null,"\u5904\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u65e5\u5e38\u4e0d\u4f1a\u7528root\u8d26\u53f7\u767b\u5f55\uff0c\u6743\u9650\u592a\u9ad8\u4e86\u3002"),(0,l.kt)("p",null,"\u7528root\u767b\u5f55\uff0c\u521b\u5efawork\u8d26\u53f7"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"adduser work\npasswd work\n")),(0,l.kt)("p",null,"\u6dfb\u52a0work\u7684sudo\u6743\u9650"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"whereis sudoers # \u627e\u5230\u6587\u4ef6\u4f4d\u7f6e /etc/sudoers\n\nchmod u+w /etc/sudoers # \u4fee\u6539\u6743\u9650\uff0c u \u8868\u793a\u6240\u6709\u8005\uff0c w \u8868\u793a\u5199\u6743\u9650 + \u8868\u793a\u6dfb\u52a0\n\nvim /etc/sudoers # \u7f16\u8f91\u8be5\u6587\u4ef6\n# \u627e\u5230     `root    ALL=(ALL)       ALL`\n# \u518d\u52a0\u4e00\u884c  `work    ALL=(ALL)       ALL`\n\nchmod u-w /etc/sudoers\n\n")),(0,l.kt)("p",null,"\u7136\u540e\u4f7f\u7528work\u767b\u5f55\u673a\u5668\u3002\u8f93\u5165",(0,l.kt)("inlineCode",{parentName:"p"},"su"),"\uff0c\u5728\u8f93\u5165root\u8d26\u53f7\u7684\u5bc6\u7801\uff0c\u5373\u53ef\u62e5\u6709\u8d85\u7ea7\u6743\u9650\u3002"),(0,l.kt)("h3",{id:"\u767b\u5f55\u4fe1\u4efb"},"\u767b\u5f55\u4fe1\u4efb"),(0,l.kt)("p",null,"\u4f7f\u7528work\u767b\u5f55\u673a\u5668\uff0c\u521b\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"~/.ssh/authorized_keys"),"\u6587\u4ef6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"# \u4fee\u6539\u6587\u4ef6\u5939\u6743\u9650\nchmod 700  ~/.ssh\nchmod 600  ~/.ssh/authorized_keys\n\n")),(0,l.kt)("p",null,"\u5c06\u672c\u673a\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"id_rsa.pub"),"\u5185\u5bb9\u7c98\u8d34\u8fdb\u6765\u3002"),(0,l.kt)("p",null,"\u9000\u51fa\u91cd\u65b0\u7528work\u767b\u5f55\uff0c\u5c06\u4e0d\u7528\u5728\u8f93\u5165\u5bc6\u7801\u3002"),(0,l.kt)("h3",{id:"\u5b89\u88c5\u5fc5\u5907\u8f6f\u4ef6"},"\u5b89\u88c5\u5fc5\u5907\u8f6f\u4ef6"),(0,l.kt)("p",null,"\u4ee5\u4e0b\u90fd\u9700\u8981",(0,l.kt)("inlineCode",{parentName:"p"},"su"),"\u6743\u9650"),(0,l.kt)("h4",{id:"git"},"git"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"yum -y install git\ngit --version\n\n")),(0,l.kt)("h4",{id:"docker-1"},"docker"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/install/centos/"},"\u5b89\u88c5docker")),(0,l.kt)("li",{parentName:"ul"},"docker\u955c\u50cf\u52a0\u901f"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/install/"},"\u5b89\u88c5docker-compose"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"docker version\ndocker-compose --version\n")),(0,l.kt)("h3",{id:"\u5f00\u653e\u7aef\u53e3"},"\u5f00\u653e\u7aef\u53e3"),(0,l.kt)("p",null,"\u5f00\u653e\u9700\u8981\u7684\u7aef\u53e3\uff0c\u5426\u5219\u5916\u7f51\u65e0\u6cd5\u8bbf\u95ee\u8be5\u7aef\u53e3"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"B\u7aef FE - 80"),(0,l.kt)("li",{parentName:"ul"},"B\u7aef server - 8081"),(0,l.kt)("li",{parentName:"ul"},"C\u7aef - 8082"),(0,l.kt)("li",{parentName:"ul"},"\u7edf\u8ba1\u670d\u52a1\uff0c\u6536\u96c6\u65e5\u5fd7 - 8083"),(0,l.kt)("li",{parentName:"ul"},"\u7edf\u8ba1\u670d\u52a1 OpenAPI - 8080"),(0,l.kt)("li",{parentName:"ul"},"admin FE - 8085"),(0,l.kt)("li",{parentName:"ul"},"admin server - 8084")),(0,l.kt)("h2",{id:"\u53d1\u5e03\u5230\u6d4b\u8bd5\u673a"},"\u53d1\u5e03\u5230\u6d4b\u8bd5\u673a"),(0,l.kt)("h3",{id:"\u68b3\u7406\u601d\u8def"},"\u68b3\u7406\u601d\u8def"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528github actions\u76d1\u542cdev\u5206\u652fpush"),(0,l.kt)("li",{parentName:"ul"},"\u767b\u5f55\u6d4b\u8bd5\u673a\uff0c\u83b7\u53d6\u6700\u65b0dev\u5206\u652f\u4ee3\u7801"),(0,l.kt)("li",{parentName:"ul"},"\u91cd\u65b0\u6784\u5efa\u955c\u50cf",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose build editor-server")),(0,l.kt)("li",{parentName:"ul"},"\u91cd\u542f\u6240\u6709\u5bb9\u5668",(0,l.kt)("inlineCode",{parentName:"li"},"docker-compose up -d"))),(0,l.kt)("h3",{id:"\u4ee3\u7801\u6f14\u793a-2"},"\u4ee3\u7801\u6f14\u793a"),(0,l.kt)("p",null,"\u65b0\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"deploy-dev.yml"),"\u5185\u5bb9\u5982\u4e0b:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"name: deploy for dev\n\non:\n    push:\n        branches:\n            - 'dev' # \u53ea\u9488\u5bf9 dev \u5206\u652f\n        paths:\n            - '.github/workflows/*'\n            # - '__test__/**' # dev \u4e0d\u9700\u8981\u7acb\u5373\u6d4b\u8bd5\n            - 'src/**'\n            - 'Dockerfile'\n            - 'docker-compose.yml'\n            - 'bin/*'\n\njobs:\n    deploy-dev:\n        runs-on: ubuntu-latest\n\n        steps:\n            - uses: actions/checkout@v2\n            - name: set ssh key # \u4e34\u65f6\u8bbe\u7f6e ssh key\n              run: |\n                  mkdir -p ~/.ssh/\n                  # secrets.WFP_ID_RSA github\u91cc\u9762\u8bbe\u7f6e\u7684\n                  echo \"${{secrets.WFP_ID_RSA}}\" > ~/.ssh/id_rsa\n                  chmod 600 ~/.ssh/id_rsa\n                  ssh-keyscan \"182.92.xxx.xxx\" >> ~/.ssh/known_hosts\n            - name: deploy # \u90e8\u7f72\n              run: |\n                  ssh work@182.92.xxx.xxx \"\n                    # \u3010\u6ce8\u610f\u3011\u7528 work \u8d26\u53f7\u767b\u5f55\uff0c\u624b\u52a8\u521b\u5efa /home/work/imooc-lego \u76ee\u5f55\n                    # \u7136\u540e git clone https://username:password@github.com/imooc-lego/biz-editor-server.git -b dev \uff08\u79c1\u6709\u4ed3\u5e93\uff0c\u4f7f\u7528 github \u7528\u6237\u540d\u548c\u5bc6\u7801\uff09\n                    # \u8bb0\u5f97\u5220\u9664 origin \uff0c\u5426\u5219\u4f1a\u66b4\u9732 github \u5bc6\u7801\n\n                    cd /home/work/imooc-lego/biz-editor-server;\n                    git remote add origin https://wangfupeng1988:${{secrets.WFP_PASSWORD}}@github.com/imooc-lego/biz-editor-server.git;\n                    git checkout dev;\n                    git pull origin dev; # \u91cd\u65b0\u4e0b\u8f7d\u6700\u65b0\u4ee3\u7801\n                    git remote remove origin; # \u5220\u9664 origin \uff0c\u5426\u5219\u4f1a\u66b4\u9732 github \u5bc6\u7801\n                    # \u542f\u52a8 docker\n                    docker-compose build editor-server; # \u548c docker-compose.yml service \u540d\u5b57\u4e00\u81f4\n                    docker-compose up -d;\n                  \"\n            - name: delete ssh key # \u5220\u9664 ssh key\n              run: rm -rf ~/.ssh/id_rsa\n\n")),(0,l.kt)("h3",{id:"\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5"},"\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5"),(0,l.kt)("p",null,"\u5f85\u6d4b\u8bd5\u673a\u90e8\u7f72\u5b8c\u6210\uff0c\u5373\u53ef\u8fdb\u884c\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5",(0,l.kt)("inlineCode",{parentName:"p"},"npm run test:remote"),",\u5373",(0,l.kt)("inlineCode",{parentName:"p"},"test.yml"),"\u7684\u5185\u5bb9"),(0,l.kt)("p",null,"\u6ce8\u610f\uff0c\u4e00\u5b9a\u8981\u7b49\u5f85\u6d4b\u8bd5\u673a\u90e8\u7f72\u5b8c\u6210\uff0c\u5426\u5219\u6d4b\u8bd5\u4e0d\u901a\u8fc7"))}k.isMDXComponent=!0},23250:function(e,n,t){n.Z=t.p+"assets/images/1616917297583-13c00161c975dfdaaa7c8b218d2bc32f.jpg"},11624:function(e,n,t){n.Z=t.p+"assets/images/1616917392656-23747557ffc8720e44af31c7881cdda2.jpg"},96370:function(e,n,t){n.Z=t.p+"assets/images/604e0e91092dc2c506600330-47e53da6dde0e8d2b0bd37ac52d99308.png"},2034:function(e,n,t){n.Z=t.p+"assets/images/604e0e9d090ea8f415320818-47e518be2bab364829e6d586bbf5083d.png"}}]);