"use strict";(self.webpackChunkfed_doc=self.webpackChunkfed_doc||[]).push([[4530],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return k}});var r=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,l=function(e,n){if(null==e)return{};var t,r,l={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,l=e.mdxType,a=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=p(t),k=l,g=m["".concat(s,".").concat(k)]||m[k]||u[k]||a;return t?r.createElement(g,o(o({ref:n},c),{},{components:t})):r.createElement(g,o({ref:n},c))}));function k(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var a=t.length,o=new Array(a);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var p=2;p<a;p++)o[p]=t[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},4910:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return s},default:function(){return k},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return u}});var r=t(87462),l=t(63366),a=(t(67294),t(3905)),o=["components"],i={},s="\u811a\u624b\u67b6\u62c6\u5305\u7b56\u7565",p={unversionedId:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1/\u811a\u624b\u67b6\u6a21\u5757\u62c6\u5206\u7b56\u7565\u548ccore\u6a21\u5757\u6280\u672f\u65b9\u6848",id:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1/\u811a\u624b\u67b6\u6a21\u5757\u62c6\u5206\u7b56\u7565\u548ccore\u6a21\u5757\u6280\u672f\u65b9\u6848",title:"\u811a\u624b\u67b6\u62c6\u5305\u7b56\u7565",description:"- \u6838\u5fc3\u6d41\u7a0b\uff1acore",source:"@site/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/1-\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1/02-\u811a\u624b\u67b6\u6a21\u5757\u62c6\u5206\u7b56\u7565\u548ccore\u6a21\u5757\u6280\u672f\u65b9\u6848.md",sourceDirName:"19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/1-\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1",slug:"/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1/\u811a\u624b\u67b6\u6a21\u5757\u62c6\u5206\u7b56\u7565\u548ccore\u6a21\u5757\u6280\u672f\u65b9\u6848",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1/\u811a\u624b\u67b6\u6a21\u5757\u62c6\u5206\u7b56\u7565\u548ccore\u6a21\u5757\u6280\u672f\u65b9\u6848",editUrl:"https://github.com/Guing/FED-DOC/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/1-\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1/02-\u811a\u624b\u67b6\u6a21\u5757\u62c6\u5206\u7b56\u7565\u548ccore\u6a21\u5757\u6280\u672f\u65b9\u6848.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u8c08\u4e00\u8c08\u5927\u5382\u600e\u4e48\u505a\u9879\u76ee-\u9879\u76ee\u6d41\u7a0b",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1/\u811a\u624b\u67b6\u5f00\u53d1\u67b6\u6784\u8bbe\u8ba1"},next:{title:"\u603b\u7ed3",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/3\u5468 \u811a\u624b\u67b6\u6838\u5fc3\u6d41\u7a0b\u5f00\u53d1/\u603b\u7ed3"}},c={},u=[{value:"\u6838\u5fc3\u5e93",id:"\u6838\u5fc3\u5e93",level:4},{value:"\u5de5\u5177\u5e93",id:"\u5de5\u5177\u5e93",level:4},{value:"1. \u9879\u76ee\u521d\u59cb\u5316",id:"1-\u9879\u76ee\u521d\u59cb\u5316",level:2},{value:"2. \u68c0\u67e5\u7248\u672c\u53f7\u5f00\u53d1",id:"2-\u68c0\u67e5\u7248\u672c\u53f7\u5f00\u53d1",level:2},{value:"require\u52a0\u8f7d\u8d44\u6e90\u65b9\u5f0f",id:"require\u52a0\u8f7d\u8d44\u6e90\u65b9\u5f0f",level:3},{value:"npmlog\u4f7f\u7528",id:"npmlog\u4f7f\u7528",level:3},{value:"3. \u68c0\u67e5Node\u7248\u672c \u68c0\u67e5Node\u7248\u672c\u53f7\u7684\u539f\u56e0\u4ee5\u53ca\u89e3\u51b3\u529e\u6cd5\uff1a",id:"3-\u68c0\u67e5node\u7248\u672c-\u68c0\u67e5node\u7248\u672c\u53f7\u7684\u539f\u56e0\u4ee5\u53ca\u89e3\u51b3\u529e\u6cd5",level:2},{value:"4. root\u8d26\u53f7\u542f\u52a8\u68c0\u67e5\u548c\u81ea\u52a8\u964d\u7ea7\u529f\u80fd\u5f00\u53d1",id:"4-root\u8d26\u53f7\u542f\u52a8\u68c0\u67e5\u548c\u81ea\u52a8\u964d\u7ea7\u529f\u80fd\u5f00\u53d1",level:2},{value:"5. \u7528\u6237\u4e3b\u76ee\u5f55\u68c0\u67e5\u529f\u80fd\u5f00\u53d1",id:"5-\u7528\u6237\u4e3b\u76ee\u5f55\u68c0\u67e5\u529f\u80fd\u5f00\u53d1",level:2},{value:"6. \u5165\u53c2\u68c0\u67e5\u548cdebug\u6a21\u5f0f\u5f00\u53d1",id:"6-\u5165\u53c2\u68c0\u67e5\u548cdebug\u6a21\u5f0f\u5f00\u53d1",level:2},{value:"7. \u73af\u5883\u53d8\u91cf\u68c0\u67e5\u529f\u80fd\u5f00\u53d1",id:"7-\u73af\u5883\u53d8\u91cf\u68c0\u67e5\u529f\u80fd\u5f00\u53d1",level:2},{value:"8. \u901a\u7528npm API\u6a21\u5757\u5c01\u88c5",id:"8-\u901a\u7528npm-api\u6a21\u5757\u5c01\u88c5",level:2},{value:"9. npm\u5168\u5c40\u66f4\u65b0\u529f\u80fd\u5f00\u53d1",id:"9-npm\u5168\u5c40\u66f4\u65b0\u529f\u80fd\u5f00\u53d1",level:2}],m={toc:u};function k(e){var n=e.components,i=(0,l.Z)(e,o);return(0,a.kt)("wrapper",(0,r.Z)({},m,i,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u811a\u624b\u67b6\u62c6\u5305\u7b56\u7565"},"\u811a\u624b\u67b6\u62c6\u5305\u7b56\u7565"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6838\u5fc3\u6d41\u7a0b\uff1acore")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u547d\u4ee4: commands")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316"),(0,a.kt)("li",{parentName:"ul"},"\u53d1\u5e03"),(0,a.kt)("li",{parentName:"ul"},"\u6e05\u9664\u7f13\u5b58"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6a21\u578b\u5c42: models")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Command \u547d\u4ee4"),(0,a.kt)("li",{parentName:"ul"},"Project \u9879\u76ee"),(0,a.kt)("li",{parentName:"ul"},"Component \u7ec4\u4ef6"),(0,a.kt)("li",{parentName:"ul"},"Npm \u6a21\u5757"),(0,a.kt)("li",{parentName:"ul"},"Git \u4ed3\u5e93"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u652f\u6491\u6a21\u5757: utils")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Git \u64cd\u4f5c"),(0,a.kt)("li",{parentName:"ul"},"\u4e91\u6784\u5efa"),(0,a.kt)("li",{parentName:"ul"},"\u5de5\u5177\u65b9\u6cd5"),(0,a.kt)("li",{parentName:"ul"},"API \u8bf7\u6c42"),(0,a.kt)("li",{parentName:"ul"},"Git API")))),(0,a.kt)("h1",{id:"core-\u6a21\u5757\u6280\u672f\u65b9\u6848"},"core \u6a21\u5757\u6280\u672f\u65b9\u6848"),(0,a.kt)("p",null,"core \u6a21\u5757\u7684\u6280\u672f\u65b9\u6848\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff0c\u5206\u522b\u662f",(0,a.kt)("strong",{parentName:"p"},"\u51c6\u5907\u9636\u6bb5\u3001\u547d\u4ee4\u6ce8\u518c\u3001\u547d\u4ee4\u6267\u884c"),"\u3002\u7b2c\u4e09\u5468\u7684\u8bfe\u7a0b\u5185\u5bb9\u4e3b\u8981\u662f\u8bb2\u51c6\u5907\u9636\u6bb5\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:t(95697).Z,width:"661",height:"874"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:t(3072).Z,width:"565",height:"177"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u51c6\u5907\u9636\u6bb5")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u68c0\u67e5root\u542f\u52a8\uff1a\u907f\u514d\u6743\u9650\u95ee\u9898\u3002\u5982\u679c\u662froot\u542f\u52a8\uff08mac root \u7528\u6237\u767b\u5f55\uff09\uff0c\u628a\u6743\u9650\u964d\u7ea7\u5230\u666e\u901a\u7528\u6237"),(0,a.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u7528\u6237\u4e3b\u76ee\u5f55\uff1a\u8981\u5f80\u4e3b\u76ee\u5f55\u5199\u5165\u7f13\u5b58\u3002\u8bbe\u8ba1",(0,a.kt)("strong",{parentName:"li"},"\u672c\u5730\u7f13\u5b58\u4f53\u7cfb"),"\u4e2d\u7684",(0,a.kt)("strong",{parentName:"li"},"\u672c\u5730\u6587\u4ef6")),(0,a.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u73af\u5883\u53d8\u91cf\uff1a\u672c\u5730\u7f13\u5b58\u9700\u8981"),(0,a.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u662f\u5426\u4e3a\u6700\u65b0\u7248\u672c\uff1a\u68c0\u67e5cli\u7248\u672c"),(0,a.kt)("li",{parentName:"ul"},"\u63d0\u793a\u66f4\u65b0\uff1a\u66f4\u65b0cli")))),(0,a.kt)("h1",{id:"\u6d89\u53ca\u5230\u7684\u6280\u672f\u70b9"},"\u6d89\u53ca\u5230\u7684\u6280\u672f\u70b9"),(0,a.kt)("h4",{id:"\u6838\u5fc3\u5e93"},"\u6838\u5fc3\u5e93"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"import-local"),(0,a.kt)("li",{parentName:"ul"},"commander")),(0,a.kt)("h4",{id:"\u5de5\u5177\u5e93"},"\u5de5\u5177\u5e93"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"fs-extra (\u7528\u4e8e\u6587\u4ef6\u64cd\u4f5c\uff0c\u57fa\u4e8e fs \u5c01\u88c5\u7684\u5e93)"),(0,a.kt)("li",{parentName:"ul"},"dotenv (\u53ef\u4ee5\u83b7\u53d6\u5230\u73af\u5883\u53d8\u91cf)"),(0,a.kt)("li",{parentName:"ul"},"semver (\u6bd4\u8f83 package \u7684\u7248\u672c)"),(0,a.kt)("li",{parentName:"ul"},"root-check (\u8fdb\u884c root \u964d\u7ea7)"),(0,a.kt)("li",{parentName:"ul"},"user-home (\u62ff\u5230\u7528\u6237\u4e3b\u76ee\u5f55)"),(0,a.kt)("li",{parentName:"ul"},"colors (\u53ef\u4ee5\u5728\u7ec8\u7aef\u5f53\u4e2d\u6253\u5370\u4e0d\u540c\u989c\u8272\u7684\u6587\u672c)"),(0,a.kt)("li",{parentName:"ul"},"npmlog (\u6253\u5370\u65e5\u5fd7\u7528\uff0c\u53ef\u4ee5\u8fdb\u884c\u5b9a\u5236)")),(0,a.kt)("h1",{id:"\u62c6\u5206\u539f\u5219"},"\u62c6\u5206\u539f\u5219"),(0,a.kt)("p",null,"\u6839\u636e\u6a21\u5757\u7684\u529f\u80fd\u6765\u62c6\u5206"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"core: \u6838\u5fc3\u6a21\u5757")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u547d\u4ee4\u6a21\u5757\uff1acommands")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u6a21\u578b\u6a21\u5757\uff1amodels")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u5de5\u5177\u6a21\u5757\uff1autils"))),(0,a.kt)("h1",{id:"\u51c6\u5907\u9636\u6bb5"},"\u51c6\u5907\u9636\u6bb5"),(0,a.kt)("h2",{id:"1-\u9879\u76ee\u521d\u59cb\u5316"},"1. \u9879\u76ee\u521d\u59cb\u5316"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u9996\u5148\u521b\u5efa\u4e00\u4e2alerna\u9879\u76ee: learn init cli-dev"),(0,a.kt)("li",{parentName:"ol"},"\u6839\u76ee\u5f55\u4e0b\u521b\u5efa",(0,a.kt)("strong",{parentName:"li"},"core"),"\uff0c",(0,a.kt)("strong",{parentName:"li"},"utils"),"\uff0c",(0,a.kt)("strong",{parentName:"li"},"models"),"\uff0c",(0,a.kt)("strong",{parentName:"li"},"commands"),"\u6587\u4ef6\u5939\uff0c\u5e76\u4fee\u6539",(0,a.kt)("strong",{parentName:"li"},"lerna.json"),"\u914d\u7f6e\u5982\u4e0b\uff1a")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "packages": [\n    "core/*",\n    "commands/*",\n    "models/*",\n    "utils/*"\n  ],\n  "version": "1.0.4"\n}\n')),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5c06\u539f\u9879\u76ee",(0,a.kt)("strong",{parentName:"li"},"packages\u4e0b\u7684core"),"\u79fb\u5165\u5230",(0,a.kt)("strong",{parentName:"li"},"\u521b\u5efa\u7684core\u76ee\u5f55\u4e0b"),"\uff0c\u540c\u65f6\u5c06",(0,a.kt)("strong",{parentName:"li"},"packages\u4e0b\u7684utils\u4e0b"),"\uff0c\u4fee\u6539core\u9879\u76ee\u4e3a",(0,a.kt)("strong",{parentName:"li"},"cli"),",\u5982\u4e0b\u56fe\uff1a")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:t(87694).Z,width:"245",height:"315"})),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5728cli/bin/index.js\u4ee3\u7801\u5982\u4e0b\uff1a")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"#!/usr/bin/env node\nconst utils = require('intest-cli-dev-utils')\n// console.log('111')\n// console.log(utils)\n\nconst importLocal = require('import-local')\nconst npmlog = require('npmlog')\nif(importLocal(__filename)) {\n    npmlog.info('cli', '\u6b63\u5728\u4f7f\u7528\u672c\u5730\u7248\u672c')\n} else {\n    require('../lib')(process.argv.slice(2))\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"import-local\u7684\u4f5c\u7528\u5f53\u5168\u5c40node_modules\u548c\u672c\u5730node_modules\u4e2d\uff0c\u5b58\u5728\u76f8\u540c\u7684\u5e93\uff0c\u5219\u4f18\u5148\u52a0\u8f7d\u672c\u5730node_modules\u4e2d\u7684\u5e93"))," ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"npmlog\u6253\u5370\u5de5\u5177"))),(0,a.kt)("h2",{id:"2-\u68c0\u67e5\u7248\u672c\u53f7\u5f00\u53d1"},"2. \u68c0\u67e5\u7248\u672c\u53f7\u5f00\u53d1"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u68c0\u67e5\u7248\u672c\u53f7\u5f00\u53d1")," \u5728core/cli/lib/index.js\u4e0b\u5199\u5165\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"  const pkg = require('../package.json')\n  function checkPkgVersion() {\n      const { version } = pkg\n      // log.notice('cli', version)\n  }\n")),(0,a.kt)("p",null,"\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u83b7\u53d6\u5230\u914d\u7f6e\u6587\u4ef6package.json\u7684\u7248\u672c\u53f7"),(0,a.kt)("h3",{id:"require\u52a0\u8f7d\u8d44\u6e90\u65b9\u5f0f"},"require\u52a0\u8f7d\u8d44\u6e90\u65b9\u5f0f"),(0,a.kt)("p",null,"\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u9700\u8981\u8003\u8651require\u52a0\u8f7d\u8d44\u6e90\u7684\u65b9\u5f0f"),(0,a.kt)("p",null,"require\u53ef\u52a0\u8f7d\u7684\u8d44\u6e90\u6587\u4ef6\u6709.js, .json, .node"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u52a0\u8f7d.js\u65f6\u9700\u8981\u6211\u4eec\u5fc5\u987b\u5728",(0,a.kt)("strong",{parentName:"li"},"js\u6587\u4ef6"),"\u4e2d\uff0c\u4f7f\u7528module.exports=any\u6216\u8005exports.\u8f93\u51fa"),(0,a.kt)("li",{parentName:"ul"},"\u52a0\u8f7d.json\u65f6\u4f1a\u4f7f\u7528JSON.parse\u8fdb\u884c\u8f6c\u8bd1\u4ece\u800c\u5f97\u5230\u4e00\u4e2ajson\u5bf9\u8c61"),(0,a.kt)("li",{parentName:"ul"},".node\u662f\u4e00\u4e2a",(0,a.kt)("strong",{parentName:"li"},"c++\u63d2\u4ef6"))),(0,a.kt)("p",null,"\u5982\u679c\u6211\u4eec\u52a0\u4e00\u4e2a",(0,a.kt)("strong",{parentName:"p"},"txt"),"\u6587\u4ef6\uff0c\u6682\u4e14\u547d\u540d\u4e3atest.txt\uff0c\u5176\u5185\u5bb9\u5982\u4e0b:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"module.exports = function test() {\n   console.log('11')\n}\n")),(0,a.kt)("p",null,"\u6211\u4eec\u4f7f\u7528",(0,a.kt)("strong",{parentName:"p"},"require('./test.txt')()"),"\uff0c\u8fd9\u4e2a\u65f6\u5019\u4ee3\u7801\u4f9d\u7136\u4f1a\u6267\u884c\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\u539f\u6765\u6211\u4eec\u662f\u4f7f\u7528",(0,a.kt)("strong",{parentName:"p"},"require"),"\u7684\u65f6\u5019\uff0c\u5982\u679c\u52a0\u8f7d\u7684\u6587\u4ef6\u4e0d\u662f\u4e0a\u8ff0\u4e09\u79cd\u683c\u5f0f\u7684\u6587\u4ef6\uff0c",(0,a.kt)("strong",{parentName:"p"},"\u4f1a\u9ed8\u8ba4\u5f53\u6210js\u6587\u4ef6\u8fdb\u884c\u89e3\u6790")),(0,a.kt)("h3",{id:"npmlog\u4f7f\u7528"},"npmlog\u4f7f\u7528"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"default level: info\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f20\u5165\u7684\u53c2\u6570\u8fdb\u884clevel\u5b9a\u5236\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u6e90\u7801\u4e2d\u5b58\u5728\u7684 log.addLevel()\u624d\u53ef\u4ee5\u6253\u5370\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u5b9a\u5236\u81ea\u5df1\u7684\u6253\u5370\u8bbe\u7f6e\u3002\uff08\u53ef\u4ee5\u8bbe\u7f6e\u540d\u5b57\u3001value\u503c\u5927\u5c0f\uff0c\u5b57\u4f53\u8272\u3001\u80cc\u666f\u8272\u7b49\uff09"),(0,a.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u901a\u8fc7 log.heading\u5b9a\u5236\u8f93\u65e5\u5fd7\u8f93\u51fa\u7684\u524d\u7f6e\u3002\u540c\u65f6\u53ef\u4ee5\u901a\u8fc7headingStyle\u505a\u6837\u5f0f\u4fee\u6539\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"'use strict';\n\nconst log = require('npmlog')\n\n// \u5b9a\u5236log\n// \u964d\u7ea7\u5904\u7406 log \u6dfb\u52a0debug\u6a21\u5f0f\nlog.level = process.env.LOG_LEVEL || 'info'\n// \u4fee\u6539\u524d\u7f00\nlog.heading = 'ynzy'\n// \u6dfb\u52a0\u81ea\u5b9a\u4e49log\nlog.addLevel('success', 2000, { fg: 'green', bold: true })\n\nmodule.exports = log;\n")),(0,a.kt)("p",null,"\u5982\u4f55\u5728\u9879\u76ee\u4f7f\u7528intest-cli-dev-log\u6a21\u5757\u5462"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u9996\u5148\u5728core/cli/package.json\u4e0b,\u81ea\u52a8\u5f15\u5165,",(0,a.kt)("strong",{parentName:"li"},"\u6ce8\u610ffile:../../utils/log\u662f\u5176\u76f8\u5bf9\u8def\u5f84\u76ee\u5f55"),"\uff0c\u5982\u4e0b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n...\n"dependencies": {\n    ...\n    "intest-cli-dev-log": "file:../../utils/log",\n  }\n}\n')),(0,a.kt)("p",null,"\u7136\u540e\u5728core/cli\u4e0bnpm link,\u6b64\u65f6\u5c31\u53ef\u4ee5\u5728core/cli\u4e2d\u4f7f\u7528\u4e86"),(0,a.kt)("h2",{id:"3-\u68c0\u67e5node\u7248\u672c-\u68c0\u67e5node\u7248\u672c\u53f7\u7684\u539f\u56e0\u4ee5\u53ca\u89e3\u51b3\u529e\u6cd5"},"3. \u68c0\u67e5Node\u7248\u672c \u68c0\u67e5Node\u7248\u672c\u53f7\u7684\u539f\u56e0\u4ee5\u53ca\u89e3\u51b3\u529e\u6cd5\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u8fd9\u662f\u56e0\u4e3a\u4e00\u4e9b\u4f4e\u7248\u672c\u7684Node API\u5728\u4f4e\u7248\u672c\u662f\u4e0d\u652f\u6301\u7684\uff0c\u56e0\u6b64\u8981\u8bbe\u7f6e\u4e00\u4e2a\u6700\u4f4e\u7684Node\u7248\u672c\u53f7\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u62ff\u5230\u672c\u5730\u7248\u672c\u53f7\u7684\u65b9\u6cd5\u4e3a\uff1aprocess.version"),(0,a.kt)("li",{parentName:"ul"},"\u7248\u672c\u53f7\u6bd4\u5bf9\uff1a\u7b2c\u4e09\u65b9\u5e93 semver\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u629b\u51fa\u5f02\u5e38\u989c\u8272\u8f93\u51fa\uff1a\u7b2c\u4e09\u65b9\u5e93 colors:\u5f15\u7528'colors/safe',\u4f7f\u7528\uff1acolors.red('')")),(0,a.kt)("p",null,"\u4f9d\u7136\u5728core/cli/lib/index.js\u4e0b\u521b\u5efa\u65b9\u6cd5",(0,a.kt)("strong",{parentName:"p"},"checkNodeVersion"),"\u65b9\u6cd5\uff0c\u901a\u8fc7semver\u5e93\uff08\u7528\u4e8e\u68c0\u6d4b\u7248\u672c\u53f7\u7684\u5e93\uff09\uff0c\u901a\u8fc7process.version\u83b7\u53d6node\u7248\u672c\uff0c\u4ee5\u53ca\u4ee3\u7801\u4e2d\u8bbe\u7f6e\u7684\u6700\u5bf9\u7248\u672c\u8fdb\u884c\u5224\u65ad\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const semver = require('semver')\nconst colors = require('colors/safe')\n\nconst LOW_NODE_VERSION = '8.0.0'\n\nfunction checkNodeVersion() {\n  // 1.\u83b7\u53d6\u5f53\u524dnode\u7248\u672c\u53f7\n  const currentVersion = process.version\n  // \u6bd4\u5bf9\u6700\u4f4e\u7248\u672c\n  const result = semver.gt(currentVersion, LOW_NODE_VERSION)\n  // console.log(chalk.red(result))\n  if (!result) {\n      throw new Error(colors.red('\u5f53\u524d\u7248\u672c\u8fc7\u4f4e\uff0c\u8bf7\u5347\u7ea7node\u7248\u672c\u3002 ') + colors.blue(`\u6700\u4f4e\u7248\u672c: ${LOW_NODE_VERSION}`))\n  }\n}\n\n\nfunction core(argv) {\n    try {\n        checkNodeVersion()\n    } catch (e) {\n        log.error(e.message)\n    }\n}\n")),(0,a.kt)("h2",{id:"4-root\u8d26\u53f7\u542f\u52a8\u68c0\u67e5\u548c\u81ea\u52a8\u964d\u7ea7\u529f\u80fd\u5f00\u53d1"},"4. root\u8d26\u53f7\u542f\u52a8\u68c0\u67e5\u548c\u81ea\u52a8\u964d\u7ea7\u529f\u80fd\u5f00\u53d1"),(0,a.kt)("p",null,"\u68c0\u67e5\u8d26\u53f7\u6743\u9650\u539f\u56e0\u4ee5\u53ca\u89e3\u51b3\u65b9\u6cd5\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5982\u679c\u662f\u4f7f\u7528root\u6743\u9650\uff0c\u4e00\u4e9b\u6587\u4ef6\u5c31\u6ca1\u6709\u53ef\u8bfb\u6216\u8005\u4fee\u6539\u6743\u9650\uff0c\u56e0\u6b64\u9700\u8981\u5bf9\u7528\u6237\u8fdb\u884c\u67e5\u8be2\u4e0e\u964d\u7ea7\u5904\u7406"),(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7process.geteuid() \u83b7\u53d6\u767b\u5f55\u7528\u6237\u7684ID ,501\u4e3a\u666e\u901a\u7528\u6237\uff0c0 \u4e3a\u8d85\u7ea7\u7ba1\u7406\u5458(root)"),(0,a.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u7b2c\u4e09\u65b9\u5e93\uff1aroot-check\u3002\u4f7f\u7528\u65b9\u6cd5\u5f15\u5165\u4e00\u4e0b\u8c03\u7528\u5373\u53ef\u964d\u7ea7\u3002"),(0,a.kt)("li",{parentName:"ul"},"root-check\u5b9e\u73b0\u539f\u7406\uff1a\u8c03\u7528downgrade-root \u5e93 -> \u5224\u65ad\u662f\u5426\u4e3aroot\u6743\u9650 -> \u82e5\u662f\u901a\u8fc7process.env.SUDO_UID\u6216\u8005\u9ed8\u8ba4 defaultUid() \u83b7\u53d6\u5404\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684uid")),(0,a.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528process.getuid()\u6765\u83b7\u53d6",(0,a.kt)("strong",{parentName:"p"},"uid"),",\u5982\u679c\u8fd4\u56de\u503c\u662f",(0,a.kt)("strong",{parentName:"p"},"0"),"\u5219\u8bf4\u660e\u8bf4\u8d85\u7ea7\u7ba1\u7406\u5458\uff0c\u5426\u5219\u662f\u4e00\u822c\u7528\u6237\u3002\u5f00\u53d1\u4e2d\u4e00\u822c\u662f\u4f7f\u7528\u4e00\u822c\u7528\u6237\u8fdb\u884c\u5f00\u53d1\uff0c\u5982\u679c\u9700\u8981\u964d\u7ea7\uff0c\u53ef\u4ee5\u4f7f\u7528root-check\u8fd9\u4e2a\u5e93\u8fdb\u884c\u5f00\u53d1\uff0c\u4f7f\u7528\u4e5f\u5f88\u7b80\u5355\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u68c0\u67e5root\nfunction checkRoot() {\n    // root \u542f\u52a8\u7684\u76ee\u5f55\u65e0\u6cd5\u64cd\u4f5c\uff0c\u9700\u8981\u8fdb\u884c\u964d\u7ea7\n    // sudo \u542f\u52a8 \u6253\u5370\u5c31\u662f 0  \u6b63\u5e38\u5c31\u662f 501\n    const rootCheck = require('root-check')\n    rootCheck()\n    // console.log(process.getuid());\n}\n")),(0,a.kt)("h2",{id:"5-\u7528\u6237\u4e3b\u76ee\u5f55\u68c0\u67e5\u529f\u80fd\u5f00\u53d1"},"5. \u7528\u6237\u4e3b\u76ee\u5f55\u68c0\u67e5\u529f\u80fd\u5f00\u53d1"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"user-home:\u53ef\u4ee5\u5b9e\u73b0\u8de8\u64cd\u4f5c\u7cfb\u7edf\u83b7\u53d6\u7528\u6237\u4e3b\u76ee\u5f55\u7684\u529f\u80fd\u3002"),(0,a.kt)("li",{parentName:"ul"},"path-exists:\u5224\u65ad\u6587\u4ef6\u76ee\u5f55\u662f\u5426\u5b58\u5728"),(0,a.kt)("li",{parentName:"ul"},"user-home\u5b9e\u73b0\uff1a\u8c03\u7528os-homedir\u5e93\uff0c\u518d\u8c03\u7528os\u5e93\uff0c\u82e5os\u5e93\u6709homedir\u76f4\u63a5\u8fd4\u56de\uff0c\u82e5\u6ca1\u6709\u76f4\u63a5\u62ffprocess.env.home(),\u8fd8\u662f\u6ca1\u6709\u5c31\u62fc\u63a5 \u2018/Users/'+process.env.USER"),(0,a.kt)("li",{parentName:"ul"},"path-exists\u5b9e\u73b0\uff1a\u76f4\u63a5\u8c03\u7528fs\u7684accessSync(path)\u65b9\u6cd5\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const chalk = require('chalk')\nconst pathExists = require('path-exists').sync // \u5224\u8bfb\u76ee\u5f55\u662f\u5426\u5b58\u5728\nconst userHome = require('user-home') // \u83b7\u53d6\u5f53\u524d\u7528\u6237\u4e3b\u76ee\u5f55\nfunction checkUserHome() {\n  if (!userHome || !pathExists(userHome)) {\n      throw new Error(chalk.red('\u5f53\u524d\u767b\u9646\u7528\u6237\u4e3b\u76ee\u5f55\u4e0d\u5b58\u5728\uff01'))\n  }\n}\n")),(0,a.kt)("h2",{id:"6-\u5165\u53c2\u68c0\u67e5\u548cdebug\u6a21\u5f0f\u5f00\u53d1"},"6. \u5165\u53c2\u68c0\u67e5\u548cdebug\u6a21\u5f0f\u5f00\u53d1"),(0,a.kt)("p",null,"\u8fd9\u91cc\u5c31\u8fdb\u884c\u5982\u53c2\u68c0\u67e5\uff0c\u662f\u8981\u5224\u65ad\u662f\u5426\u8fdb\u5165\u8c03\u8bd5\u6a21\u5f0f\uff0c\u5982\u679c\u5e26\u6709 --debug\u53c2\u6570\uff0c\u6211\u4eec\u8981\u8fdb\u884clog\u7684level\u8bbe\u7f6e\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u65b9\u5f0f\uff1a\u4f7f\u7528minimist\u7b2c\u4e09\u65b9\u5e93\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u67e5\u770b\u662f\u5426\u5305\u542bdebug\u53c2\u6570\uff0c\u76f4\u63a5\uff1arequire('minimist')(process.argv.slice(2)).debug\u5373\u53ef\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u82e5\u4e0a\u503c\u4e3atrue\uff0c\u76f4\u63a5\u4fee\u6539log.level\u5373\u53ef\u3002")),(0,a.kt)("p",null,"\u5165\u53e3\u53c2\u6570\u5c31\u662f\u6211\u4eec\u5728\u7ec8\u7aef\u4e0a\u8f93\u5165\u7684\u6307\u4ee4\u4f8b\u5982\uff1avue create project,\u6211\u4eec\u53ef\u4ee5\u5f97\u5230",(0,a.kt)("strong",{parentName:"p"},"create"),"\u548c",(0,a.kt)("strong",{parentName:"p"},"project"),"\u53c2\u6570"),(0,a.kt)("p",null,"\u6211\u4eec\u5982\u4f55\u5f97\u5230\u5165\u53e3\u53c2\u6570\u5462\uff1f\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528minimist\u8fd9\u4e2a\u5e93\u6765\u83b7\u53d6\u5165\u53e3\u53c2\u6570\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const args = require('minimist')(process.argv.slice(2))\nconst log = require('intest-cli-dev-log')\nfunction checkInputArgs() {\n    checkArgs()\n}\n// \u8bbe\u7f6edebug\nfunction checkArgs() {\n    if(args.debug) {\n        process.env.LOG_LEVEL = 'verbose'\n    } else {\n        process.env.LOG_LEVEL = 'info'\n    }\n    log.level = process.env.LOG_LEVEL\n}\n")),(0,a.kt)("h2",{id:"7-\u73af\u5883\u53d8\u91cf\u68c0\u67e5\u529f\u80fd\u5f00\u53d1"},"7. \u73af\u5883\u53d8\u91cf\u68c0\u67e5\u529f\u80fd\u5f00\u53d1"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u68c0\u67e5\u73af\u5883\u53d8\u91cf\uff0c\u6211\u4eec\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93\uff1adotenv\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u7528\u6cd5\uff1arequire('dotenv').config({ path: '' }) \uff1a\u82e5\u4e0d\u4f20\u53c2\u6570\uff0c\u6211\u4eec\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u62ff\u5230.env\u6587\u4ef6\u4e2d\u7684\u53d8\u91cf\uff0c\u4e4b\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728process.env\u4e2d\u4f7f\u7528\u4e86\u3002\u652f\u6301\u4f20\u5165path\u53d8\u91cf\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u73af\u5883\u53d8\u91cf\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf,\u5982\u679c\u6211\u4eec\u6709\u5f88\u591a\u7684\u73af\u5883\u53d8\u91cf\u9700\u8981\u4f7f\u7528\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728.env\u6587\u4ef6\u5b8f\u8fdb\u884c\u914d\u7f6e")),(0,a.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528dotenv\u8fdb\u884c\u8bfb\u53d6.env\u7684\u914d\u7f6e\u5185\u5bb9\uff0c\u5177\u4f53\u65b9\u6cd5\u53ef\u4ee5\u53c2\u8003",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/dotenv"},"dotenv\u5b98\u65b9\u6587\u6863")," \u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u68c0\u67e5\u73af\u5883\u53d8\u91cf\nfunction checkEnv() {\n    const dotenv = require('dotenv')\n    const dotenvPath = path.resolve(userHome, '.env')\n    if (pathExists(dotenvPath)) {\n        dotenv.config({\n            path: dotenvPath\n        })\n    }\n    createDefaultConfig() // \u8bbe\u7f6e\u9ed8\u8ba4\u914d\u7f6e\n\n    log.verbose('\u73af\u5883\u53d8\u91cf', process.env.CLI_HOME_PATH)\n}\n\n// \u8bbe\u7f6e\u9ed8\u8ba4\u7684\u73af\u5883\u53d8\u91cf\nfunction createDefaultConfig() {\n    const cliConfig = {\n        home: userHome,\n    }\n    if (process.env.CLI_HOME) {\n        cliConfig['cliHome'] = path.join(userHome, process.env.CLI_HOME)\n    } else {\n        cliConfig['cliHome'] = path.join(userHome, constant.DEFAULT_CLI_HOME)\n    }\n    // console.log(cliConfig)\n    process.env.CLI_HOME_PATH = cliConfig['cliHome']\n}\n")),(0,a.kt)("h2",{id:"8-\u901a\u7528npm-api\u6a21\u5757\u5c01\u88c5"},"8. \u901a\u7528npm API\u6a21\u5757\u5c01\u88c5"),(0,a.kt)("p",null,"\u51c6\u5907\u9636\u6bb5\u7684\u6700\u540e\u4e00\u4e2a\u529f\u80fd\uff1a\u68c0\u67e5\u6211\u4eec\u7684\u8fd9\u4e2a\u811a\u624b\u67b6\u662f\u5426\u4e3a\u6700\u65b0\u7248\u672c"),(0,a.kt)("p",null,"\u6b65\u9aa4\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u5f53\u524d\u7248\u672c\u53f7\u4e0e\u6a21\u5757\u540d: pkg.version | pkg.name"),(0,a.kt)("li",{parentName:"ol"},"\u8c03\u7528npm API\u83b7\u53d6\u6240\u6709\u6a21\u7248\u53f7\uff1a npm\u63d0\u4f9b\u4e86\u8fd9\u6837\u4e00\u4e2aAPI: ",(0,a.kt)("a",{parentName:"li",href:"https://registry.npmjs.org/cloudscope-cli/core"},"https://registry.npmjs.org/cloudscope-cli/core")," ,\u53ef\u4ee5\u83b7\u5f97\u8be5\u5305\u7684\u6240\u6709\u7248\u672c\u53f7,\u8981\u4ece\u8fd9\u91cc\u62ff\u5230\u6240\u6709\u7248\u672c\u53f7\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93 axios,\u540c\u65f6\u6211\u4eec\u4e5f\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u7528\u6765url\u62fc\u63a5\u7684\u5e93\uff1aurl-join\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u8fdb\u884c\u591a\u53c2\u6570\u7684\u62fc\u63a5\uff0c\u4ee5\u53ca\u6211\u4eec\u8fdb\u884c\u7248\u672c\u5bf9\u6bd4\u7684\u7b2c\u4e09\u65b9\u5e93 semver\u3002"),(0,a.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u6240\u6709\u7248\u672c\u53f7\uff0c\u6bd4\u5bf9\u54ea\u4e9b\u7248\u672c\u53f7\u662f\u5927\u4e8e\u5f53\u524d\u7248\u672c\u53f7"),(0,a.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u6700\u65b0\u7684\u7248\u672c\u53f7\uff0c\u63d0\u793a\u7528\u6237\u66f4\u65b0\u5230\u6b64\u7248\u672c\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"'use strict';\n\nconst axios = require('axios')\nconst urlJoin = require('url-join')\nconst semver = require('semver')\n\n// \u83b7\u53d6npm\u5305\u4fe1\u606f\nfunction getNpmInfo(npmName, registry) {\n    console.log(npmName);\n    if (!npmName) {\n        return null\n    }\n    registry = registry || getDefaultRegistry()\n    const npmInfoUrl = urlJoin(registry, npmName)\n    return axios.get(npmInfoUrl).then(response => {\n        if (response.status === 200) {\n            return response.data\n        }\n        return null\n    }).catch(err => {\n        return Promise.reject(err)\n    })\n}\n\n// \u83b7\u53d6\u9ed8\u8ba4npm\u4ed3\u5e93\u5730\u5740\nfunction getDefaultRegistry(isOriginal = false) {\n    return isOriginal ? 'https://registry.npmjs.org' : 'https://registry.npm.taobao.org/'\n}\n\n// \u83b7\u53d6npm\u6240\u6709\u7248\u672c\nasync function getNpmVersions(npmName, registry) {\n    const data = await getNpmInfo(npmName, registry)\n    if (data) {\n        return Object.keys(data.versions)\n    } else {\n        return []\n    }\n}\n\n// \u83b7\u53d6\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684\u7248\u672c\u53f7\nfunction getNpmSemverVersions(baseVersion, versions) {\n    return versions\n        .filter(version => semver.satisfies(version, `^${baseVersion}`))\n        .sort((a, b) => semver.gt(b, a))\n}\n\n// \u83b7\u53d6\u6ee1\u8db3\u6761\u4ef6\u7684\u6700\u5927\u7684\u7248\u672c\u53f7(\u8fc7\u6ee4\u4ee5\u540e)\nasync function getNpmSemverVersion(baseVersion, npmName, registry) {\n    const versions = await getNpmVersions(npmName, registry)\n    const newVersions = getNpmSemverVersions(baseVersion, versions)\n    // console.log(newVersions);\n    if (newVersions && newVersions.length > 0) {\n        return newVersions[0]\n    }\n}\n\nmodule.exports = {\n    getNpmInfo,\n    getNpmVersions,\n    getNpmSemverVersion\n}\n")),(0,a.kt)("h2",{id:"9-npm\u5168\u5c40\u66f4\u65b0\u529f\u80fd\u5f00\u53d1"},"9. npm\u5168\u5c40\u66f4\u65b0\u529f\u80fd\u5f00\u53d1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u68c0\u67e5\u5168\u5c40\u53d8\u91cf\u662f\u5426\u9700\u8981\u66f4\u65b0\nasync function checkGlobalUpdate() {\n    // 1. \u83b7\u53d6\u5f53\u524d\u7248\u672c\u53f7\u548c\u6a21\u5757\u540d\n    const currentVersion = pkg.version\n    const npmName = pkg.name\n    // 2. \u8c03\u7528npm API\uff0c\u83b7\u53d6\u6240\u6709\u7248\u672c\u53f7\n    // 3. \u63d0\u53d6\u6240\u6709\u7248\u672c\u53f7,\u6bd4\u5bf9\u54ea\u4e9b\u7248\u672c\u53f7\u5927\u4e8e\u5f53\u524d\u7248\u672c\u53f7\n    const { getNpmSemverVersion } = require('@cli-dev-zy/get-npm-info')\n    const lastVersion = await getNpmSemverVersion(currentVersion, npmName)\n    // 4. \u83b7\u53d6\u6700\u65b0\u7248\u672c\u53f7,\u63d0\u793a\u7528\u6237\u66f4\u65b0\u5230\u8be5\u7248\u672c\n    if (lastVersion && semver.gt(lastVersion, currentVersion)) {\n        log.warn('\u66f4\u65b0\u63d0\u793a', colors.yellow(dedent`\n        \u8bf7\u624b\u52a8\u66f4\u65b0 ${npmName}, \u5f53\u524d\u7248\u672c: ${currentVersion}, \u6700\u65b0\u7248\u672c: ${lastVersion}.\n        \u66f4\u65b0\u547d\u4ee4: npm install -g ${npmName}\n        ` ))\n    }\n}\n")))}k.isMDXComponent=!0},95697:function(e,n,t){n.Z=t.p+"assets/images/1623980435665-459c2c46-2ea7-4bc4-88ff-a009acfc9af0-e38224c12b8a81f22263d4392364e5d5.png"},3072:function(e,n,t){n.Z=t.p+"assets/images/1623980645162-56a730f2-69b8-40ca-8a7d-8f85d2b13526-6efa56cc689c41b620e8f74bab321c4d.png"},87694:function(e,n,t){n.Z=t.p+"assets/images/1623982881957-a4a579d0-619e-459d-88b7-7f9783d5ca1c-24feb5a08e0ee97a80b8259bb6857dfe.png"}}]);