"use strict";(self.webpackChunkfed_doc=self.webpackChunkfed_doc||[]).push([[57558],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return k}});var a=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var o=a.createContext({}),s=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=s(e.components);return a.createElement(o.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,i=e.originalType,o=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),c=s(t),k=l,N=c["".concat(o,".").concat(k)]||c[k]||m[k]||i;return t?a.createElement(N,r(r({ref:n},d),{},{components:t})):a.createElement(N,r({ref:n},d))}));function k(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var i=t.length,r=new Array(i);r[0]=c;var p={};for(var o in n)hasOwnProperty.call(n,o)&&(p[o]=n[o]);p.originalType=e,p.mdxType="string"==typeof e?e:l,r[1]=p;for(var s=2;s<i;s++)r[s]=t[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},15348:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return o},default:function(){return k},frontMatter:function(){return p},metadata:function(){return s},toc:function(){return m}});var a=t(87462),l=t(63366),i=(t(67294),t(3905)),r=["components"],p={},o=void 0,s={unversionedId:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1/Node\u591a\u8fdb\u7a0b",id:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1/Node\u591a\u8fdb\u7a0b",title:"Node\u591a\u8fdb\u7a0b",description:"Node \u591a\u8fdb\u7a0b\u5f00\u53d1\u5165\u95e8",source:"@site/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/1-\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1/100-Node\u591a\u8fdb\u7a0b.md",sourceDirName:"19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/1-\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1",slug:"/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1/Node\u591a\u8fdb\u7a0b",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1/Node\u591a\u8fdb\u7a0b",editUrl:"https://github.com/Guing/FED-DOC/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/1-\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1/100-Node\u591a\u8fdb\u7a0b.md",tags:[],version:"current",sidebarPosition:100,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"[\u52a0\u9910] Node \u8fdb\u9636\uff1a child_process \u6e90\u7801\u5206\u6790",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1/Node \u8fdb\u9636\uff1a child_process \u6e90\u7801\u5206\u6790"},next:{title:"\u7b14\u8bb0",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/\u811a\u624b\u67b6/4\u5468 \u811a\u624b\u67b6\u547d\u4ee4\u6ce8\u518c\u548c\u6267\u884c\u8fc7\u7a0b\u5f00\u53d1/\u7b14\u8bb0"}},d={},m=[{value:"Node \u591a\u8fdb\u7a0b\u5f00\u53d1\u5165\u95e8",id:"node-\u591a\u8fdb\u7a0b\u5f00\u53d1\u5165\u95e8",level:3},{value:"5-2 child_process\u5f02\u6b65\u65b9\u6cd5\u4f7f\u7528\u6559\u7a0b\uff08exec&amp;execFile\uff09",id:"5-2-child_process\u5f02\u6b65\u65b9\u6cd5\u4f7f\u7528\u6559\u7a0bexecexecfile",level:4},{value:"\u5f02\u6b65",id:"\u5f02\u6b65",level:5},{value:"\u540c\u6b65",id:"\u540c\u6b65",level:5},{value:"5-4 child_process fork\u7528\u6cd5\u53ca\u7236\u5b50\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236\u8bb2\u89e3",id:"5-4-child_process-fork\u7528\u6cd5\u53ca\u7236\u5b50\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236\u8bb2\u89e3",level:4},{value:"child_process\u5f02\u6b65\u6e90\u7801\u89e3\u6790",id:"child_process\u5f02\u6b65\u6e90\u7801\u89e3\u6790",level:3},{value:"\u6e90\u7801\u89e3\u8bfb\u89e3\u51b3\u7684\u95ee\u9898",id:"\u6e90\u7801\u89e3\u8bfb\u89e3\u51b3\u7684\u95ee\u9898",level:4},{value:"exec\u6e90\u7801\u89e3\u8bfb",id:"exec\u6e90\u7801\u89e3\u8bfb",level:4},{value:"<code>shell</code> \u7684\u4f7f\u7528",id:"shell-\u7684\u4f7f\u7528",level:4},{value:"<code>exec</code> \u6e90\u7801\u7cbe\u8bfb",id:"exec-\u6e90\u7801\u7cbe\u8bfb",level:4},{value:"node_process\u56de\u8c03\u8c03\u7528\u6d41\u7a0b",id:"node_process\u56de\u8c03\u8c03\u7528\u6d41\u7a0b",level:4},{value:"\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u6267\u884c\u987a\u5e8f",id:"\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u6267\u884c\u987a\u5e8f",level:4},{value:"<code>exec</code> \u6267\u884c\u548c\u56de\u8c03\u8111\u56fe",id:"exec-\u6267\u884c\u548c\u56de\u8c03\u8111\u56fe",level:4},{value:"<code>Buffer</code> \u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\u89e3\u7801\u5668",id:"buffer-\u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\u89e3\u7801\u5668",level:4},{value:"<code>fork</code> \u6e90\u7801\u89e3\u8bfb",id:"fork-\u6e90\u7801\u89e3\u8bfb",level:4},{value:"Node \u591a\u8fdb\u7a0b\u6e90\u7801\u603b\u7ed3",id:"node-\u591a\u8fdb\u7a0b\u6e90\u7801\u603b\u7ed3",level:4},{value:"child_process\u540c\u6b65\u6e90\u7801\u89e3\u6790",id:"child_process\u540c\u6b65\u6e90\u7801\u89e3\u6790",level:3},{value:"<code>execSync</code>\u3001 <code>execFileSync</code> \u548c <code>spawnSync</code> \u6267\u884c\u6d41\u7a0b",id:"execsync-execfilesync-\u548c-spawnsync-\u6267\u884c\u6d41\u7a0b",level:3},{value:"<code>execSync</code> \u3001 <code>execFileSync</code> \u548c <code>spawnSync</code> \u7684\u533a\u522b",id:"execsync--execfilesync-\u548c-spawnsync-\u7684\u533a\u522b",level:4},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:4},{value:"<code>cluster</code> \u5de5\u4f5c\u539f\u7406",id:"cluster-\u5de5\u4f5c\u539f\u7406",level:3},{value:"<code>require</code> \u52a0\u8f7d\u5185\u7f6e\u6a21\u5757\u89e3\u6790",id:"require-\u52a0\u8f7d\u5185\u7f6e\u6a21\u5757\u89e3\u6790",level:3},{value:"\u5224\u65ad\u5185\u7f6e\u6a21\u5757",id:"\u5224\u65ad\u5185\u7f6e\u6a21\u5757",level:4}],c={toc:m};function k(e){var n=e.components,p=(0,l.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},c,p,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"node-\u591a\u8fdb\u7a0b\u5f00\u53d1\u5165\u95e8"},"Node \u591a\u8fdb\u7a0b\u5f00\u53d1\u5165\u95e8"),(0,i.kt)("p",null,"Node\u591a\u8fdb\u7a0b\u6838\u5fc3\u662f\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5b50\u8fdb\u7a0b\u4f9d\u9644\u5728\u5f53\u524dNode\u8fdb\u7a0b\u4e0b\u9762"),(0,i.kt)("p",null,"\u6838\u5fc3\u7c7b\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"child_process")),(0,i.kt)("p",null,"\u6587\u6863\u8def\u5f84\uff1a",(0,i.kt)("a",{parentName:"p",href:"http://nodejs.cn/api/child_process.html"},"http://nodejs.cn/api/child_process.html")),(0,i.kt)("p",null,"\u5b50\u8fdb\u7a0b\u6982\u5ff5\uff1a\u662f\u7cfb\u7edf\u8fdb\u884c\u8d44\u6e90\u5206\u914d\u548c\u8c03\u5ea6\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u662f\u64cd\u4f5c\u7cfb\u7edf\u7ed3\u6784\u7684\u57fa\u7840"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u8fdb\u7a0b\u7684\u6982\u5ff5\u53ea\u8981\u6709\u4e24\u70b9")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u662f\u4e00\u4e2a\u5b9e\u4f53\u3002\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u90fd\u6709\u5b83\u7684\u5730\u5740\u7a7a\u95f4"),(0,i.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u662f\u4e00\u4e2a\u201c\u6267\u884c\u4e2d\u7684\u7a0b\u5e8f\u201d\uff0c\u5b58\u5728\u5d4c\u5957\u5173\u7cfb")),(0,i.kt)("p",null,"\u8fdb\u7a0b\u5f00\u7ebf\u7a0b\uff0c\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u533a\u522b\uff1f"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u67e5\u770b\u8fdb\u7a0b\uff08os\uff09")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ps -ef")," \u67e5\u770b\u6240\u6709\u8fdb\u7a0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"Last login: Sun Feb  7 15:42:44 on ttys002\njolly@JollydeMacBook-Pro jolly-cli-dev % ps -ef\n  UID   PID  PPID   C STIME   TTY           TIME CMD\n    0     1     0   0 301220  ??        14:35.92 /sbin/launchd\n    0   112     1   0 301220  ??         0:56.66 /usr/sbin/syslogd\n    0   113     1   0 301220  ??         2:26.60 /usr/libexec/UserEventAgent (System)\n    0   116     1   0 301220  ??         0:13.29 /System/Library/PrivateFrameworks/Uninstall.framework/Resources/uninstalld\n    0   117     1   0 301220  ??         0:54.79 /usr/libexec/kextd\n    0   118     1   0 301220  ??         5:35.10 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/FSEvents.framework/Versions/A/Support/fseventsd\n\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"UID \u83b7\u5f97\u6743\u9650\u7684\u7528\u6237\u7684UID"),(0,i.kt)("li",{parentName:"ul"},"PID \u8fdb\u7a0b\u7684ID",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ps -ef|grep PID")," \u53ef\u5e05\u9009\u51fa\u5bf9\u5e94\u8fdb\u7a0b"))),(0,i.kt)("li",{parentName:"ul"},"PPID \u7236\u8fdb\u7a0b\u7684ID\uff0c\u4f53\u73b0\u8fdb\u7a0b\u7684\u5d4c\u5957\u5173\u7cfb")),(0,i.kt)("p",null,"vscode \u542f\u52a8 ",(0,i.kt)("inlineCode",{parentName:"p"},"node")," \u8c03\u8bd5\u65f6\u7684\u7236\u5b50\u8fdb\u7a0b\u5173\u7cfb\u56fe\u3002\u4f53\u73b0\u4e86\u8fdb\u7a0b\u5d4c\u5957"),(0,i.kt)("p",null,(0,i.kt)("img",{src:t(70674).Z,width:"1658",height:"1112"})),(0,i.kt)("h4",{id:"5-2-child_process\u5f02\u6b65\u65b9\u6cd5\u4f7f\u7528\u6559\u7a0bexecexecfile"},"5-2 child_process\u5f02\u6b65\u65b9\u6cd5\u4f7f\u7528\u6559\u7a0b\uff08exec&execFile\uff09"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const cp = require('child_process');\n")),(0,i.kt)("p",null,"child_process\u7528\u6cd5:"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5f02\u6b65\u7528\u6cd5"),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"exec"),(0,i.kt)("li",{parentName:"ul"},"execFile"),(0,i.kt)("li",{parentName:"ul"},"fork"),(0,i.kt)("li",{parentName:"ul"},"spawn")),(0,i.kt)("p",{parentName:"blockquote"},"\u540c\u6b65\u7528\u6cd5"),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"execSync"),(0,i.kt)("li",{parentName:"ul"},"execFileSync"),(0,i.kt)("li",{parentName:"ul"},"spawnSync"))),(0,i.kt)("h5",{id:"\u5f02\u6b65"},"\u5f02\u6b65"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u547d\u4ee4"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"cp.exec('ls -la', function(err, stdout, stderr){\n  console.log('err: ', err); // \u9519\u8bef\n  console.log('stdout: ', stdout); // \u6b63\u5e38\u8fd0\u884c\u8f93\u51fa\u7684\u7ed3\u679c\uff0c\u540e\u9762\u4f1a\u6709\u4e2a\u6362\u884c\n  console.log('stderr: ', stderr); // \u5f02\u5e38\u8f93\u51fa\u7684\u7ed3\u679c\n});\n")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"jolly@JollydeMacBook-Pro child_process % node index.js \nerr:  null\nstdout:  total 8\ndrwxr-xr-x   3 jolly  staff   96  2  7 16:58 .\ndrwxr-xr-x  14 jolly  staff  448  2  7 16:58 ..\n-rw-r--r--   1 jolly  staff  189  2  7 16:59 index.js\n\nstderr:  \n")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a option \u5bf9\u8c61",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cwd")," \u8bbe\u7f6e\u6267\u884c\u7684\u76ee\u5f55"),(0,i.kt)("li",{parentName:"ul"},"timeout \u8bbe\u7f6e\u6267\u884c\u547d\u4ee4\u8d85\u65f6\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f0(\u4e0d\u8d85\u65f6)"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u6587\u4ef6"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u6709\u56db\u4e2a\u53c2\u6570")),(0,i.kt)("p",{parentName:"li"},"\u5982\u679c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e0d\u662f\u8def\u5f84\uff0c\u800c\u662f\u547d\u4ee4\uff0c\u90a3\u4e48\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"p"},"which \u547d\u4ee4")," \u627e\u5230\u5bf9\u5e94\u7684\u6587\u4ef6"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"cp.execFile('ls', ['-la'], function(err, stdout, stderr){\n  console.log('err: ', err);\n  console.log('stdout: ', stdout);\n  console.log('stderr: ', stderr);\n});\n")),(0,i.kt)("p",{parentName:"li"},"\u548c\u4e0a\u9762 ",(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u6267\u884c\u6548\u679c\u4e00\u6837"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\uff0c\u4f20\u5165\u6587\u4ef6\u7684\u53c2\u6570")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u7684\u533a\u522b"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u652f\u6301\u66f4\u590d\u6742\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u547d\u4ee4\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"ls -la|grep node_modules"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4f46 ",(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"[-la|grep node_modules]")," \u4f1a\u62a5\u9519\uff0c\u4e0d\u80fd\u6267\u884c\u6210\u529f\u3002\u56e0\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"grep")," \u4e0d\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u6267\u884c\u6587\u4ef6 ",(0,i.kt)("inlineCode",{parentName:"p"},"ls")," \u7684\u53c2\u6570")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53ef\u4ee5\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},".shell")," \u6587\u4ef6\uff1a\u5c06 ",(0,i.kt)("inlineCode",{parentName:"p"},"ls -al|grep node_modules")," \u5199\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},".shell")," \u6587\u4ef6\u4e2d"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"chmod +x test.shell")," \u6dfb\u52a0\u6267\u884c\u6743\u9650")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"test.shell")," \u6587\u4ef6\u5f53\u4e2d\u7684\u5185\u5bb9"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ls -la|grep node_modules\n\necho $1\n")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$1")," \u4ee3\u8868 ",(0,i.kt)("inlineCode",{parentName:"li"},"execFile")," \u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u4e5f\u80fd\u6267\u884c\u6307\u5b9a\u6587\u4ef6\uff0c\u4f46\u662f\u4e0d\u652f\u6301\u4f20\u5165\u53c2\u6570")))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"spwan")," \u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u6587\u4ef6"),(0,i.kt)("p",{parentName:"li"},"\u5982\u679c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e0d\u662f\u8def\u5f84\uff0c\u800c\u662f\u547d\u4ee4\uff0c\u90a3\u4e48\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"p"},"which \u547d\u4ee4")," \u627e\u5230\u5bf9\u5e94\u7684\u6587\u4ef6"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const child = cp.spawn(path.resolve(__dirname, 'test.shell'), ['-la'], {\n  cwd: path.resolve('.')\n})\nchild.stdout.on('data', function(chunk) {\n  console.log('stdout: ', chunk.toString()); //\u4e00\u6b21\u8f93\u51fa\u4e00\u4e2a\u5b57\u7b26\u4e32\n});\nchild.stderr.on('data', function(chunk) {\n  console.log('stderr: ', chunk.toString());\n});\nchild.on('error', e => { // \u76d1\u542c\u9519\u8bef\n  process.exit(1);\n});\nchild.on('exit', e => {// \u76d1\u542c\u6267\u884c\u6210\u529f\u540e\u7684\u9000\u51fa\u4e8b\u4ef6\n\n});\n")),(0,i.kt)("p",{parentName:"li"},"option\u53c2\u6570"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"stdio")," \u9009\u9879\u7528\u4e8e\u914d\u7f6e\u5728\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u4e4b\u95f4\u5efa\u7acb\u7684\u7ba1\u9053\u3002\u503c\uff1a",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"pipe")," \u9ed8\u8ba4\u503c\uff0c\u5728\u5b50\u8fdb\u7a0b\u548c\u7236\u8fdb\u7a0b\u4e4b\u95f4\u521b\u5efa\u4e00\u4e2a\u7ba1\u9053\u3002"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ignore")," \u9759\u9ed8\u6267\u884c\uff0c\u4e0d\u4f1a\u6536\u5230\u53cd\u9988"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"inherit")," \u5c06\u76f8\u5e94\u7684 stdio \u6d41\u4f20\u7ed9\u7236\u8fdb\u7a0b\u6216\u4ece\u7236\u8fdb\u7a0b\u4f20\u5165\u3002\u5c06\u8f93\u5165\u3001\u8f93\u51fa\u3001\u9519\u8bef\uff0c\u7ed1\u5b9a\u5230\u7236\u8fdb\u7a0b\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"process.stdin"),"\u3001 ",(0,i.kt)("inlineCode",{parentName:"li"},"process.stdout")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"process.stderr")," \u4e0a\u3002",(0,i.kt)("strong",{parentName:"li"},"\u76f4\u63a5\u80fd\u770b\u5230\u6253\u5370"),"\uff0c\u8fd8\u5e26\u52a8\u753b\uff08\u8fdb\u5ea6\uff09\u4fe1\u606f \u3002"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"fork")," \u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"node")," \u6267\u884c\u547d\u4ee4"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u53c2\u6570\uff1a\u6a21\u5757\u8def\u5f84"),(0,i.kt)("li",{parentName:"ul"},"\u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"require()")," \u7684\u533a\u522b",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"require")," \u52a0\u8f7d\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"js")," \u6a21\u5757\u662f\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u6267\u884c\u7684\u3002",(0,i.kt)("inlineCode",{parentName:"li"},"fork")," \u6d4b\u8bd5\u5728\u5b50\u8fdb\u7a0b\u4e2d\u7684\u6267\u884c\u7684\uff0c\u6267\u884c\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"js"),"\u6587\u4ef6 ",(0,i.kt)("inlineCode",{parentName:"li"},"process.pid")," \u4f1a\u53d1\u751f\u53d8\u5316\u3002")))),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const child = cp.fork(path.resolve(__dirname, 'child.js'));\n")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u9002\u5408\u6267\u884c\u8017\u65f6\u4efb\u52a1\u3002")))),(0,i.kt)("h5",{id:"\u540c\u6b65"},"\u540c\u6b65"),(0,i.kt)("p",null,"\u6267\u884c\u7b80\u5355 ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u547d\u4ee4"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execSync")," \u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u547d\u4ee4"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const stdout = cp.execSync('ls -la|grep node_modules');\nconsole.log(stdout.toString()); // stdout \u662f\u4e2a buffer\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execFileSync")," \u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u6587\u4ef6"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const stdout = cp.execFileSync('ls', ['-la']);\nconsole.log(stdout.toString()); // stdout \u662f\u4e2a buffer\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"spawnSync")," \u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u6587\u4ef6"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const ret = cp.spawnSync('ls', ['-la']);\nconsole.log(ret.stdout.toString()); // ret \u662f\u4e2a buffer\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"exec"),"\u3001",(0,i.kt)("inlineCode",{parentName:"strong"},"execFile"),"\u3001",(0,i.kt)("inlineCode",{parentName:"strong"},"fork")," \u5e95\u5c42\u90fd\u662f\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"strong"},"spawn")," \u7684"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u4f55\u65f6\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"strong"},"spawn"),"\u3001",(0,i.kt)("inlineCode",{parentName:"strong"},"exec"),"\u3001",(0,i.kt)("inlineCode",{parentName:"strong"},"execFile"))),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u9002\u5408\u8017\u65f6\u4efb\u52a1\uff08\u6bd4\u5982\uff1a",(0,i.kt)("inlineCode",{parentName:"li"},"npm install"),"\uff09\uff0c\u9700\u8981\u4e0d\u65ad\u65e5\u5fd7\u3002",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u9010\u6761\u6267\u884c\u547d\u4ee4"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"exec"),"/",(0,i.kt)("inlineCode",{parentName:"li"},"execFile"),"\uff1a\u5f00\u9500\u6bd4\u8f83\u5c0f\u7684\u4efb\u52a1\u3002\u6574\u4e2a\u6267\u884c\u5b8c\u540e\u8fd4\u56de"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"strong"},"path.resovle('./','shell.js')"),"\u65f6\u4f1a\u62a5\u9519\uff0c\u56e0\u4e3anode\u7684\u6267\u884c\u4e0a\u4e0b\u6587\uff0c\u4e0d\u4e00\u5b9a\u662f\u5f53\u524d\u76ee\u5f55\u3002\u8981\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"strong"},"__dirname"),"\uff0c\u6bd4\u5982 ",(0,i.kt)("inlineCode",{parentName:"strong"},"path.resovle(__dirname,'shell.js')"))))),(0,i.kt)("h4",{id:"5-4-child_process-fork\u7528\u6cd5\u53ca\u7236\u5b50\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236\u8bb2\u89e3"},"5-4 child_process fork\u7528\u6cd5\u53ca\u7236\u5b50\u8fdb\u7a0b\u901a\u4fe1\u673a\u5236\u8bb2\u89e3"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"fork\u4e3b\u8981\u662f\u4f7f\u7528node\u6765\u6267\u884c\u6211\u4eec\u7684\u547d\u4ee4\u3002"),(0,i.kt)("li",{parentName:"ul"},"fork\u4f1a\u6267\u884c\u4e24\u4e2a\u8fdb\u7a0b \u4e3b\u8fdb\u7a0b\u4e0e\u5b50\u8fdb\u7a0b\u3002"),(0,i.kt)("li",{parentName:"ul"},"fork\u7684\u672c\u8d28\u4e5f\u662f\u8c03\u7528spawn\u3002")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const child = cp.fork(path.resolve(__dirname, 'child.js'));\n\n// \u5411\u5b50\u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\nchild.send('hello child process', () => {\n  // child.disconnect(); // \u65ad\u5f00\u4e3b\u3001\u5b50\u8fdb\u7a0b\u76f4\u63a5\u7684\u8fde\u63a5\uff0c\u5426\u5219\uff0c\u547d\u4ee4\u884c\u5c06\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\n});\n\n// \u63a5\u53d7\u5b50\u8fdb\u7a0b\u6d88\u606f\nchild.on('mssage', msg => {\n  console.log('msg: ', msg);\n  child.disconnect();\n});\n\nconsole.log('main pid', process.pid);\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"child.js")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"console.log('child process');\n\nconsole.log('child pid', process.pid);\n\n// \u63a5\u53d7\u4e3b\u8fdb\u7a0b\u6d88\u606f\nprocess.on('message', msg => {\n  console.log('msg: ', msg);\n});\n\n// \u5411\u4e3b\u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\nprocess.send('hello main process');\n\n")),(0,i.kt)("p",null,"\u6267\u884c\u7ed3\u679c"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"jolly@JollydeMacBook-Pro child_process % node index.js\nmain pid 61868\nchild process\nchild pid 61869\nmsg:  hello child process\nmsg:  hello main process\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a\u5b50\u8fdb\u7a0b\u5411\u4e3b\u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\uff0c\u5bb9\u6613\u9020\u6210\u6b7b\u5faa\u73af")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"windows \u5b50\u8fdb\u7a0b\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"strong"},"node")," \u547d\u4ee4")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"cp.spawn('cmd', ['/c', 'node', '-e', code]); // '/c' \u8868\u793a\u9759\u9ed8\u6267\u884c\n")),(0,i.kt)("h3",{id:"child_process\u5f02\u6b65\u6e90\u7801\u89e3\u6790"},"child_process\u5f02\u6b65\u6e90\u7801\u89e3\u6790"),(0,i.kt)("h4",{id:"\u6e90\u7801\u89e3\u8bfb\u89e3\u51b3\u7684\u95ee\u9898"},"\u6e90\u7801\u89e3\u8bfb\u89e3\u51b3\u7684\u95ee\u9898"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"exec")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"execFile")," \u5230\u5e95\u6709\u4ec0\u4e48\u533a\u522b"),(0,i.kt)("li",{parentName:"ul"},"\u4e3a\u4ec0\u4e48 ",(0,i.kt)("inlineCode",{parentName:"li"},"exec")," / ",(0,i.kt)("inlineCode",{parentName:"li"},"execFile")," / ",(0,i.kt)("inlineCode",{parentName:"li"},"fork")," \u90fd\u662f\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u5b9e\u73b0\u7684\uff0c",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u7684\u4f5c\u7528\u5230\u5e95\u662f\u4ec0\u4e48\uff1f"),(0,i.kt)("li",{parentName:"ul"},"\u4e3a\u4ec0\u4e48 ",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u8c03\u7528\u540e\u6ca1\u6709\u56de\u8c03\uff0c\u800c ",(0,i.kt)("inlineCode",{parentName:"li"},"exec")," / ",(0,i.kt)("inlineCode",{parentName:"li"},"execFile")," \u80fd\u591f\u56de\u8c03\uff1f"),(0,i.kt)("li",{parentName:"ul"},"\u4e3a\u4ec0\u4e48 ",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u8c03\u7528\u540e\u9700\u8981\u624b\u52a8\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"child.stdout.on('data', callback)"),"\uff0c\u8fd9\u91cc\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"child.stdio")," / ",(0,i.kt)("inlineCode",{parentName:"li"},"child.stderr")," \u5230\u5e95\u662f\u4ec0\u4e48\uff1f"),(0,i.kt)("li",{parentName:"ul"},"\u4e3a\u4ec0\u4e48\u6709 ",(0,i.kt)("inlineCode",{parentName:"li"},"data")," / ",(0,i.kt)("inlineCode",{parentName:"li"},"error")," / ",(0,i.kt)("inlineCode",{parentName:"li"},"exit")," / ",(0,i.kt)("inlineCode",{parentName:"li"},"close")," \u8fd9\u4e48\u591a\u79cd\u56de\u8c03\uff0c\u5b83\u4eec\u7684\u6267\u884c\u987a\u5e8f\u5230\u5e95\u662f\u4ec0\u4e48\u600e\u6837\u7684\uff1f ")),(0,i.kt)("h4",{id:"exec\u6e90\u7801\u89e3\u8bfb"},"exec\u6e90\u7801\u89e3\u8bfb"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"\u6267\u884c\u6d41\u7a0b",src:t(23664).Z,width:"986",height:"814"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u7684\u533a\u522b\u5c31\u662f\u53c2\u6570\u7684\u533a\u522b")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u4e2d\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"spawn")," \u5e76\u4e14\u76d1\u542c\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"stderr")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"stdout")," \u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"data")," \u4e8b\u4ef6\uff0c\u6267\u884c\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u7684\u56de\u8c03\u51fd\u6570\u5c31\u662f\u8fd9\u4e2a\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u3002\u6240\u4ee5 ",(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u6709\u56de\u8c03\u51fd\u6570")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u65f6\uff0c\u6700\u540e\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"spawn")," \u89c4\u8303\u540e\u7684\u53c2\u6570"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{src:t(42590).Z,width:"1497",height:"451"})),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u51fa\u73b0\u4e86 ",(0,i.kt)("inlineCode",{parentName:"li"},"/bin/sh")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"envPairs")," \u662f\u73af\u5883\u53d8\u91cf"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"this._handle")," \u662f\u5b9e\u9645\u7684\u8fdb\u7a0b")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"child.spawn")," \u5b9e\u9645\u6267\u884c\u7684\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"this._handle.spawn"),"\uff0c\u6267\u884c\u540e\u5f00\u542f\u65b0\u8fdb\u7a0b")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"exec")," \u6267\u884c\u540e\u4e5f\u662f\u53ef\u4ee5\u5f97\u5230\u5b50\u8fdb\u7a0b\u5bf9\u8c61\u7684")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8bfe\u7a0b\u4e2d\u8c03\u8bd5\u6e90\u7801\u65f6\uff0c ",(0,i.kt)("inlineCode",{parentName:"p"},"ls -la|grep node_modules")," \u62a5\u9519\uff0c\u800c\u76f4\u63a5\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"bash")," \u4e2d\u8fd0\u884c\u4e0d\u62a5\u9519\uff0c\u662f\u56e0\u4e3a",(0,i.kt)("inlineCode",{parentName:"p"},"node")," \u6709\u6267\u884c\u7684\u73af\u5883\uff0c\u6267\u884c\u7684\u73af\u5883\u4e0d\u4e00\u6837(\u6267\u884c\u65f6\uff0c\u6240\u5728\u8def\u5f84\u4e0d\u4e00\u6837)"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u7edf\u4e00\u6267\u884c\u73af\u5883\u540e(\u6ca1\u6709node_modules\u6587\u4ef6\u5939)\uff0c",(0,i.kt)("inlineCode",{parentName:"li"},"bash")," \u4e2d\u4e0d\u4f1a\u62a5\u9519\uff0c\u4f46\u662f\u6ca1\u6709\u7ed3\u679c\u3002\u4f46\u8c03\u8bd5\u8fd8\u62a5\u9519\uff0c\u662f\u56e0\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"bash")," \u5904\u7406\u4e86\u9519\u8bef\u3002\u6211\u4eec\u4ee3\u7801\u4e2d\u8f93\u51fa\u4e86\u9519\u8bef\u800c\u5df2")))),(0,i.kt)("h4",{id:"shell-\u7684\u4f7f\u7528"},(0,i.kt)("inlineCode",{parentName:"h4"},"shell")," \u7684\u4f7f\u7528"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u65b9\u6cd5\u4e00\uff1a\u76f4\u63a5\u6267\u884cshell\u6587\u4ef6"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh test.shell\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u65b9\u6cd5\u4e8c\uff1a\u76f4\u63a5\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u8bed\u53e5"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'/bin/sh -c "ls -la"\n')),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6240\u4ee5\uff0c\u6ca1\u6709 ",(0,i.kt)("inlineCode",{parentName:"p"},"-c")," \u8981\u6307\u5b9a\u6587\u4ef6\u8def\u5f84")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"shell")," \u547d\u4ee4 ",(0,i.kt)("inlineCode",{parentName:"p"},"ls -la"),"  === ",(0,i.kt)("inlineCode",{parentName:"p"},'/bin/sh -c "ls -la"')))))),(0,i.kt)("h4",{id:"exec-\u6e90\u7801\u7cbe\u8bfb"},(0,i.kt)("inlineCode",{parentName:"h4"},"exec")," \u6e90\u7801\u7cbe\u8bfb"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5bf9\u8c61\u7684\u6269\u5c55\u8fd0\u7b97\u7b26\u8fdb\u884c\u6d45\u62f7\u8d1d"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'// \u7b49\u540c\u4e8e {...Object(true)}\n{...true} // {}\n\n// \u7b49\u540c\u4e8e {...Object(undefined)}\n{...undefined} // {}\n\n// \u7b49\u540c\u4e8e {...Object(null)}\n{...null} // {}\n\n{...\'hello\'}\n// {0: "h", 1: "e", 2: "l", 3: "l", 4: "o"}\n\n{ ...[\'a\', \'b\', \'c\'] };\n// {0: "a", 1: "b", 2: "c"}\n')),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6d45\u62f7\u8d1d\u548c\u6df1\u62f7\u8d1d"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u6d45\u62f7\u8d1d\uff1a\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u6709\u7740\u539f\u59cb\u5bf9\u8c61\u5c5e\u6027\u503c\u7684\u4e00\u4efd\u7cbe\u786e\u62f7\u8d1d\u3002\u5982\u679c\u5c5e\u6027\u662f\u57fa\u672c\u7c7b\u578b\uff0c\u62f7\u8d1d\u7684\u5c31\u662f\u57fa\u672c\u7c7b\u578b\u7684\u503c\uff0c\u5982\u679c\u5c5e\u6027\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u62f7\u8d1d\u7684\u5c31\u662f\u5185\u5b58\u5730\u5740 \uff0c\u6240\u4ee5\u5982\u679c\u5176\u4e2d\u4e00\u4e2a\u5bf9\u8c61\u6539\u53d8\u4e86\u8fd9\u4e2a\u5730\u5740\uff0c\u5c31\u4f1a\u5f71\u54cd\u5230\u53e6\u4e00\u4e2a\u5bf9\u8c61\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u6df1\u62f7\u8d1d\uff1a\u5c06\u4e00\u4e2a\u5bf9\u8c61\u4ece\u5185\u5b58\u4e2d\u5b8c\u6574\u7684\u62f7\u8d1d\u4e00\u4efd\u51fa\u6765\uff0c\u5305\u62ec\u5c5e\u6027\u6307\u5411\u7684\u5f15\u7528\u7c7b\u578b\uff0c\u4ece\u5806\u5185\u5b58\u4e2d\u5f00\u8f9f\u4e00\u4e2a\u65b0\u7684\u533a\u57df\u5b58\u653e\u65b0\u5bf9\u8c61\uff0c\u4e14\u4fee\u6539\u65b0\u5bf9\u8c61\u4e0d\u4f1a\u5f71\u54cd\u539f\u5bf9\u8c61"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u4efb\u4f55\u975e ",(0,i.kt)("inlineCode",{parentName:"p"},"function")," \u7c7b\u578b\uff0c\u90fd\u4f1a\u4ea7\u751f\u83b7\u5f97\u4e00\u4e2a\u5bf9\u8c61\u3002"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function normalizeExecArgs(command, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = undefined;\n  }\n\n  // \u6d45\u62f7\u8d1d\n  options = { ...options }; // \u5c06\u4efb\u610f\u975e function \u90fd\u5c06\u8f6c\u5316\u4e3a\u53c2\u6570\n  options.shell = typeof options.shell === 'string' ? options.shell : true; // \u5f97\u5230shell\u5c5e\u6027\u3002\n\n  return {\n    file: command,\n    options: options, // options \u81f3\u5c11\u6709\u4e00\u4e2a\u5c5e\u6027\uff1ashell\n    callback: callback\n  };\n}\n"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"option.shell")," \u53ef\u4ee5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u7528\u6765\u6267\u884c\u547d\u4ee4\u7684\u6587\u4ef6\u3002",(0,i.kt)("strong",{parentName:"p"},"\u9ed8\u8ba4\u503c:")," Unix \u4e0a\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"'/bin/sh'"),"\uff0cWindows \u4e0a\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"process.env.ComSpec"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execFile")," \u4e2d\u9996\u5148\u5bf9\u53c2\u6570\u9010\u4e2a\u5224\u65ad\uff0c\u5224\u65ad\u903b\u8f91\u6709\u70b9\u610f\u601d"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function execFile(file /* , args, options, callback */) {\n  let args = [];\n  let callback;\n  let options;\n\n  // \u89e3\u6790\u53ef\u9009\u53c2\u6570\uff08\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f shell \u6587\u4ef6\u8def\u5f84\uff09\uff0c\u4f7f\u7528argument\n  let pos = 1;\n  if (pos < arguments.length && Array.isArray(arguments[pos])) { // \u83b7\u5f97\u4f20\u5165shell\u6587\u4ef6\u7684\u53c2\u6570\n    args = arguments[pos++];\n  } else if (pos < arguments.length && arguments[pos] == null) { // \u7b2c\u4e8c\u4e2a\u53c2\u6570\u7ed9 null \u8df3\u8fc7\u7b2c\u4e8c\u4e2a\u53c2\u6570\u89e3\u6790\n    pos++;\n  }\n\n  if (pos < arguments.length && typeof arguments[pos] === 'object') { // \u53c2\u6570\u662f Object \u7c7b\u578b\uff0c\u8ba4\u4e3a\u662foptions\n    options = arguments[pos++];\n  } else if (pos < arguments.length && arguments[pos] == null) { // \u53c2\u6570\u503c\u662f null\uff0c\u8df3\u8fc7\n    pos++;\n  }\n\n  if (pos < arguments.length && typeof arguments[pos] === 'function') { // \u83b7\u5f97\u56de\u8c03\u51fd\u6570\n    callback = arguments[pos++];\n  }\n\n  if (!callback && pos < arguments.length && arguments[pos] != null) { // \u7ecf\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u4f20\u53c2\u4e86\u4f46\u6ca1\u6709\u89e3\u6790\u5230\u56de\u8c03\u51fd\u6570\uff0c\u62a5\u9519\u3002\n    throw new ERR_INVALID_ARG_VALUE('args', arguments[pos]);\n  }\n  ...\n}\n")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8fd9\u6837\u7684\u53c2\u6570\u89e3\u6790\uff0c\u53ef\u4ee5",(0,i.kt)("strong",{parentName:"p"},"\u4e0d\u7528\u56fa\u5b9a\u53c2\u6570\u7684\u987a\u5e8f"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u67e5\u770b ",(0,i.kt)("inlineCode",{parentName:"p"},"ERR_INVALID_ARG_VALUE")," \u7684\u62a5\u9519"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const cp = require('child_process');\n\ncp.exec('ls -la', null,'sdds');\n")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8981\u4f20\u5165\u7b2c\u4e8c\u4e2a\u53c2\u6570\u65f6\uff0c\u624d\u80fd\u770b\u89c1\u7b2c\u4e09\u4e2a\u53c2\u6570\u7684\u62a5\u9519\u3002\u539f\u56e0\u89c1\u201d\u5bf9\u8c61\u7684\u6269\u5c55\u8fd0\u7b97\u7b26\u201c"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"olly@192 child_process % node index.js\nchild_process.js:202\n    throw new ERR_INVALID_ARG_VALUE('args', arguments[pos]);\n    ^\n\nTypeError [ERR_INVALID_ARG_VALUE]: The argument 'args' is invalid. Received 'sdds'\n    at Object.execFile (child_process.js:202:11)\n    at Object.exec (child_process.js:145:25)\n    at Object.<anonymous> (/Users/jolly/Desktop/imooc/child_process/index.js:4:4)\n    at Module._compile (internal/modules/cjs/loader.js:959:30)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:995:10)\n    at Module.load (internal/modules/cjs/loader.js:815:32)\n    at Function.Module._load (internal/modules/cjs/loader.js:727:14)\n    at Function.Module.runMain (internal/modules/cjs/loader.js:1047:10)\n    at internal/main/run_main_module.js:17:11 {\n  code: 'ERR_INVALID_ARG_VALUE'\n}\n"))))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6570\u7ec4\u7684\u6d45\u62f7\u8d1d"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"//args = args.slice(0)\nvar a = [1, 2, 3];\nvar b = a.slice(0); // b: [1, 2, 3]\na === b; // false\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"spawn")," \u4e2d\u7684\u547d\u4ee4\u62fc\u63a5\u90e8\u5206"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"if (options.shell) {\n  const command = [file].concat(args).join(' '); // \u62fc\u63a5\u547d\u4ee4\u6587\u4ef6\u548c\u4f20\u5165\u7684\u53c2\u6570\n  // Set the shell, switches, and commands.\n  if (process.platform === 'win32') { // windows\n    if (typeof options.shell === 'string') // \u81ea\u5b9a\u4e49\u6267\u884cshell\u7684\u6587\u4ef6\n      file = options.shell;\n    else\n      file = process.env.comspec || 'cmd.exe';\n    // '/d /s /c' is used only for cmd.exe.\n    if (/^(?:.*\\\\)?cmd(?:\\.exe)?$/i.test(file)) { // \u5339\u914d\u4efb\u610f\u8def\u5f84\u4e0b\u7684 cmd.exe\u3002\u8fd9\u91cc\u6307\u5b9a\u4e86 cmd.exe \u7684\u8def\u5f84\n      args = ['/d', '/s', '/c', `\"${command}\"`]; // '/d /s /c' \u4ec5\u7528\u4e8e cmd.exe.\n      options.windowsVerbatimArguments = true; // options \u4e2d\u7684 windowsVerbatimArguments \u53c2\u6570\n    } else {\n      args = ['-c', command];\n    }\n  } else {\n    if (typeof options.shell === 'string')\n      file = options.shell;\n    else if (process.platform === 'android') // \u5b89\u5353\u7cfb\u7edf\n      file = '/system/bin/sh';\n    else\n      file = '/bin/sh'; // \u9ed8\u8ba4\u4f7f\u7528 '/bin/sh'\n    args = ['-c', command];\n  }\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"spawn")," \u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"new ChildProcess()")," "),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"EventEmitter.call(this);"),"  \u4e4b\u540e\uff0c\u53ef\u4ee5\u5206\u53d1\u4e8b\u4ef6\u4e86\u3002"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"emit")," \u5206\u53d1"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"on")," \u76d1\u542c"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"this._handle.onexit")," \u8fdb\u7a0b\u6267\u884c\u5b8c\u4e4b\u540e\u56de\u8c03")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"child.spawn "),"/ ",(0,i.kt)("inlineCode",{parentName:"p"},"ChildProcess.prototype.spawn")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"getValidStdio()")," \u521b\u5efa\u8f93\u5165\u8f93\u51fa\u9519\u8bef\u6d41"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8f93\u5165\u6d41\uff0c\u5b50\u8fdb\u7a0b\u53ea\u6709\u8bfb\u6743\u9650")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8f93\u51fa\u6d41\uff0c\u5b50\u8fdb\u7a0b\u53ea\u6709\u5199\u6743\u9650")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"new Pipe()")," \u521b\u5efa ",(0,i.kt)("inlineCode",{parentName:"p"},"socket")," \u901a\u4fe1\uff0c\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"pipe_wrap"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"ipc")," \u5efa\u7acb\u8fdb\u7a0b\u95f4\u7684\u53cc\u5411\u901a\u4fe1\uff0c\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"fork")," \u65f6\u521b\u5efa")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5faa\u73af\u5efa\u7acb\u7236\u5b50\u8fdb\u7a0b socket \u901a\u4fe1"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"socket \u5bf9\u8c61\u4f7f\u7528 on('data')\u76d1\u542c")))))))),(0,i.kt)("h4",{id:"node_process\u56de\u8c03\u8c03\u7528\u6d41\u7a0b"},"node_process\u56de\u8c03\u8c03\u7528\u6d41\u7a0b"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"node_process\u56de\u8c03\u8c03\u7528\u6d41\u7a0b",src:t(54183).Z,width:"1710",height:"1094"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Process \u6267\u884c\u547d\u4ee4",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"child._handle.spawn(options)")," \u6267\u884c\u547d\u4ee4 "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"exitCode")," \u4e3a0\uff0c\u8868\u793a\u6267\u884c\u6210\u529f\uff0c\u5c0f\u4e8e0\u8868\u793a\u5931\u8d25"))),(0,i.kt)("li",{parentName:"ul"},"\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\uff0c\u5f80\u201d\u6d41\u201c\u4e2d\u5199\u5165\u4fe1\u606f\uff0c\u56de\u8c03 ",(0,i.kt)("inlineCode",{parentName:"li"},"onStreamRead")," \u65b9\u6cd5\u8bfb\u53d6\u6d41\u4e2d\u4fe1\u606f"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"onStreamRead")," \u6bcf\u8bfb\u53d6\u5b8c\u4e00\u6761\u6d41\u4e2d\u4fe1\u606f\uff0c\u8c03\u7528\u4e00\u6b21 ",(0,i.kt)("inlineCode",{parentName:"li"},"onReadableStreamEnd")," "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"maybeClose()")," \u4e2d\uff0c\u5224\u65ad\u6240\u6709",(0,i.kt)("inlineCode",{parentName:"li"},"socket")," \u5173\u95ed\u540e\uff0c\u5173\u95ed\u5b50\u8fdb\u7a0b"),(0,i.kt)("li",{parentName:"ul"},"\u4e24\u6761\u7ebf\uff1a",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5b50\u8fdb\u7a0b\u7684\u6267\u884c\u7ebf"),(0,i.kt)("li",{parentName:"ul"},"\u6d41\u7684\u8bfb\u53d6\u7ebf")))),(0,i.kt)("h4",{id:"\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u6267\u884c\u987a\u5e8f"},"\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u6267\u884c\u987a\u5e8f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const child = cp.execFile('ls -la', function(err, stdout, stderr){\n  console.log('callback start-----------');\n  console.log('err: ', err);\n  console.log('stdout: ', stdout);\n  console.log('stderr: ', stderr);\n  console.log('callback end-----------');\n});\n\nchild.on('error', chunk => {\n  console.log('error! ', chunk);\n})\nchild.stdout.on('data', chunk => {\n  console.log('stdout data: ', chunk);\n});\n\nchild.stderr.on('data', chunk => {\n  console.log('stderr data: ', chunk);\n});\n\nchild.stdout.on('close', chunk => {\n  console.log('stdout close');\n});\n\nchild.stderr.on('close', chunk => {\n  console.log('stderr close');\n});\n\nchild.on('exit', (exitCode, signalCode) => {\n  console.log('exit! ', exitCode, ' ', signalCode);\n});\n\nchild.on('close', (exitCode, signalCode) => {\n  console.log('close! ', exitCode, ' ', signalCode);\n});\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"jolly@192 child_process % node index.js\nstdout data:  total 24\ndrwxr-xr-x   6 jolly  staff   192  2 10 15:11 .\ndrwxr-xr-x  14 jolly  staff   448  2  7 16:58 ..\ndrwxr-xr-x   3 jolly  staff    96  2 10 15:11 .vscode\n-rw-r--r--   1 jolly  staff   225  2  7 21:10 child.js\n-rw-r--r--   1 jolly  staff  1901  2 11 16:50 index.js\n-rwxr-xr-x   1 jolly  staff    15  2  7 20:19 test.shell\n\nexit!  0   null\nstderr close\ncallback start-----------\nerr:  null\nstdout:  total 24\ndrwxr-xr-x   6 jolly  staff   192  2 10 15:11 .\ndrwxr-xr-x  14 jolly  staff   448  2  7 16:58 ..\ndrwxr-xr-x   3 jolly  staff    96  2 10 15:11 .vscode\n-rw-r--r--   1 jolly  staff   225  2  7 21:10 child.js\n-rw-r--r--   1 jolly  staff  1901  2 11 16:50 index.js\n-rwxr-xr-x   1 jolly  staff    15  2  7 20:19 test.shell\n\nstderr:  \ncallback end-----------\nclose!  0   null\nstdout close\n")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"child\u56de\u8c03\u6267\u884c\u987a\u5e8f.png",src:t(76896).Z,width:"1708",height:"1448"})),(0,i.kt)("h4",{id:"exec-\u6267\u884c\u548c\u56de\u8c03\u8111\u56fe"},(0,i.kt)("inlineCode",{parentName:"h4"},"exec")," \u6267\u884c\u548c\u56de\u8c03\u8111\u56fe"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"exec \u6267\u884c\u548c\u56de\u8c03\u8111\u56fe",src:t(69475).Z,width:"8459",height:"6480"})),(0,i.kt)("p",null,"\u989c\u8272\u8bf4\u660e\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u9ec4\u8272\uff1a\u56de\u8c03\u6267\u884c\u8fc7\u7a0b"),(0,i.kt)("li",{parentName:"ul"},"\u7d2b\u8272\uff1a\u5e7f\u64ad\u4e8b\u4ef6"),(0,i.kt)("li",{parentName:"ul"},"\u7eff\u8272\uff1a\u8fdb\u7a0b ",(0,i.kt)("inlineCode",{parentName:"li"},"error")," \u6d41\u7a0b")),(0,i.kt)("p",null,"\u5173\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"stderr")," "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5f53\u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u5982 ",(0,i.kt)("inlineCode",{parentName:"li"},"lss -ls")," \u65f6",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ChildProcess.prototype.spawn()")," \u4e2d ",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"exitCode")," \u662f 0"),"\uff0c\u5e76\u4e0d\u5c0f\u4e8e0")))),(0,i.kt)("h4",{id:"buffer-\u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\u89e3\u7801\u5668"},(0,i.kt)("inlineCode",{parentName:"h4"},"Buffer")," \u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\u89e3\u7801\u5668"),(0,i.kt)("p",null,"\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"fork")," \u6d41\u7a0b\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"setupChannel(child, ipc)")," \u8bbe\u7f6e\uff0c\u5176\u4e2d\u6d89\u53ca ",(0,i.kt)("inlineCode",{parentName:"p"},"Buffer")," \u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\u89e3\u7801\u3002"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"string_decoder")," \u6a21\u5757\u63d0\u4f9b\u4e86\u4e00\u4e2a API\uff0c\u7528\u4e00\u79cd\u80fd\u4fdd\u62a4\u5df2\u7f16\u7801\u7684\u591a\u5b57\u8282 UTF-8 \u548c UTF-16 \u5b57\u7b26\u7684\u65b9\u5f0f\u5c06 ",(0,i.kt)("inlineCode",{parentName:"p"},"Buffer")," \u5bf9\u8c61\u89e3\u7801\u4e3a\u5b57\u7b26\u4e32\u3002\u57fa\u672c\u7528\u6cd5"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const { StringDecoder } = require('string_decoder');\nconst decoder = new StringDecoder('utf8');\n\nconst cent = Buffer.from([0xC2, 0xA2]);\nconsole.log(decoder.write(cent));\n\nconst euro = Buffer.from([0xE2, 0x82, 0xAC]);\nconsole.log(decoder.write(euro));\n")),(0,i.kt)("h4",{id:"fork-\u6e90\u7801\u89e3\u8bfb"},(0,i.kt)("inlineCode",{parentName:"h4"},"fork")," \u6e90\u7801\u89e3\u8bfb"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"fork\u6267\u884c\u8111\u56fe",src:t(87116).Z,width:"1759",height:"971"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5269\u4f59\u90e8\u5206\u89c1 ",(0,i.kt)("inlineCode",{parentName:"li"},"exec")," \u6267\u884c\u8111\u56fe"),(0,i.kt)("li",{parentName:"ul"},"stdio ",(0,i.kt)("inlineCode",{parentName:"li"},"ipc")," \u901a\u4fe1\uff1a",(0,i.kt)("inlineCode",{parentName:"li"},"[0, 1, 2, 'ipc']")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"process.execPath")," \u62ff\u5230 ",(0,i.kt)("inlineCode",{parentName:"li"},"node")," \u8def\u5f84"),(0,i.kt)("li",{parentName:"ul"},"\u91cd\u70b9 ",(0,i.kt)("inlineCode",{parentName:"li"},"getValidStdio(stdio, false)"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u6267\u884c",(0,i.kt)("inlineCode",{parentName:"li"},"setupChannel(this, ipc)"),"\uff0c\u589e\u5f3a ",(0,i.kt)("inlineCode",{parentName:"li"},"ipc")," \u529f\u80fd\uff0c\u5728\u7236\u3001\u5b50\u8fdb\u7a0b\u4e4b\u95f4\u542f\u52a8 ",(0,i.kt)("inlineCode",{parentName:"li"},"ipc"),"\uff1a",(0,i.kt)("inlineCode",{parentName:"li"},"channel.readStart()"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"new Control(channel)")," \u521b\u5efa ",(0,i.kt)("inlineCode",{parentName:"li"},"control")," \u5bf9\u8c61\uff0c\u7528\u4e8e\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"li"},"ipc")," \u7684",(0,i.kt)("inlineCode",{parentName:"li"},"ref")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"unref")," \u65b9\u6cd5"),(0,i.kt)("li",{parentName:"ul"},"\u6709\u6570\u636e\u8bfb\u53d6\u65f6\uff0c\u8fdb\u5165 ",(0,i.kt)("inlineCode",{parentName:"li"},"channel.onread")," "))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"child.send()")," \u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"target.send()")," \u8fdb\u884c\u8fdb\u7a0b\u901a\u4fe1\uff0c \u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"pipe ")," \u8fdb\u884c\u6570\u636e\u4f20\u9012"),(0,i.kt)("li",{parentName:"ul"},"\u5728\u6267\u884c\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"js")," \u6587\u4ef6\u4e2d\uff0c",(0,i.kt)("inlineCode",{parentName:"li"},"process.send()")," \u4e5f\u662f\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"target.send()")," \u8fdb\u884c\u901a\u4fe1")),(0,i.kt)("h4",{id:"node-\u591a\u8fdb\u7a0b\u6e90\u7801\u603b\u7ed3"},"Node \u591a\u8fdb\u7a0b\u6e90\u7801\u603b\u7ed3"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"exec/execFile/spawn/fork\u7684\u533a\u522b",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"exec")," : \u539f\u7406\u662f\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"bin/shell -c")," \u6267\u884c\u6211\u4eec\u4f20\u5165\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"shell")," \u811a\u672c\uff0c\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"execFile"),"\uff0c\u4f46\u4f20\u53c2\u505a\u4e86\u5904\u7406"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"execFile"),"\uff1a\u539f\u7406\u662f\u76f4\u63a5\u6267\u884c\u6211\u4eec\u4f20\u5165\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"file")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"args"),"\uff0c\u5e95\u5c42\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u521b\u5efa\u548c\u6267\u884c\u5b50\u8fdb\u7a0b\uff0c\u4f46\u901a\u8fc7\u76d1\u542c ",(0,i.kt)("inlineCode",{parentName:"li"},"spawn ")," \u4e2d\u5e7f\u64ad\u7684\u4e8b\u4ef6\uff0c\u5efa\u7acb\u4e86\u56de\u8c03\uff0c\u4e14\u4e00\u6b21\u6027\u5c06\u6240\u6709\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"stdout")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"stderr")," \u7ed3\u679c\u8fd4\u56de"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"spawn"),"\uff1a\u539f\u7406\u662f\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"internal/child_process"),"\uff0c\u5b9e\u4f8b\u5316\u4e86 ",(0,i.kt)("inlineCode",{parentName:"li"},"ChildProcess")," \u5b50\u8fdb\u7a0b\u5bf9\u8c61\uff0c\u518d\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"ChildProcess.prototype.spawn()")," \u521b\u5efa\u5b50\u8fdb\u7a0b\u5e76\u6267\u884c\u547d\u4ee4\uff0c\u5e95\u5c42\u8c03\u7528\u4e86 ",(0,i.kt)("inlineCode",{parentName:"li"},"child._handle.spawn()")," \u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"li"},"C++ process_wrap")," \u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u65b9\u6cd5\u3002\u6267\u884c\u8fc7\u7a0b\u662f\u5f02\u6b65\u7684\u3002\u6267\u884c\u5b8c\u540e\uff0c\u901a\u8fc7 pipe \u8fdb\u884c\u5355\u5411\u6570\u636e\u901a\u4fe1\uff0c\u901a\u4fe1\u7ed3\u675f\u540e\uff0c\u5b50\u8fdb\u7a0b\u53d1\u8d77 ",(0,i.kt)("inlineCode",{parentName:"li"},"child._handle.onexit")," \u56de\u8c03\uff0c\u540c\u65f6 socket \u4f1a\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"li"},"close")," \u56de\u8c03\u3002"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fork"),"\uff1a\u539f\u7406\u662f\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u521b\u5efa\u5b50\u8fdb\u7a0b\u548c\u6267\u884c\u547d\u4ee4\u3002\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"node")," \u6267\u884c\u547d\u4ee4\uff0c\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"li"},"setupchannel")," \u521b\u5efa ",(0,i.kt)("inlineCode",{parentName:"li"},"IPC")," \u7528\u4e8e\u5b50\u8fdb\u7a0b\u548c\u7236\u8fdb\u7a0b\u4e4b\u95f4\u7684\u53cc\u5411\u901a\u4fe1"))),(0,i.kt)("li",{parentName:"ul"},"data/error/exit/close\u56de\u8c03\u7684\u533a\u522b",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"data"),"\uff1a\u4e3b\u8fdb\u7a0b\u8bfb\u53d6\u6570\u636e\u8fc7\u7a0b\u4e2d\uff0c\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"li"},"onStreamRead")," \u53d1\u8d77\u56de\u8c03"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"error"),"\uff1a\u547d\u4ee4\u6267\u884c\u5931\u8d25\u540e\u53d1\u8d77\u7684\u56de\u8c03"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"exit"),"\uff1a\u5b50\u8fdb\u7a0b\u5173\u95ed\u5b8c\u6210\u540e\u53d1\u8d77\u7684\u56de\u8c03"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"close"),"\uff1a\u5b50\u8fdb\u7a0b\u6240\u6709 ",(0,i.kt)("inlineCode",{parentName:"li"},"Socket")," \u901a\u4fe1\u7aef\u53e3\u5168\u90e8\u5173\u95ed\u540e\u53d1\u8d77\u7684\u56de\u8c03"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"stdout close"),"/",(0,i.kt)("inlineCode",{parentName:"li"},"stderr close"),"\uff1a\u7279\u5b9a\u7684 PIPE \u8bfb\u53d6\u5b8c\u6210\u540e\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"onReadableStreamEnd()")," \u5173\u95ed ",(0,i.kt)("inlineCode",{parentName:"li"},"Socket")," \u65f6\u53d1\u8d77\u7684\u56de\u8c03\u3002")))),(0,i.kt)("h3",{id:"child_process\u540c\u6b65\u6e90\u7801\u89e3\u6790"},"child_process\u540c\u6b65\u6e90\u7801\u89e3\u6790"),(0,i.kt)("h3",{id:"execsync-execfilesync-\u548c-spawnsync-\u6267\u884c\u6d41\u7a0b"},(0,i.kt)("inlineCode",{parentName:"h3"},"execSync"),"\u3001 ",(0,i.kt)("inlineCode",{parentName:"h3"},"execFileSync")," \u548c ",(0,i.kt)("inlineCode",{parentName:"h3"},"spawnSync")," \u6267\u884c\u6d41\u7a0b"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Child_process\u540c\u6b65\u6e90\u7801\u89e3\u8bfb.png",src:t(44261).Z,width:"5079",height:"3483"})),(0,i.kt)("h4",{id:"execsync--execfilesync-\u548c-spawnsync-\u7684\u533a\u522b"},(0,i.kt)("inlineCode",{parentName:"h4"},"execSync")," \u3001 ",(0,i.kt)("inlineCode",{parentName:"h4"},"execFileSync")," \u548c ",(0,i.kt)("inlineCode",{parentName:"h4"},"spawnSync")," \u7684\u533a\u522b"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execSync")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"execFileSync")," \u5e95\u5c42\u90fd\u662f\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"spawnSync"),"\u3002\u4f46\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"execSync")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"execFileSync")," \u5728\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"spawnSync")," \u4e4b\u524d\u7684\u53c2\u6570\u89c4\u8303\u5316\u903b\u8f91\u4e0d\u4e00\u6837\uff1a"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"execSync ")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"exec")," \u90fd\u662f\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"normalizeExecArgs()")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"execFileSync")," \u3001 ",(0,i.kt)("inlineCode",{parentName:"li"},"spawn")," \u53ca ",(0,i.kt)("inlineCode",{parentName:"li"},"spawnSync")," \u8c03\u7528\u7684\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"normalizeSpawnArguments()")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"spawnSync")," \u8fd4\u56de\u7684\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"child_process.spawnSync(opts)")," \u4e2d ",(0,i.kt)("inlineCode",{parentName:"p"},"spawn_sync.spawn(options)")," (",(0,i.kt)("inlineCode",{parentName:"p"},"C++"),"  \u4ee3\u7801) \u6267\u884c\u8fd4\u56de\u7684\u7ed3\u679c ",(0,i.kt)("inlineCode",{parentName:"p"}," result"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execSync")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"execFileSync")," \u90fd\u5c06 ",(0,i.kt)("inlineCode",{parentName:"p"},"spawnSync")," \u7684\u6267\u884c\u7ed3\u679c\u505a\u4e86\u540c\u6837\u7684\u5904\u7406"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6709\u9519\u8bef\uff0c\u76f4\u63a5\u4ece\u4e3b\u8fdb\u7a0b ",(0,i.kt)("inlineCode",{parentName:"p"},"threw")," \u9519\u8bef"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"execFileSync('ls -la')")," \u627e\u4e0d\u5230\u6587\u4ef6\u65f6"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"result.error")," "),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"result.error",src:t(72638).Z,width:"1040",height:"704"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u9519\u8bef\u65e5\u5fd7"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"child_process.js:642\n    throw err;\n    ^\n\nError: spawnSync ls -la ENOENT\n    at Object.spawnSync (internal/child_process.js:1041:20)\n    at spawnSync (child_process.js:607:24)\n    at Object.execFileSync (child_process.js:634:15)\n    at Object.<anonymous> (/Users/jolly/Desktop/imooc/child_process/index.js:7:19)\n    at Module._compile (internal/modules/cjs/loader.js:959:30)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:995:10)\n    at Module.load (internal/modules/cjs/loader.js:815:32)\n    at Function.Module._load (internal/modules/cjs/loader.js:727:14)\n    at Function.Module.runMain (internal/modules/cjs/loader.js:1047:10)\n    at internal/main/run_main_module.js:17:11 {\n  errno: 'ENOENT',\n  code: 'ENOENT',\n  syscall: 'spawnSync ls -la',\n  path: 'ls -la',\n  spawnargs: [],\n  error: [Circular],\n  status: null,\n  signal: null,\n  output: null,\n  pid: 6262,\n  stdout: null,\n  stderr: null\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"result.stdout")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"result.stderr")," \u4e2d\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"null"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728\u547d\u4ee4\u672c\u8eab\u9519\u8bef\u65f6\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"lss -la")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"result.error = undefined")," "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"result.stdout")," \u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"ArrayBuffer")," \u4e3a\u7a7a"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"result.stderr")," \u4e2d ",(0,i.kt)("inlineCode",{parentName:"li"},"ArrayBuffer")," \u6709\u503c\u3002",(0,i.kt)("inlineCode",{parentName:"li"},"result.stderr")," \u4e2d\u7684\u4fe1\u606f\uff0c\u5c06\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"li"},"process.stderr.write(ret.stderr)")," \u6253\u5370\u5728\u4e3b\u8fdb\u7a0b\u7684\u65e5\u5fd7\u4e2d\uff1a",(0,i.kt)("inlineCode",{parentName:"li"},"/bin/sh: lss: command not found")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"result.status !== 0"),"\uff0c\u6253\u5370 ",(0,i.kt)("inlineCode",{parentName:"li"},"result.stderr")," \u4e4b\u540e\uff0cthrew \u9519\u8bef\u4fe1\u606f"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6ca1\u6709\u9519\u8bef\uff0c\u8fd4\u56de\u6267\u884c\u6210\u529f\u7684\u7ed3\u679c\u8f93\u51fa\u6d41 ",(0,i.kt)("inlineCode",{parentName:"p"},"stdout")))))),(0,i.kt)("h4",{id:"\u4f7f\u7528\u793a\u4f8b"},"\u4f7f\u7528\u793a\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const cp = require('child_process');\nconst path = require('path');\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execSync")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const stdout = cp.execSync('lss -la');\nconsole.log('stdout: ', stdout.toString()); // \u6709\u5f02\u5e38\u4e0d\u4f1a\u6267\u884c\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"execFileSync")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const stdout = cp.execFileSync(path.resolve(__dirname, 'test.shell'));\nconsole.log('stdout: ', stdout.toString()); // \u6709\u5f02\u5e38\u4e0d\u4f1a\u6267\u884c\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"spawnSync")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const result = cp.spawnSync(path.resolve(__dirname, 'test.shell'));\nif (result.status === 0) { // \u6ca1\u6709\u5f02\u5e38\n  console.log(result.stdout.toString())\n} else {\n  console.log(result)\n}\n")))),(0,i.kt)("h3",{id:"cluster-\u5de5\u4f5c\u539f\u7406"},(0,i.kt)("inlineCode",{parentName:"h3"},"cluster")," \u5de5\u4f5c\u539f\u7406"),(0,i.kt)("p",null,"  \u5355\u4e2a Node.js \u5b9e\u4f8b\u8fd0\u884c\u5728\u5355\u4e2a\u7ebf\u7a0b\u4e2d\u3002 \u4e3a\u4e86\u5145\u5206\u5229\u7528\u591a\u6838\u7cfb\u7edf\uff0c\u6709\u65f6\u9700\u8981\u542f\u7528\u4e00\u7ec4 Node.js \u8fdb\u7a0b\u53bb\u5904\u7406\u8d1f\u8f7d\u4efb\u52a1\u3002"),(0,i.kt)("p",null,"  ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster")," \u6a21\u5757\u53ef\u4ee5\u521b\u5efa\u5171\u4eab\u670d\u52a1\u5668\u7aef\u53e3\u7684\u5b50\u8fdb\u7a0b\u3002"),(0,i.kt)("p",null,"  \u5de5\u4f5c\u8fdb\u7a0b\u7531 ",(0,i.kt)("inlineCode",{parentName:"p"},"child_process.fork()")," \u65b9\u6cd5\u521b\u5efa\uff0c\u56e0\u6b64\u5b83\u4eec\u53ef\u4ee5\u4f7f\u7528 IPC \u548c\u7236\u8fdb\u7a0b\u901a\u4fe1\uff0c\u4ece\u800c\u4f7f\u5404\u8fdb\u7a0b\u4ea4\u66ff\u5904\u7406\u8fde\u63a5\u670d\u52a1\u3002"),(0,i.kt)("h3",{id:"require-\u52a0\u8f7d\u5185\u7f6e\u6a21\u5757\u89e3\u6790"},(0,i.kt)("inlineCode",{parentName:"h3"},"require")," \u52a0\u8f7d\u5185\u7f6e\u6a21\u5757\u89e3\u6790"),(0,i.kt)("h4",{id:"\u5224\u65ad\u5185\u7f6e\u6a21\u5757"},"\u5224\u65ad\u5185\u7f6e\u6a21\u5757"),(0,i.kt)("p",null,"  ",(0,i.kt)("strong",{parentName:"p"},"\u6e90\u7801")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function NativeModule(id) {\n  this.filename = `${id}.js`;\n  this.id = id;\n  this.exports = {};\n  this.module = undefined;\n  this.exportKeys = undefined;\n  this.loaded = false;\n  this.loading = false;\n  this.canBeRequiredByUsers = !id.startsWith('internal/');\n}\n\n// ...\n\nconst {\n  moduleIds,\n  compileFunction\n} = internalBinding('native_module');\n\nNativeModule.map = new Map();\nfor (let i = 0; i < moduleIds.length; ++i) {\n  const id = moduleIds[i];\n  const mod = new NativeModule(id);\n  NativeModule.map.set(id, mod);\n}\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"moduleIds"),"\uff1a\u5185\u7f6e\u6a21\u5757\u7684\u8def\u5f84+\u6587\u4ef6ming\u3002\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"p"},"C++")," \u4ee3\u7801\u62ff\u5230")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"this.canBeRequiredByUsers"),"\uff1a\u662f\u5426\u662f\u5185\u7f6e\u6a21\u5757\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"moduleIds")," \u4e2d\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"internal/")," \u6587\u4ef6\u5939\u4e0b\u90fd\u662f\u5185\u7f6e\u6a21\u5757"),(0,i.kt)("h3",{parentName:"li",id:"cluster-\u6267\u884c\u6d41\u7a0b"},(0,i.kt)("inlineCode",{parentName:"h3"},"cluster")," \u6267\u884c\u6d41\u7a0b"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"cluster\u6267\u884c\u8111\u56fe",src:t(49190).Z,width:"8575",height:"4053"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"cluter")," \u5bf9\u8c61\uff0c\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"EventEmitter")," \u5bf9\u8c61\u7684\u5b9e\u4f8b\uff0c\u5177\u6709 ",(0,i.kt)("inlineCode",{parentName:"p"},"event")," ",(0,i.kt)("inlineCode",{parentName:"p"},"emit"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"on")," \u7b49\u65b9\u6cd5")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"cluster.fork([env])")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"env")," ",(0,i.kt)("inlineCode",{parentName:"li"},"<object>")," \u8981\u6dfb\u52a0\u5230\u8fdb\u7a0b\u73af\u5883\u53d8\u91cf\u7684\u952e\u503c\u5bf9\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u8fd4\u56de\uff1a",(0,i.kt)("inlineCode",{parentName:"li"},"cluster.worker")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"cluster.setupMaster([settings])")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"settings")," ",(0,i.kt)("inlineCode",{parentName:"li"},"<object>")),(0,i.kt)("li",{parentName:"ul"},"\u7528\u4e8e\u4fee\u6539\u9ed8\u8ba4\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"fork")," \u884c\u4e3a\u3002 \u4e00\u65e6\u8c03\u7528\uff0c\u5c06\u4f1a\u6309\u7167 ",(0,i.kt)("inlineCode",{parentName:"li"},"settings")," \u5bf9 ",(0,i.kt)("inlineCode",{parentName:"li"},"cluster.settings")," \u8fdb\u884c\u8bbe\u7f6e\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u6240\u6709\u7684\u8bbe\u7f6e\u53ea\u5bf9\u540e\u6765\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},".fork()")," \u8c03\u7528\u6709\u6548\uff0c\u5bf9\u4e4b\u524d\u7684\u5de5\u4f5c\u8fdb\u7a0b\u65e0\u5f71\u54cd\u3002"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"process.execArgv")),(0,i.kt)("p",{parentName:"li"},"\u5c5e\u6027\u8fd4\u56de\u5f53\xb7Node.js \u8fdb\u7a0b\u88ab\u542f\u52a8\u65f6\uff0cNode.js \u7279\u5b9a\u7684\u547d\u4ee4\u884c\u9009\u9879\u3002 \u8fd9\u4e9b\u9009\u9879\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"process.argv")," \u5c5e\u6027\u8fd4\u56de\u7684\u6570\u7ec4\u4e2d\u4e0d\u4f1a\u51fa\u73b0\uff0c\u5e76\u4e14\u8fd9\u4e9b\u9009\u9879\u4e2d\u4e0d\u4f1a\u5305\u62ec ",(0,i.kt)("inlineCode",{parentName:"p"},"Node.js")," \u7684\u53ef\u6267\u884c\u811a\u672c\u540d\u79f0\u6216\u8005\u4efb\u4f55\u5728\u811a\u672c\u540d\u79f0\u540e\u9762\u51fa\u73b0\u7684\u9009\u9879\u3002 \u8fd9\u4e9b\u9009\u9879\u5728\u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\u662f\u6709\u7528\u7684\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5305\u542b\u4e86\u4e0e\u7236\u8fdb\u7a0b\u4e00\u6837\u7684\u6267\u884c\u73af\u5883\u4fe1\u606f\u3002"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ node --harmony script.js --version\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"process.execArgv")," \u7684\u7ed3\u679c\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"['--harmony']\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"process.argv")," \u7684\u7ed3\u679c\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"['/usr/local/bin/node', 'script.js', '--version']\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"setup")," \u4e8b\u4ef6"),(0,i.kt)("p",{parentName:"li"},"\u6bcf\u5f53 ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster.setupMaster()")," \u88ab\u8c03\u7528\u65f6\u89e6\u53d1\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"work.process")," \u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"child_process.fork()")," \u521b\u5efa\u7684\u8fdb\u7a0b")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728\u4e3b\u8fdb\u7a0b\u4e2d\uff0c\u8bbf\u95ee ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster.workers ")," \u83b7\u5f97\u5de5\u4f5c\u8fdb\u7a0b\u4fe1\u606f\u3002\u5176\u662f\u4e00\u4e2a\u54c8\u5e0c\u8868\uff0c\u50a8\u5b58\u4e86\u6d3b\u8dc3\u7684\u5de5\u4f5c\u8fdb\u7a0b\u5bf9\u8c61\uff0c\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," \u4f5c\u4e3a\u952e\u540d\u3002\u53ea\u80fd\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u8bbf\u95ee")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"internal/cluster/child.js")," \u89c4\u5b9a\u4e86\u5de5\u4f5c\u8fdb\u7a0b\u7684\u884c\u4e3a\uff0c\u8fd9\u91cc\u5b9a\u4e49\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster.worker"),"\uff0c\u4fdd\u5b58\u5de5\u4f5c\u8fdb\u7a0b\u5bf9\u8c61\u7684\u5f15\u7528\u3002 \u5728\u5de5\u7a0b\u8fdb\u7a0b\u4e2d\u53ef\u8bbf\u95ee\uff0c\u6307\u5411\u5f53\u524d\u5de5\u4f5c\u8fdb\u7a0b\u3002"),(0,i.kt)("h4",{parentName:"li",id:"\u7591\u95ee"},"\u7591\u95ee")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"workerProcess")," \u7531 ",(0,i.kt)("inlineCode",{parentName:"p"},"child_process.fork()")," \u521b\u5efa"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"'internalMessage'")," \u4e8b\u4ef6\u600e\u4e48\u89e6\u53d1\uff0c\u8fd4\u56de\u7684\u53c2\u6570 ",(0,i.kt)("inlineCode",{parentName:"li"},"message")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"handle")," \u662f\u4ec0\u4e48\uff1f"),(0,i.kt)("li",{parentName:"ul"},"\u5176 ",(0,i.kt)("inlineCode",{parentName:"li"},"send")," \u65b9\u6cd5\u5e72\u4e86\u5565\uff1f")),(0,i.kt)("p",{parentName:"li"},"\u89c1 ",(0,i.kt)("inlineCode",{parentName:"p"},"child_process")," \u5f02\u6b65\u6e90\u7801\u89e3\u6790\u6587\u7ae0 ",(0,i.kt)("inlineCode",{parentName:"p"},"fork")," \u90e8\u5206\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"setupChannel(child, ipc)")))))}k.isMDXComponent=!0},44261:function(e,n,t){n.Z=t.p+"assets/images/Child_process\u540c\u6b65\u89e3\u8bfb-3386def4ce189bab4025300e94947627.png"},76896:function(e,n,t){n.Z=t.p+"assets/images/child\u56de\u8c03\u6267\u884c\u987a\u5e8f-4513941074c0f1826d4db5a46243d38b.png"},49190:function(e,n,t){n.Z=t.p+"assets/images/cluster\u8111\u56fe-29ab888d06d1ab9a4d1b48ddddd86b2a.png"},23664:function(e,n,t){n.Z=t.p+"assets/images/exec\u6267\u884c\u6d41\u7a0b-aa2289486e4538755d2c952545737a9d.png"},69475:function(e,n,t){n.Z=t.p+"assets/images/exec\u89e3\u8bfb-c647e0f798057e2f551fb66133b66297.png"},87116:function(e,n,t){n.Z=t.p+"assets/images/fork\u8111\u56fe-4d764413523728bec61b78a4e748181d.png"},54183:function(e,n,t){n.Z=t.p+"assets/images/node_process\u56de\u8c03\u8c03\u7528\u6d41\u7a0b-355fc846601577052750a624fdd9590e.png"},70674:function(e,n,t){n.Z=t.p+"assets/images/process_all-caf40f6514c07ab26bab708b3dcc68be.png"},42590:function(e,n,t){n.Z=t.p+"assets/images/spawn\u89c4\u8303\u540e\u7684\u53c2\u6570-8448463340caf72bbd76b5fe5a39ae4d.png"},72638:function(e,n,t){n.Z=t.p+"assets/images/\u540c\u6b65\u5b50\u8fdb\u7a0bresult.error-73fe2e60d3801add463e93dc1c0b9f81.png"}}]);