"use strict";(self.webpackChunkfed_doc=self.webpackChunkfed_doc||[]).push([[1874],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return k}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),d=u(n),k=o,m=d["".concat(s,".").concat(k)]||d[k]||p[k]||i;return n?r.createElement(m,l(l({ref:t},c),{},{components:n})):r.createElement(m,l({ref:t},c))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,l=new Array(i);l[0]=d;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a.mdxType="string"==typeof e?e:o,l[1]=a;for(var u=2;u<i;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},67836:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return k},frontMatter:function(){return a},metadata:function(){return u},toc:function(){return p}});var r=n(87462),o=n(63366),i=(n(67294),n(3905)),l=["components"],a={},s=void 0,u={unversionedId:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883",id:"\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883",title:"\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883",description:"\u914d\u7f6e\u6d4b\u8bd5\u673a",source:"@site/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/3-\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883.md",sourceDirName:"19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316",slug:"/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883",editUrl:"https://github.com/Guing/FED-DOC/docs/19-\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/3-\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Docker",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/15\u5468 \u670d\u52a1\u7aef CI-CD \uff1agithub\u81ea\u52a8\u5316/Docker"},next:{title:"\u6280\u672f\u65b9\u6848\u8bbe\u8ba1",permalink:"/FED-DOC/docs/\u4f53\u7cfb/\u6155\u8bfe\u7f51\u524d\u7aef\u67b6\u6784\u5e08/16\u5468 \u7f16\u8f91\u5668\u670d\u52a1\u7aef\u57fa\u7840 API \u5f00\u53d1/\u6280\u672f\u65b9\u6848\u8bbe\u8ba1"}},c={},p=[{value:"\u914d\u7f6e\u6d4b\u8bd5\u673a",id:"\u914d\u7f6e\u6d4b\u8bd5\u673a",level:2},{value:"\u521b\u5efawork\u8d26\u53f7",id:"\u521b\u5efawork\u8d26\u53f7",level:2},{value:"\u767b\u5f55\u4fe1\u4efb",id:"\u767b\u5f55\u4fe1\u4efb",level:3},{value:"\u5b89\u88c5\u5fc5\u5907\u8f6f\u4ef6",id:"\u5b89\u88c5\u5fc5\u5907\u8f6f\u4ef6",level:3},{value:"git",id:"git",level:4},{value:"docker",id:"docker",level:4},{value:"\u5f00\u653e\u7aef\u53e3",id:"\u5f00\u653e\u7aef\u53e3",level:3},{value:"\u53d1\u5e03\u5230\u6d4b\u8bd5\u673a",id:"\u53d1\u5e03\u5230\u6d4b\u8bd5\u673a",level:2},{value:"\u68b3\u7406\u601d\u8def",id:"\u68b3\u7406\u601d\u8def",level:3},{value:"\u4ee3\u7801\u6f14\u793a",id:"\u4ee3\u7801\u6f14\u793a",level:3},{value:"\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5",id:"\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5",level:3}],d={toc:p};function k(e){var t=e.components,n=(0,o.Z)(e,l);return(0,i.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"\u914d\u7f6e\u6d4b\u8bd5\u673a"},"\u914d\u7f6e\u6d4b\u8bd5\u673a"),(0,i.kt)("h2",{id:"\u521b\u5efawork\u8d26\u53f7"},"\u521b\u5efawork\u8d26\u53f7"),(0,i.kt)("p",null,"\u5904\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u65e5\u5e38\u4e0d\u4f1a\u7528root\u8d26\u53f7\u767b\u5f55\uff0c\u6743\u9650\u592a\u9ad8\u4e86\u3002"),(0,i.kt)("p",null,"\u7528root\u767b\u5f55\uff0c\u521b\u5efawork\u8d26\u53f7"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"adduser work\npasswd work\n")),(0,i.kt)("p",null,"\u6dfb\u52a0work\u7684sudo\u6743\u9650"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"whereis sudoers # \u627e\u5230\u6587\u4ef6\u4f4d\u7f6e /etc/sudoers\n\nchmod u+w /etc/sudoers # \u4fee\u6539\u6743\u9650\uff0c u \u8868\u793a\u6240\u6709\u8005\uff0c w \u8868\u793a\u5199\u6743\u9650 + \u8868\u793a\u6dfb\u52a0\n\nvim /etc/sudoers # \u7f16\u8f91\u8be5\u6587\u4ef6\n# \u627e\u5230     `root    ALL=(ALL)       ALL`\n# \u518d\u52a0\u4e00\u884c  `work    ALL=(ALL)       ALL`\n\nchmod u-w /etc/sudoers\n\n")),(0,i.kt)("p",null,"\u7136\u540e\u4f7f\u7528work\u767b\u5f55\u673a\u5668\u3002\u8f93\u5165",(0,i.kt)("inlineCode",{parentName:"p"},"su"),"\uff0c\u5728\u8f93\u5165root\u8d26\u53f7\u7684\u5bc6\u7801\uff0c\u5373\u53ef\u62e5\u6709\u8d85\u7ea7\u6743\u9650\u3002"),(0,i.kt)("h3",{id:"\u767b\u5f55\u4fe1\u4efb"},"\u767b\u5f55\u4fe1\u4efb"),(0,i.kt)("p",null,"\u4f7f\u7528work\u767b\u5f55\u673a\u5668\uff0c\u521b\u5efa",(0,i.kt)("inlineCode",{parentName:"p"},"~/.ssh/authorized_keys"),"\u6587\u4ef6\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"# \u4fee\u6539\u6587\u4ef6\u5939\u6743\u9650\nchmod 700  ~/.ssh\nchmod 600  ~/.ssh/authorized_keys\n\n")),(0,i.kt)("p",null,"\u5c06\u672c\u673a\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"id_rsa.pub"),"\u5185\u5bb9\u7c98\u8d34\u8fdb\u6765\u3002"),(0,i.kt)("p",null,"\u9000\u51fa\u91cd\u65b0\u7528work\u767b\u5f55\uff0c\u5c06\u4e0d\u7528\u5728\u8f93\u5165\u5bc6\u7801\u3002"),(0,i.kt)("h3",{id:"\u5b89\u88c5\u5fc5\u5907\u8f6f\u4ef6"},"\u5b89\u88c5\u5fc5\u5907\u8f6f\u4ef6"),(0,i.kt)("p",null,"\u4ee5\u4e0b\u90fd\u9700\u8981",(0,i.kt)("inlineCode",{parentName:"p"},"su"),"\u6743\u9650"),(0,i.kt)("h4",{id:"git"},"git"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"yum -y install git\ngit --version\n\n")),(0,i.kt)("h4",{id:"docker"},"docker"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/install/centos/"},"\u5b89\u88c5docker")),(0,i.kt)("li",{parentName:"ul"},"docker\u955c\u50cf\u52a0\u901f"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/install/"},"\u5b89\u88c5docker-compose"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"docker version\ndocker-compose --version\n")),(0,i.kt)("h3",{id:"\u5f00\u653e\u7aef\u53e3"},"\u5f00\u653e\u7aef\u53e3"),(0,i.kt)("p",null,"\u5f00\u653e\u9700\u8981\u7684\u7aef\u53e3\uff0c\u5426\u5219\u5916\u7f51\u65e0\u6cd5\u8bbf\u95ee\u8be5\u7aef\u53e3"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"B\u7aef FE - 80"),(0,i.kt)("li",{parentName:"ul"},"B\u7aef server - 8081"),(0,i.kt)("li",{parentName:"ul"},"C\u7aef - 8082"),(0,i.kt)("li",{parentName:"ul"},"\u7edf\u8ba1\u670d\u52a1\uff0c\u6536\u96c6\u65e5\u5fd7 - 8083"),(0,i.kt)("li",{parentName:"ul"},"\u7edf\u8ba1\u670d\u52a1 OpenAPI - 8080"),(0,i.kt)("li",{parentName:"ul"},"admin FE - 8085"),(0,i.kt)("li",{parentName:"ul"},"admin server - 8084")),(0,i.kt)("h2",{id:"\u53d1\u5e03\u5230\u6d4b\u8bd5\u673a"},"\u53d1\u5e03\u5230\u6d4b\u8bd5\u673a"),(0,i.kt)("h3",{id:"\u68b3\u7406\u601d\u8def"},"\u68b3\u7406\u601d\u8def"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u4f7f\u7528github actions\u76d1\u542cdev\u5206\u652fpush"),(0,i.kt)("li",{parentName:"ul"},"\u767b\u5f55\u6d4b\u8bd5\u673a\uff0c\u83b7\u53d6\u6700\u65b0dev\u5206\u652f\u4ee3\u7801"),(0,i.kt)("li",{parentName:"ul"},"\u91cd\u65b0\u6784\u5efa\u955c\u50cf",(0,i.kt)("inlineCode",{parentName:"li"},"docker-compose build editor-server")),(0,i.kt)("li",{parentName:"ul"},"\u91cd\u542f\u6240\u6709\u5bb9\u5668",(0,i.kt)("inlineCode",{parentName:"li"},"docker-compose up -d"))),(0,i.kt)("h3",{id:"\u4ee3\u7801\u6f14\u793a"},"\u4ee3\u7801\u6f14\u793a"),(0,i.kt)("p",null,"\u65b0\u5efa",(0,i.kt)("inlineCode",{parentName:"p"},"deploy-dev.yml"),"\u5185\u5bb9\u5982\u4e0b:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"name: deploy for dev\n\non:\n    push:\n        branches:\n            - 'dev' # \u53ea\u9488\u5bf9 dev \u5206\u652f\n        paths:\n            - '.github/workflows/*'\n            # - '__test__/**' # dev \u4e0d\u9700\u8981\u7acb\u5373\u6d4b\u8bd5\n            - 'src/**'\n            - 'Dockerfile'\n            - 'docker-compose.yml'\n            - 'bin/*'\n\njobs:\n    deploy-dev:\n        runs-on: ubuntu-latest\n\n        steps:\n            - uses: actions/checkout@v2\n            - name: set ssh key # \u4e34\u65f6\u8bbe\u7f6e ssh key\n              run: |\n                  mkdir -p ~/.ssh/\n                  # secrets.WFP_ID_RSA github\u91cc\u9762\u8bbe\u7f6e\u7684\n                  echo \"${{secrets.WFP_ID_RSA}}\" > ~/.ssh/id_rsa\n                  chmod 600 ~/.ssh/id_rsa\n                  ssh-keyscan \"182.92.xxx.xxx\" >> ~/.ssh/known_hosts\n            - name: deploy # \u90e8\u7f72\n              run: |\n                  ssh work@182.92.xxx.xxx \"\n                    # \u3010\u6ce8\u610f\u3011\u7528 work \u8d26\u53f7\u767b\u5f55\uff0c\u624b\u52a8\u521b\u5efa /home/work/imooc-lego \u76ee\u5f55\n                    # \u7136\u540e git clone https://username:password@github.com/imooc-lego/biz-editor-server.git -b dev \uff08\u79c1\u6709\u4ed3\u5e93\uff0c\u4f7f\u7528 github \u7528\u6237\u540d\u548c\u5bc6\u7801\uff09\n                    # \u8bb0\u5f97\u5220\u9664 origin \uff0c\u5426\u5219\u4f1a\u66b4\u9732 github \u5bc6\u7801\n\n                    cd /home/work/imooc-lego/biz-editor-server;\n                    git remote add origin https://wangfupeng1988:${{secrets.WFP_PASSWORD}}@github.com/imooc-lego/biz-editor-server.git;\n                    git checkout dev;\n                    git pull origin dev; # \u91cd\u65b0\u4e0b\u8f7d\u6700\u65b0\u4ee3\u7801\n                    git remote remove origin; # \u5220\u9664 origin \uff0c\u5426\u5219\u4f1a\u66b4\u9732 github \u5bc6\u7801\n                    # \u542f\u52a8 docker\n                    docker-compose build editor-server; # \u548c docker-compose.yml service \u540d\u5b57\u4e00\u81f4\n                    docker-compose up -d;\n                  \"\n            - name: delete ssh key # \u5220\u9664 ssh key\n              run: rm -rf ~/.ssh/id_rsa\n\n")),(0,i.kt)("h3",{id:"\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5"},"\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5"),(0,i.kt)("p",null,"\u5f85\u6d4b\u8bd5\u673a\u90e8\u7f72\u5b8c\u6210\uff0c\u5373\u53ef\u8fdb\u884c\u8fdc\u7a0b\u63a5\u53e3\u6d4b\u8bd5",(0,i.kt)("inlineCode",{parentName:"p"},"npm run test:remote"),",\u5373",(0,i.kt)("inlineCode",{parentName:"p"},"test.yml"),"\u7684\u5185\u5bb9"),(0,i.kt)("p",null,"\u6ce8\u610f\uff0c\u4e00\u5b9a\u8981\u7b49\u5f85\u6d4b\u8bd5\u673a\u90e8\u7f72\u5b8c\u6210\uff0c\u5426\u5219\u6d4b\u8bd5\u4e0d\u901a\u8fc7"))}k.isMDXComponent=!0}}]);