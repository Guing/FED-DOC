<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/其他人的笔记">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/FED-DOC/blog/rss.xml" title="IT学习笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/FED-DOC/blog/atom.xml" title="IT学习笔记 Atom Feed"><title data-rh="true">其他人的笔记 | IT学习笔记</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://guing.github.io/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/其他人的笔记"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="其他人的笔记 | IT学习笔记"><meta data-rh="true" name="description" content="站在前端研发视角，分析开发脚手架的必要性"><meta data-rh="true" property="og:description" content="站在前端研发视角，分析开发脚手架的必要性"><link data-rh="true" rel="icon" href="/FED-DOC/img/my.jpg"><link data-rh="true" rel="canonical" href="https://guing.github.io/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/其他人的笔记"><link data-rh="true" rel="alternate" href="https://guing.github.io/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/其他人的笔记" hreflang="en"><link data-rh="true" rel="alternate" href="https://guing.github.io/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/其他人的笔记" hreflang="x-default"><link rel="stylesheet" href="/FED-DOC/assets/css/styles.5627add0.css">
<link rel="preload" href="/FED-DOC/assets/js/runtime~main.d2e3a023.js" as="script">
<link rel="preload" href="/FED-DOC/assets/js/main.0b039734.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/FED-DOC/"><div class="navbar__logo"><img src="/FED-DOC/img/my.jpg" alt="IT学习笔记" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/FED-DOC/img/my.jpg" alt="IT学习笔记" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">IT学习笔记</b></a><a class="navbar__item navbar__link navbar__link--active" href="/FED-DOC/docs/intro">前端</a><a class="navbar__item navbar__link" href="/FED-DOC/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Guing/FED-DOC" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/FED-DOC/docs/intro">前端学习笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/Html/MDN笔记/">Html</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/Css/2021必修 CSS架构系统精讲/2-3 CSS设计模式/note">Css</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/Vue/Nuxt-前端老张/笔记">Vue</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/React/React17系统精讲结合TS打造旅游电商平台2021/笔记/">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/Nodejs/intro">Nodejs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/TypeScript/Typescript入门学习笔记/">TypeScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/小程序/intro">小程序</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/浏览器/IndexedDB数据库/IndexedDB使用">浏览器</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/性能优化/vue-cli优化">性能优化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/网络协议/intro">网络协议</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/工程化/intro">工程化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/单元测试/intro">单元测试</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/构建工具/webpack基础使用">构建工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/安全/intro">安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/算法/300分钟搞定数据结构与算法/">算法</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/移动端/intro">移动端</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/FED-DOC/docs/体系/慕课网前端架构师/需求/1周 需求分析和架构设计/乐高架构方案设计文档">体系</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/需求/1周 需求分析和架构设计/乐高架构方案设计文档">慕课网前端架构师</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/需求/1周 需求分析和架构设计/乐高架构方案设计文档">需求</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/28周 脚手架发布模块架构设计和核心流程/本周介绍">脚手架</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/28周 脚手架发布模块架构设计和核心流程/本周介绍">28周 脚手架发布模块架构设计和核心流程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/29周 脚手架发布模式git自动化流程开发/Github和Gitee API接入">29周 脚手架发布模式git自动化流程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/学习目标">2周 脚手架架构设计和框架搭建</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/学习目标">学习目标</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/脚手架开发入门">1. 站在前端研发的视角，分析开发脚手架的必要性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/脚手架的实现原理">1. 脚手架执行原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/脚手架开发流程">开发流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/快速入门第一个脚手架">一、快速入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/Lerna基础-框架搭建">原生脚手架开发痛点分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/lerna 源码分析">lerna 源码分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/yargs 使用">yargs 使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/基于commander实现脚手架命令注册">快速实现一个commander脚手架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/如何让Node支持Es Moudle">通过webpack完成ES Module资源构建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/基于Lerna重新设计简历">基于Lerna重新设计简历</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/总结">总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/其他人的笔记">其他人的笔记</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/30周 脚手架发布模块云构建系统开发/WebSocket 快速入门">30周 脚手架发布模块云构建系统开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/31周 脚手架发布模块云发布功能开发/node常用三方库介绍">31周 脚手架发布模块云发布功能开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/32周 脚手架组件发布功能开发/笔记">32周 脚手架组件发布功能开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/33周 组件平台开发/笔记">33周 组件平台开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/3周 脚手架核心流程开发/脚手架开发架构设计">3周 脚手架核心流程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/4周 脚手架命令注册和执行过程开发/脚手架初始化+全局参数注册">4周 脚手架命令注册和执行过程开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/5周 脚手架创建项目流程设计和开发/脚手架项目创建功能架构设计">5周 脚手架创建项目流程设计和开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/6周 脚手架创建项目和组件初始化开发/安装项目模板阶段">6周 脚手架创建项目和组件初始化开发</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/编辑器/10周 编辑器基本布局及业务组件库初步开/笔记">编辑器</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/服务器/14周 服务端技术选型：磨刀不误砍柴工/导学">服务器</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/FED-DOC/docs/体系/慕课网前端架构师/总结/遇到的坑">总结</a></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/FED-DOC/docs/面试/webpack面试题/">面试</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/FED-DOC/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">体系</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">慕课网前端架构师</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">脚手架</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">2周 脚手架架构设计和框架搭建</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">其他人的笔记</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>其他人的笔记</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="站在前端研发视角分析开发脚手架的必要性">站在前端研发视角，分析开发脚手架的必要性<a class="hash-link" href="#站在前端研发视角分析开发脚手架的必要性" title="Direct link to heading">​</a></h2><p>架构师视角：开发脚手架的目标是什么，能带来什么价值</p><p>开发脚手架的核心目标是： <strong>提升前端研发效能</strong></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="开发过程的共有操作">开发过程的共有操作<a class="hash-link" href="#开发过程的共有操作" title="Direct link to heading">​</a></h3><ul><li><p>创建项目</p><p>创建项目一般都会有通用代码</p></li><li><p>git操作</p><p>创建仓库、处理代码冲突、同步远程分支、创建版本、发布后的tag等，耗时耗力</p></li><li><p>构建和发布上线</p><p>本地构建、资源发布到静态资源服务器、同步CDN、域名绑定、区分正式和测试服务器，人为操作耗时多</p></li></ul><p>解决上述问题，即可提效。突出脚手架的核心价值</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="脚手架的核心价值">脚手架的核心价值<a class="hash-link" href="#脚手架的核心价值" title="Direct link to heading">​</a></h3><p>将研发过程：</p><ul><li><p>自动化</p><p>从创建项目到git操作，到发布上线的自动化，减少人工的耗时</p></li><li><p>标准化</p><p>交给脚手架完成共有操作，可以统一代码风格，规避git flow混乱：杂乱无章的commit。统一发布和回滚流程</p></li><li><p>数据化</p><p>统计脚手架创建项目、git操作、构建和发布的时间，可以对研发过程进行优化。可以把研发过程保存下来</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="和自动化工具的区别">和自动化工具的区别<a class="hash-link" href="#和自动化工具的区别" title="Direct link to heading">​</a></h3><ul><li><p>不满足需求。jenkins/travis通常需要在git hooks中触发，负责云构建，不能覆盖开发人员本地功能 </p></li><li><p>定制复杂。jenkins、travis定制过程需要开发插件，开发过程复杂，且使用java语言，对前端开发人员不够友好</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="从使用的角度理解什么是脚手架">从使用的角度理解什么是脚手架<a class="hash-link" href="#从使用的角度理解什么是脚手架" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="脚手架简介">脚手架简介<a class="hash-link" href="#脚手架简介" title="Direct link to heading">​</a></h3><p>脚手架是操作系统的客户端。只不过它是通过命令执行：</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">vue create vue-test-app</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>上面命令由3部分组成：</p><ul><li>主命令：<code>vue</code> </li><li>command：<code>create</code> </li><li>command 的 param：<code>vue-test-app</code>   </li></ul><p>命令表示创建一个vue项目，项目名为<code>vue-test-app</code> </p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">vue create vue-test-app --force</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>创建项目并覆盖已有同名目录。<code>--force</code> 称为option。用来辅助脚手架确认在特定场景下，用户的选择。</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">vue create vue-test-app --fore -r https://registry.npm.taobao.org</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>这里<code>-r</code> 也是option，--registry的简写。<code>-r https://registry.npm.taobao.org</code> 后面的<code>https://registry.npm.taobao.org</code> 是<code>-r</code> 的param. <code>--force</code>简写是 <code>-f</code> 。 <code>--force</code> 也有param：<code>--force</code> <code>-f</code> 是 <code>--force true</code> 的缩写。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="脚手架执行原理">脚手架执行原理<a class="hash-link" href="#脚手架执行原理" title="Direct link to heading">​</a></h3><p><code>vue create vue-test-app</code>  命令干了些啥？</p><ol><li><p>终端在环境变量中找到vue指令，<code>which vue</code>  指令寻找（mac系统下）本机运行which vue的到结果：    <code>/usr/local/bin/vue</code> </p></li><li><p>进入node路径，图1，关注bin和lib文件夹(本机是进入<code>/usr/local/</code> )，进入bin路径后，ls -la得到vue信息：<code>lrwxr-xr-x  1 root wheel  39  9 19 15:15 vue -&gt; ../lib/node_modules/@vue/cli/bin/vue.js</code> 得到vue是一个指向<code>/usr/local/lib/node_modules/@vue/cli/bin/vue.js</code> 的软连接</p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/usr_local.png" class="img_E7b_"></p><p>图1：bin文件夹中是软链接。lib中是软链接指向的全局文件（npm包）</p></li><li><p>以上，实际执行的是<code>/usr/local/lib/node_modules/@vue/cli/bin/vue.js</code> 文件。解析command后调用相应方法(create)执行。</p></li></ol><p><strong>执行过程图解：</strong></p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B.png" class="img_E7b_"></p><ul><li>终端中输入 <code>vue create vue-test-app</code></li><li>终端解析出<code>vue</code> 命令</li><li>终端在环境中找到<code>vue</code> 命令（使用which vue指令）</li><li>终端根据<code>vue</code> 命令链接到实际文件vue.js</li><li>终端利用node 执行vue.js</li><li>vue.js解析<code>command</code> /<code>opiton</code></li><li>vue.js执行<code>command</code> (对应的方法)</li><li>执行完毕，退出执行</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="开发脚手架的步骤">开发脚手架的步骤<a class="hash-link" href="#开发脚手架的步骤" title="Direct link to heading">​</a></h3><p>以 <code>vue-cli</code> 为例</p><ol><li><p>创建npm项目<code>mkdir vue-cli &amp;&amp; cd vue-cli &amp;&amp; npm init -y</code> 项目中包含<code>bin/vue.js</code> 文件，<code>package.json</code> 配置：</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;bin&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;vue&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bin/vue.js&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>最后，把项目发布到npm。</p></li><li><p>将 <code>vue-cli</code> 安装到 <code>node</code> 的 <code>lib/node_modules</code> 中：<code>npm i -g @vue/cli</code></p></li><li><p>在 <code>node</code> 的 <code>bin</code> 目录下配置 <code>vue</code> 软链到 <code>lib/node_modules/@vue/cli/bin/vue.js</code> 。这一步，npm安装时自动完成。</p><ol><li><p>unix 系统 只配置一个软链文件 vue</p></li><li><p>windows 中会生成两个文件： <code>vue.cmd</code> 和 <code>vue</code> ，前者在 cmd, PowerShell 等 windows 环境的命令行工具中执行；后者在 Git 等 unix 模拟环境的命令行工具中执行。使用记事本编辑</p><ol><li><p><code>vue.cmd</code> 中追加：</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@echo off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;cmd&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><code>vue</code> 中追加：</p><div class="codeBlockContainer_I0IT language-，，bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-，，bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;unix&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li></ol><p>分别在 cmd, powershell, Git 命令行工具中运行，可看出区别。</p></li></ol></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="windows-下的-bin-配置">windows 下的 <code>bin</code> 配置<a class="hash-link" href="#windows-下的-bin-配置" title="Direct link to heading">​</a></h4><ul><li><p><code>vue.cmd</code></p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">@IF EXIST &quot;%~dp0\node.exe&quot; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;%~dp0\node.exe&quot;  &quot;%~dp0\node_modules\@vue\cli\bin\vue.js&quot; %* // 猜测使用当前目录(%~dp0)的 node.exe 执行后面的 js 文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ELSE (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @SETLOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @SET PATHEXT=%PATHEXT:;.JS;=;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node  &quot;%~dp0\node_modules\@vue\cli\bin\vue.js&quot; %* // 使用 node 命令执行，后面的 js 文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><code>vue</code></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/sh // 执行 sh 文件，sh 是链接到 bash 的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">basedir</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">dirname</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$(</span><span class="token variable string variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable string variable" style="color:#36acaa"> </span><span class="token variable string variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable string variable" style="color:#36acaa">$0</span><span class="token variable string variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa"> </span><span class="token variable string variable operator" style="color:#393A34">|</span><span class="token variable string variable" style="color:#36acaa"> </span><span class="token variable string variable function" style="color:#d73a49">sed</span><span class="token variable string variable" style="color:#36acaa"> -e </span><span class="token variable string variable string" style="color:#e3116c">&#x27;s,\\,/,g&#x27;</span><span class="token variable string variable" style="color:#36acaa">)</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">uname</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *CYGWIN*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">basedir</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">cygpath -w </span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable string variable" style="color:#36acaa">$basedir</span><span class="token variable string" style="color:#e3116c">&quot;</span><span class="token variable" style="color:#36acaa">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  // CYGWIN 一种 unix 模拟环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">esac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -x </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$basedir</span><span class="token string" style="color:#e3116c">/node&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$basedir</span><span class="token string" style="color:#e3116c">/node&quot;</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$basedir</span><span class="token string" style="color:#e3116c">/node_modules/@vue/cli/bin/vue.js&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> // 猜测使用当前目录</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">%~dp0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">的 node.exe 执行后面的 js 文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">ret</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">node</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$basedir</span><span class="token string" style="color:#e3116c">/node_modules/@vue/cli/bin/vue.js&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> // 使用 </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> 命令执行，后面的 js 文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">ret</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$?</span><span class="token plain"> // </span><span class="token builtin class-name">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$ret</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li></ul><p>尚不清楚，windows 下，是怎么查找这两个文件的，但是，这俩个文件中，明确的标出了 <code>vue.js</code> 的位置，和执行方式。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="需要解决的问题">需要解决的问题<a class="hash-link" href="#需要解决的问题" title="Direct link to heading">​</a></h3><ol><li><p>为什么全局安装 <code>@vue/cli</code> 后会添加的命令为vue？</p><p><code>package.json</code> 中<code>bin</code> 配置了key <code>vue</code>，<code>npm</code> 全局安装时，会根据这个配置生成软链接。</p></li><li><p>全局安装<code>@vue/cli</code> 时发生了什么？</p><p>全局安装@vue/cli时</p><ul><li><p>下载npm包到全局的node_modules文件夹下</p></li><li><p>按<code>package.json</code> 中<code>bin</code> 的配置，生成软链接</p></li></ul></li><li><p>为什么<code>vue</code> 指向一个<code>js</code> 文件，我们却可以通过<code>vue</code> 命令直接执行它？</p><ul><li><code>vue.js</code> 文件第一行添加<code>#!/usr/bin/env node</code> 告诉操作系统，在直接打开文件时，从环境变量中找寻<code>node</code> 命令，使用 <code>node</code> 执行文件。<code>/usr/bin/env</code> 在终端中打印出来的是环境变量。<ul><li>windows 中，使用 <code>set</code> 命令打印环境变量；<code>set path</code> 打印环境变量 <code>path</code> </li></ul></li><li><code>npm</code> 按照<code>package.json</code> 中<code>bin</code> 的配置，生成了软链接<code>vue</code> 指向了<code>vue.js</code> 。所以输入<code>vue</code> 就可以执<code>vue,js</code> 。</li></ul></li></ol><p><strong>涉及到的bash命令</strong></p><ul><li><p><code>chmod 777 filename</code> 可以将文件改为可执行文件</p><p><code>drwxr-xr-x</code>  最后一个<code>x</code> 表示这是一个可执行文件</p></li><li><p><code>echo $PATH</code> 打印环境变量</p></li></ul><p><strong>手动创建软连接</strong></p><p>创建软连接指向js：在node bin目录下，运行命令 <code>ln -s js路径 name</code>。之后可以在任何位置，执行<code>name</code> 命令</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="脚手架原理进阶">脚手架原理进阶<a class="hash-link" href="#脚手架原理进阶" title="Direct link to heading">​</a></h2><ol><li><p>为什么说脚手架本质是操作系统的客户端？它和我们在PC上安装的应用/软件有什么区别？</p><p>因为node是操作系统的客户端，不是编写的对应脚手架js文件是客户端。区别是没有gui，node是通过命令行方式，传入参数执行</p></li><li><p>如何为node脚手架命令创建别名？</p><p>相当于为现有的vue 这个命令在添加个别名：新建软连接指向他就好了。在<code>node/bin</code> 下执行：<code>ln -s /vue vue2</code> 即可使用<code>vue2</code> 指向<code>vue</code> 。<code>windows</code> 系统是通过新建快捷方式创建</p></li><li><p>描述脚手架命令执行的全过程：</p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B.png" class="img_E7b_"></p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="脚手架的开发流程">脚手架的开发流程<a class="hash-link" href="#脚手架的开发流程" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="开发流程">开发流程<a class="hash-link" href="#开发流程" title="Direct link to heading">​</a></h3><ol><li><p>创建<code>npm</code> 项目</p></li><li><p>创建脚手架入口文件，最上方添加：</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token hashbang comment" style="color:#999988;font-style:italic">#!/usr/bin/env node</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p>配置<code>package.json</code> ，添加<code>bin</code> 属性</p></li><li><p>编写脚手架代码</p></li><li><p>将脚手架发布到<code>npm</code> </p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="安装使用">安装使用<a class="hash-link" href="#安装使用" title="Direct link to heading">​</a></h3><p><strong>作业1</strong></p><ul><li><p>安装</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i -g jolly-test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p>使用</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ jolly-test -V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ jolly-test --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ jolly-test init </span><span class="token builtin class-name">test</span><span class="token plain"> --option</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">执行init流程 </span><span class="token builtin class-name">test</span><span class="token plain"> --option</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="脚手架开发难点">脚手架开发难点<a class="hash-link" href="#脚手架开发难点" title="Direct link to heading">​</a></h2><ul><li><p>分包：将复杂的系统拆分成若干个模块</p></li><li><p>命令注册，使用若干命令实现对应功能</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">vue create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vue </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vue invoke</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p>参数解析</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">vue </span><span class="token builtin class-name">command</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">params</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>主命令、command、带params的options等</p></li><li><p>options有全称 <code>--version</code> 有简写<code>-v</code> <code>-h</code> 怎么实现</p></li><li><p>帮助文档</p><ul><li>Global help (针对主命令)<ul><li>Usage</li><li>Options</li><li>Commands</li></ul></li></ul><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">jolly@JollydeMacBook-Pro % vue -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage: vue </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">command</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -V, --version                              output the version number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -h, --help                                 output usage information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Commands:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  create </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">app-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">                create a new project powered by vue-cli-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pluginOptions</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> a plugin and invoke its generator </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> an already created project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  invoke </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pluginOptions</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  invoke the generator of a plugin </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> an already created project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inspect </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">paths</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">               inspect the webpack config </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> a project with vue-cli-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serve </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">entry</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">                    serve a .js or .vue </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> development mode with zero config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">entry</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">                    build a .js or .vue </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> production mode with zero config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ui </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">                               start and </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"> the vue-cli ui</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  init </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">template</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">app-name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">       generate a project from a remote template </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">legacy API, requires @vue/cli-init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">                   inspect and modify the config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outdated </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">                         </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experimental</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> check </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> outdated vue cli </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> / plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  upgrade </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugin-name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experimental</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> upgrade vue cli </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> / plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  migrate </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugin-name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experimental</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> run migrator </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> an already-installed cli plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  info                                       print debugging information about your environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Run vue </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">command</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --help </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> detailed usage of given command.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li></ul><p>还有</p><ul><li>交互式命令行</li><li>日志打印</li><li>命令行文字颜色变化</li><li>网络通信：HTTP/WebSocket</li><li>文件处理</li></ul><p>......</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="脚手架本地调试">脚手架本地调试<a class="hash-link" href="#脚手架本地调试" title="Direct link to heading">​</a></h3><p><strong>没有分包的本地调试</strong></p><p>假定在开发jolly-test脚手架，要本地调试<code>jolly-test</code>命令</p><ul><li><p>在<code>package.json</code> 所在目录下<code>npm link</code> </p><ul><li>此时会按照 <code>package.json</code> 中<code>bin</code> 配置在<code>/usr/local/bin</code> 中生成软链<code>jolly-test</code>（<code>bin</code> 配置的）</li><li>先指向/usr/local/lib/node_modules/jolly-test，这也是一个软连接</li><li>/node_modules/jolly-test 指向项目的本地实际路径</li></ul></li><li><p>在<code>package.json</code> 所在目录的上级<code>npm i -g 文件夹名</code> 也可以实现<code>npm link</code> 的效果。唯一的区别在于<code>node_modules</code> 中软链指向的地址写法：<code>npm link</code> <code>node_modules</code> 中软链指向的地址是绝对路径：</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lrwxr-xr-x   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> jolly  wheel    </span><span class="token number" style="color:#36acaa">37</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:42 jolly-test -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /Users/jolly/Desktop/imooc/jolly-test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>而<code>npm i -g jolly-test</code> <code>node_modules</code> 中软链指向的地址是相对路径：</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lrwxr-xr-x  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> jolly wheel  </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:24 jolly-test -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/Users/jolly/Desktop/imooc/jolly-test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li></ul><p><strong>分包的本地调试</strong></p><p>假定开发<code>jolly-cli</code>，和<code>jolly-utils</code>位于<code>jolly-cli-dev</code>文件夹下。<code>jolly-cli</code>引入依赖<code>jolly-utils</code> </p><ul><li><p>首先在<code>jolly-utils</code>中<code>npm link</code> 放到全局<code>node_modules</code> 文件夹下， 然后在<code>jolly-cli</code> 运行指令<code>npm link jolly-utils</code>，并在 <code>package.json</code> 中手动配置依赖。</p></li><li><p><code>npm</code> <code>package</code> 的形式之一，就是本地的某个文件夹。所以<code>npm</code> 提过如下写法，支持本地包的引入（<code>jolly-cli</code>引入依赖<code>jolly-utils</code>）</p></li></ul><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;dependencies&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;@jolly-cli/utils&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;file:../utils&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>​	配置之后，需要 <code>npm install</code>（存在一个现象，自用mac上， <code>npm link</code> 也能更新依赖，包括安装非本地依赖。之后验证吧），但发布时需要具备像<code>lerna publish</code> 将本地连接解析成线上连接的功能对依赖进行处理。</p><p><strong>本地调试后发布上线</strong></p><ul><li>使用<code>npm link</code> 的要先<code>npm unlink</code>，然后<ul><li>没有本地分包调试的，可以直接发布了</li><li>有本地分包的，如开发<code>jolly-cli</code> ，应先在 <code>jolly-cli</code> 中<code>npm unlink jolly-utils</code> , 这时<code>package.json</code> 中对应依赖会被移除。然后回到 <code>jolly-utils</code> 中 <code>npm unlink</code> 并先对 <code>jolly-utils</code> 进行发布。发布成功之后，在 <code>jolly-cli</code> 运行 <code>npm i -S jolly-utils</code> 安装依赖，再对 <code>jolly-cli</code> 进行发布。</li></ul></li><li>通过 <code>&quot;file:../utils&quot;</code> 引入依赖的，要使用 <code>lerna publish</code> 进行发布。</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="npm-link--npm-unlink">npm link &amp; npm unlink<a class="hash-link" href="#npm-link--npm-unlink" title="Direct link to heading">​</a></h3><p><strong>npm link</strong></p><ul><li><code>npm link</code> 将当前项目链接到 <code>node</code> 全局 <code>node_modules</code> 中作为一个库文件，并解析 bin 配置创建可执行文件</li><li><code>npm link your-lib</code> 将当前项目中 <code>node_modules</code> 下指定的库文件链接到 <code>node</code> 全局 <code>node_modules</code> 下的库文件</li></ul><p><strong>npm unlink</strong></p><ul><li><code>npm unlink</code> 将当前项目从 <code>node</code> 全局 <code>node_modules</code> 中移除</li><li><code>npm unlink your-lib</code> 将当前项目中的库文件依赖移除</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="脚手架命令注册和参数解析">脚手架命令注册和参数解析<a class="hash-link" href="#脚手架命令注册和参数解析" title="Direct link to heading">​</a></h2><p><strong>不使用第三方库进行解析</strong></p><p>使用 <code>node</code> <code>process</code> 模块。<code>process</code> 是 <code>node</code> 的进程事件，<code>process.argv</code>  属性会返回一个数组，其中包含当 <code>Node.js</code> 进程被启动时传入的命令行参数。第一个元素是 <code>process.execPath</code>（启动 <code>Node.js</code> 进程的可执行文件的绝对路径名）。 第二个元素是正被执行的 <code>JavaScript</code> 文件的路径。 其余的元素是任何额外的命令行参数。</p><p>下图是输入 <code>imooc-test init</code> 后的 <code>process.argv</code></p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/process.argv.jpg" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="使用lerna进行脚手架开发">使用lerna进行脚手架开发<a class="hash-link" href="#使用lerna进行脚手架开发" title="Direct link to heading">​</a></h2><p>lerna 是一个优化基于 git + npm 的多 package 项目的管理工具</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="lerna解决的问题">lerna解决的问题<a class="hash-link" href="#lerna解决的问题" title="Direct link to heading">​</a></h3><ul><li><p>大型项目、多 <code>packages</code> 的重复操作</p><ul><li><p>本地分包之间的link</p></li><li><p>依赖安装</p></li><li><p>单元测试</p></li><li><p>代码提交</p><p>所有 <code>package</code> 提交到一个仓库</p></li><li><p>代码发布</p><p>每一个 <code>package</code> 都要发布成独立的 <code>npm</code> 包，version 升级</p></li></ul></li><li><p>大型项目、多 <code>packages</code> 的版本一致性</p><ul><li><p>发布时版本一致性</p><p><code>packages</code> 之间版本一致，只需保证一个版本下的 <code>packages</code> 可以协同工作即可，不必考虑向下兼容</p></li><li><p>发布后相互依赖的版本升级</p><p>一个包升级后，依赖这个包的其他包，也要进行升级</p></li></ul></li><li><p>leran 提升操作的标准化</p><p>标准的发布流程：发布前的 bump version，检查代码是否提交了，生成仓库的 tag 标签等，最后进行 npm 发布</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="lerna与架构">lerna与架构<a class="hash-link" href="#lerna与架构" title="Direct link to heading">​</a></h3><p>lerna 是一个架构优化的产物，它揭示了一个架构真理：项目复杂度提升后，就需要对项目进行架构优化。架构优化的主要目标往往都是以效能为核心。</p><p>标椎化带来的好处是减少出错，减少排查错误的成本。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="lerna-开发脚手架流程">lerna 开发脚手架流程<a class="hash-link" href="#lerna-开发脚手架流程" title="Direct link to heading">​</a></h3><p>紫色为常用命令</p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/lerna%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B.png" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="创建-npm-organazition">创建 npm Organazition<a class="hash-link" href="#创建-npm-organazition" title="Direct link to heading">​</a></h3><p><code>pakage.json</code> 中 <code>name</code> 以 <code>@</code> 开头，说明是个 <code>group</code> ，需要先注册一个 <code>group</code> ，否则后面没法发布和获取</p><p><strong>添加 Organization</strong></p><ul><li>点击 add Organization</li></ul><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/add_organization.jpg" class="img_E7b_"></p><ul><li><p>创建 group</p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/create_group.png" class="img_E7b_"></p></li><li><p>创建后，在packages中查看</p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/packages.png" class="img_E7b_"></p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="创建-lerna-repo">创建 lerna repo<a class="hash-link" href="#创建-lerna-repo" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i -g lerna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> lerna-test </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> lerna-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> init -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lerna init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="lerna-命令解释">lerna 命令解释<a class="hash-link" href="#lerna-命令解释" title="Direct link to heading">​</a></h3><ul><li><p><code>lerna init</code></p><p>直接运行，没有参数。创建一个lerna仓库(lerna repo)，生成 <code>lerna.josn</code> 并且在 <code>package.json</code> 中写入开发依赖</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;devDependencies&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;lerna&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;^3.22.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><code>lerna create packageName [location]</code> </p><p>创建新的 <code>package</code> 并根据交互命令行输入生成 <code>package.json</code>；可以指定路径。</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lerna create get-npm-info ./utils/get-npm-info</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><code>lerna add</code> </p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lerna </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">package</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">@version</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--dev</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--exact</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--peer</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>向packages添加依赖，不传package，表示向所有package添加依赖。 <strong><code>&lt;package&gt;</code> 是路径，不是包名</strong></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lerna </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> axios utils/get-npm-info</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>一次只能添加一个包，使用 <code>npm</code> 安装多包的写法，只会安装第一个</li><li><strong><code>npm link</code> 后的包，在 <code>lerna add</code> 后，要重新 <code>npm link</code>，不然会报错。这是坑</strong></li></ul></li><li><p><code>lerna link</code></p><p>将相互依赖的本地包进行链接</p></li><li><p><code>lerna exec</code></p><p>对每个package执行任意 <code>shell</code> 命令，上下文在package文件夹中</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lerna </span><span class="token builtin class-name">exec</span><span class="token plain"> -- </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf ./node_modules</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> lerna </span><span class="token builtin class-name">exec</span><span class="token plain"> --scope @imooc-cli-dev/core（包名） -- </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> -la</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>通过 <code>--scope</code> 指定包名，对特定包执行 <code>shell</code> 脚本</p></li><li><p><code>lerna run</code></p><p>执行<strong>存在</strong>于每个包中的 npm script</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lerna run </span><span class="token builtin class-name">test</span><span class="token plain"> </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lerna run --scope @imooc-cil-dev/utils </span><span class="token builtin class-name">test</span><span class="token plain"> </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>通过 <code>--scope</code> 指定包名，对特定包执行 <code>npm</code> 命令</p></li><li><p><code>lerna clean</code></p><p>删除所有packages的node_modules目录，但是不会修改package.json的依赖，且始终不会删除根目录下的 <code>node_modules</code> 中的文件夹</p></li><li><p><code>lerna boorstrap</code></p><p>安装 <code>lerna repo</code> 中所有包的依赖，包括包与包的相互依赖</p></li><li><p><code>lerna version</code>
bump version。1.0.1 -&gt; 1.0.2 / 1.1.0 ...</p></li><li><p><code>lerna changed</code>
表示自上一个版本，有哪些package做了变更</p></li><li><p><code>lerna diff</code>
检查做出的修改，前提是有提交仓库或者有<code>git commite</code></p></li><li><p><code>lerna publish</code></p><p>发布 <code>npm</code> 包，登录部分，跟 <code>npm publish</code> 一致。 </p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="lerna项目发布问题说明">lerna项目发布问题说明<a class="hash-link" href="#lerna项目发布问题说明" title="Direct link to heading">​</a></h3><p>在发布之前，确保已经初始化了git仓库</p><ol><li><p><code>lerna version</code>
<em><code>leran version</code> bump 版本号后，会提交到远程仓库，并在远程上产生一个tag。<code>leran version</code> 成功之后，是不能<code>lerna publish</code> 发布成功的，会说没有修改</em></p></li><li><p><code>lerna publish</code></p><ul><li><p>如果要发布，不要先使用<code>lerna version</code> 。提交完之后，直接使用<code>lerna publish</code> 第一步就会 bump 版本号。</p></li><li><p><strong>删除多余或者调试产生的tag的方法</strong>，大胆调试发布流程</p><ul><li>先在远程上删除tag </li><li>在本地仓库根目录中，找到文件夹<code>./git/refs/tags</code> 中删除之前在远程上删除的tag</li><li>接下来，就可以手动修改<code>lerna.josn</code>中的version，使用一个没有发不过的较低的版本号 <code>lerna publish</code> 了</li></ul></li><li><p>使用 group 发布的包，默认情况都是私有的，publish不了。需要在 <code>package.json</code> 中追加配置</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;publishConfig&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;access&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;public&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><code>lerna publish</code> 成功之后的日志</p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/publishSucc.png" class="img_E7b_"></p></li></ul></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="lerna-源码阅读">lerna 源码阅读<a class="hash-link" href="#lerna-源码阅读" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="准备源码">准备源码<a class="hash-link" href="#准备源码" title="Direct link to heading">​</a></h3><p>准备工作</p><ul><li>下载源码</li><li>安装依赖</li><li>IDE打开</li></ul><p>准备完成的标准</p><ul><li>找到入口文档</li><li>能够本地调试</li></ul><p>学习目标</p><ul><li>lerna 源码结构和执行流程</li><li><code>import-local</code> </li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="源码学到的知识点">源码学到的知识点<a class="hash-link" href="#源码学到的知识点" title="Direct link to heading">​</a></h3><ul><li><p><code>require(&#x27;.&#x27;)</code> === <code>require(&#x27;./&#x27;)</code></p></li><li><p><code>npm</code> <code>file:</code> 接相对路径的处理</p><p><code>commands/publish/index.js</code> <code>resolveLocalDependencyLinks()</code> 将本地连接解析成线上连接。</p><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/resolveLocalDependencyLinks.jpg" class="img_E7b_"></p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="yargs-用法">yargs 用法<a class="hash-link" href="#yargs-用法" title="Direct link to heading">​</a></h3><p>yargs 可以用来帮助构建交互式命令行工具，解析参数、生成优雅的用户界面。</p><p><strong>基本使用：</strong></p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token hashbang comment" style="color:#999988;font-style:italic">#!/usr/bin/env node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> yargs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;yargs/yargs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> hideBin </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;yargs/yargs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 用作参数解析</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> arg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hideBin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">argv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 获得参数列表(Array)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">yargs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">argv</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>Api解读</strong></p><ul><li><p><code>yargs(arg).strict()</code> 在输入的命令找不到时，报错。默认会输出 <code>--help</code> 的内容及默认报错</p></li><li><p><code>yargs(arg).usage(msg)</code> 展示命令的用法。可以理解成，输出msg</p><ul><li><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yargs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">usage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Usage: $0 &lt;command&gt; [option]&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><code>$0</code> 指向的是 <code>command</code> 。如本地开发一个 <code>yargs-test</code> 命令行工具，输入 <code>yargs-test ls</code></p><p><code>argv:  { _: [ &#x27;ls&#x27; ], cliVersion: &#x27;1.0.0&#x27;, &#x27;$0&#x27;: &#x27;yargs-test&#x27; }</code></p></li></ul></li><li><p><code>yargs(arg).demandCommand(1, &#x27;最少需要一个命令&#x27;)</code> 表示最少需要几个命令，不需要有 <code>.strict()</code> 的调用</p></li><li><p><code>yargs(arg).recommendCommands()</code> 直接调用，输入错误时，提示最近似的命令</p></li><li><p><code>yargs(arg).alias(&#x27;h&#x27;, &#x27;help&#x27;)</code> 为命令设置别名，为 <code>--help</code> 使用别名 <code>-h</code> </p></li><li><p><code>yargs.wrap(yargs(arg).terminalWidth())</code> 设置脚手架输出的命令行宽度。<code>yargs(arg).terminalWidth()</code> 表示终端的宽度。整体表示占满整行</p></li><li><p><code>yargs(arg).epilogue(&#x27;msg&#x27;)</code> 在结尾输出信息</p><ul><li><p><code>dedent</code> npm 包去掉行缩进或者行首空格，不会去掉空行。使用方式：</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">dedent</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"> 111</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">111</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">dedent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">111</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">111</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li></ul></li><li><p><code>yargs(arg).options(obj)</code> 增加一个全局选项，所有 <code>command</code> 都能访问。添加一个 <code>--debug</code> option</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yargs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">options</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">debug</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;boolean&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">describe</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Bootstrap debug mode&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>更多命令可以从参考 <a href="https://github.com/yargs/yargs/blob/HEAD/docs/api.md#optionskey-opt" target="_blank" rel="noopener noreferrer"><code>yargs github</code></a></p></li><li><p><code>yargs(arg).option(&#x27;opt&#x27;, obj)</code> 和 <code>yargs(arg).options(obj)</code> 作用一样，只不过一次只能添加一个全局命令</p></li><li><p><code>yargs(arg).group(Array, str)</code> 为命令分组，在 <code>--help</code> 显示时，分组显示命令。参数是一个 <code>option</code> 数组，第二个参数是分组名</p></li><li><p><code>yargs(arg).command(cmd, desc, [builder], [handler])</code> 注册命令，<code>lerna --option</code> 中的 <code>--option</code>，这个方法很重要</p><ul><li><code>cmd</code> 是 <code>command</code> 的格式 </li><li><code>desc</code> 是 <code>cmd</code> 的描述</li><li><code>builder</code> 函数，在执行命令之前执行</li><li><code>handler</code> 函数，<code>command</code> 的行为</li></ul><p><a href="https://www.npmjs.com/package/yargs" target="_blank" rel="noopener noreferrer"><code>npm</code></a> 上的例子</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token hashbang comment" style="color:#999988;font-style:italic">#!/usr/bin/env node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> yargs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;yargs/yargs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> hideBin </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;yargs/helpers&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">yargs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">hideBin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">argv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;serve [port]&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;start the server&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">yargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yargs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">positional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;port&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">describe</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;port to bind on&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">argv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">verbose</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">start server on :</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">argv</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">port</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">serve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">option</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;verbose&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">alias</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;v&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;boolean&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">description</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Run with verbose logging&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">argv</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>  <code>.positional()</code> 为 <code>command</code> 定义参数，和 <code>.option()</code> 类似，但只在 <code>builder</code> 函数中的 <code>yargs</code> 实例上存在。</p><ul><li><p><code>lerna</code> 中  <code>command</code> 的对象传参</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yargs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">commamd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  command</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  alias</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  describe</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  builder</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><a href="https://github.com/yargs/yargs/blob/HEAD/docs/api.md#commandcmd-desc-builder-handler" target="_blank" rel="noopener noreferrer">更多</a></p></li></ul></li><li><p><code>yargs(arg).fail(err, msg)</code> 处理在命令执行失败时的操作，需要先调用 <code>.strict()</code></p></li><li><p><code>yargs().parse(argv, obj)</code> 参数解析。<code>argv</code> 是 <code>process.argv.slice(2)</code>，<strong>和直接传入个 <code>yargs()</code> 的<code>argv</code> 不同—<code>hideBin(process.argv)</code></strong>， 命令行输入的 <code>command</code> 后面的 <code>option</code> ，该方法会将 <code>argv</code> 和 <code>obj</code> 进行合并，可以向 <code>argv</code> 中注入参数</p><ul><li><p>这里有个地方要注意</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">otherVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> pak</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">yargs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><code>context</code> 中的版本号 <code>key</code> 不要用 <code>version</code>，否则输入命令是，将始终执行 <code>--version</code>。总之，就是<strong>不要使用跟命令重复的 <code>key</code></strong></p></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="lerna-命令的执行流程">lerna 命令的执行流程<a class="hash-link" href="#lerna-命令的执行流程" title="Direct link to heading">​</a></h3><p>执行 <code>lerna ls</code> ：</p><ul><li>入口文件 <code>core/lerna/cli.js</code> 获取命令号 <code>option</code> <code>argv = process.argv.slice(2)</code> </li><li>调用 <code>core/lerna/index.js</code> <code>mian(argv)</code> 方法</li><li>在 <code>mian(argv)</code> 方法，根据 <code>option</code> <code>ls</code> 执行对应的<code>.command() </code>：<code>commands/list/commond.js</code></li><li>执行 <code>.command() </code> 中的 <code>handler</code> ：<code>commands/list/index.js</code> <code>factory(argv)</code><ul><li>知识点<ul><li>深拷贝，使用 <code>npm</code> 包 <code>clone-deep</code></li><li><code>this.constructor.name</code></li><li><code>runner</code> </li><li><code>Promise.then</code> 微任务执行栈</li><li><code>Promise.resolve</code> 方法允许调用时不带参数，直接返回一个<code>resolved</code> 状态的 <code>Promise</code> 对象。</li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="import-local">import-local<a class="hash-link" href="#import-local" title="Direct link to heading">​</a></h2><p>用途：当全局 <code>node_modules</code> 和 当前项目 <code>node_modules</code> 当中同时存在一个脚手架命令时，优先使用当前项目的脚手架。在 <code>lerna</code> 项目下，执行命令 <code>lerna ls</code>，会输出 <code>info cli using local version of lerna</code> </p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">jolly@JollydeMacBook-Pro lerna % lerna </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">info cli using </span><span class="token builtin class-name">local</span><span class="token plain"> version of lerna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lerna notice cli v3.22.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@lerna/add</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@lerna/bootstrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@lerna/changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@lerna/clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@lerna/create</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> localFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resolveCwd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">silent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pkg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> relativePath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><strong>上面这句话，是 <code>import-local</code> 中的核心</strong>，作用是查看当前项目中有没有对应的 <code>npm</code> 包</p><p><code>path.relative(localFile, filename)</code> 找到和本地文件 <code>localFile</code> 同名的全局的文件的路径。</p><p><strong>细节</strong></p><p>全局加载执行本地 <code>cli.js</code> 和执行后续 <code>lerna</code> 流程，都是在全局 <code>cli.js</code> 中  <code>require(&quot;npmlog&quot;).info(&quot;cli&quot;, &quot;using local version of lerna&quot;);</code> 代码之前，但 <code>info cli using local version of lerna</code> 会先打印，是因为 <code>command</code> 方法的 <code>handler</code> 中，代码执行都是通过 <code>Promise.resolve().then()</code> 添加到微任务中的，所以会在宏任务 `<code>require(&quot;npmlog&quot;).info()</code> 执行之后执行。</p><p><strong>基础知识点</strong></p><ul><li><code>__filename</code>：当前模块(js)的文件名。 这是当前的模块文件的绝对路径（符号链接会被解析）</li><li>运行 <code>node</code> 代码时，默认会注入 <code>module</code> <code>require</code> <code>__filename</code>  <code>__dirname</code> <code>exports</code> 五个变量</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="优秀的文件操作库">优秀的文件操作库<a class="hash-link" href="#优秀的文件操作库" title="Direct link to heading">​</a></h3><p><strong><code>pkg-dir</code> </strong></p><p>找到 <code>npm</code> 或者 <code>node.js</code> 项目的根目录</p><p><strong><code>findup</code> </strong></p><p>通过遍历父级目录查账文件或文件夹</p><p><strong><code>locate-path</code> </strong></p><p>从多个文件中获取第一个存在的路径</p><p><strong><code>path-exists</code></strong></p><p>检查路径是否存在</p><p><strong><code>resolve-cwd</code> </strong></p><p>从当前工作目录，像 <code>require.resolve</code> 一样解析模块路径 </p><p><strong><code>resolve-from</code> </strong></p><p>从给定路径，像 <code>require.resolve</code> 一样解析模块路径 </p><p><strong>涉及到的 <code>node.js</code> 方法</strong></p><ul><li><p><code>process.cwd()</code></p><p>返回 Node.js 进程的当前工作目录(working directory)。</p></li><li><p>path.dirname()</p></li><li><p><code>path.resolve()</code> 相对路径转换成真实路径</p></li><li><p>path.parse()</p></li><li><p><code>fs.accessSync(filepath)</code></p><p>判断文件是否存在（能访问到），不存在会抛出异常</p></li><li><p>path.relative()</p></li><li><p>path.join()</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="nodejs-模块路径解析流程"><code>Node.js</code> 模块路径解析流程<a class="hash-link" href="#nodejs-模块路径解析流程" title="Direct link to heading">​</a></h3><ul><li><p><code>Node.js</code> 项目模块路径解析是通过 <code>require.resolve</code>  方法来实现的</p></li><li><p><code>require.resolve</code>  就是通过 <code>Module._resolveFileName</code> 方法实现的</p><ul><li><p><code>Module._resolveFileName</code>  方法核心流程有 3 点： </p><ul><li><p>判断是否为内置模块</p><p><code>NativeModule.canBeRequireByUsers()</code> 判断是否是可以被加载的内置模块</p></li><li><p>通过 <code>Module._resolveLookupPaths</code>  方法生成 <code>node_modules</code> 可能存在的路径</p><ul><li>如果路径为 <code>/</code>（根目录），直接返回 <code>[&#x27;/node_modules&#x27;]</code> </li><li>否则，将路径字符串从后往前遍历，查询到 <code>/</code>  时，拆分路径，在后面加上 <code>node_modules</code>，并传入一个 <code>paths</code> 数组，直至查询不到 </li></ul></li><li><p>通过 <code>zModule._findPath</code>   查询模块的真实路径</p></li></ul></li><li><p><code>Module._findPath</code>  核心流程有 4 点：</p><ul><li>查询缓存（将 <code>request</code> 和 <code>paths</code> 通过 <code>\x00</code> 合并成 <code>cacheKey</code>）</li><li>遍历 <code>paths</code>，将 <code>path</code> 与 <code>request</code> 组成文件路径 <code>basePath</code></li><li>如果 basePath 存在则调用 <code>fs.realPathSync</code> 获取文件真实路径</li><li>将文件真实路径缓存到 <code>Module._pathCache</code>（key 就是前面生成的 cacheKey）</li></ul></li><li><p><code>fs.realPathSync</code> 核心流程有 3 点：</p><ul><li>查询缓存（缓存的 key 为 p，即 <code>Module._findPath</code> 中生成的文件路径）</li><li>从左往右遍历路径字符串，查询到 <code>/</code>时，拆分路径，判断该路径是否为软链接，如果是软链接则查询真实链接，并生成新路_径 p，然后继续往后遍历，这里有 1 个细节需要特别注意：</li><li>遍历过程中生成的子路径 base 会缓存在 knownHard 和 cache 中，避免重复查询</li><li>遍历完成得到模块对应的真实路径，此时会将原始路径 original 作为 key，真实路径作为 value，保存到缓存中</li></ul></li></ul></li><li><p><code>require.resolve.paths</code>  等价于 <code>Module._resolveLookupPaths</code> ，该方法用于获取所有 <code>node_modules</code> 可能存在的路径</p></li></ul><p><img loading="lazy" src="http://imooc-lego-homework.oss-cn-hangzhou.aliyuncs.com/docs/pages/jolly_chen/images/node_Module.png" class="img_E7b_"></p><p>图中知识点列表：</p><ul><li><p>通过 <code>require</code> 加载模块以后，会向 <code>Module._pathCache</code> 对象中添加该模块的路径，key：模块名称加 <code>\x00</code> 路径，value：实际路径</p></li><li><p><code>stat(path)</code> ：查看文件状态。-2 不存在， 0 文件，1 文件夹</p></li><li><p><code>realPathCache</code> 是一个 <code>Map</code> 对象</p></li><li><p><code>linux</code> <code>stat</code> 命令打印文件相关信息 <code>dev_t</code> 设备编号、<code>ino_t</code> 文件的唯一标识</p></li><li><p><code>fs.realPathSync</code> 在拿到软连接指向的真实路径后，还会在遍历，查看指向的路径是否还是一个软连接</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="正则表达式">正则表达式<a class="hash-link" href="#正则表达式" title="Direct link to heading">​</a></h3><p><code>Modules._findPath()</code> 中的正则 <code>/(?:^|\/)\.?\$/</code> 匹配 ..、/..。包含知识点</p><ul><li><code>?</code> 匹配0到1个</li><li><code>(?:)</code> 表示非匹配分组，作用是不保存括号中匹配的内容</li><li><code>/^/</code>  匹配的是个空字符串&#x27;&#x27;，任意字符都能匹配成功，任意字符中都有空字符串</li><li><code>/[^]/</code> 表示非</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="简历和总结">简历和总结<a class="hash-link" href="#简历和总结" title="Direct link to heading">​</a></h2><p><strong>简历要有“简历简介”</strong></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="面试官询问细节的回答">面试官询问细节的回答<a class="hash-link" href="#面试官询问细节的回答" title="Direct link to heading">​</a></h3><p><strong> yargs 开发脚手架</strong></p><ol><li>阐述脚手架命令构成<ol><li><code>command</code>：命令 vue</li><li><code>option</code> 及 <code>param</code></li><li>js 文件顶部</li></ol></li><li>阐述脚手架初始化流程<ol><li><code>package.json</code> 中配置 <code>bin</code> 属性，<code>npm link</code> 本地安装，生成脚手架命令行</li><li><code>#! /usr/bin/env node</code></li><li><code>yargs()</code></li><li>介绍一下常用方法</li></ol></li><li>脚手架参数的解析<ol><li><code>hideBin(process.argv) / Yargs.argv</code></li><li><code>Yargs.parse(argv, options)</code></li></ol></li><li>命令的注册 <ol><li><code>Yargs.command(command, describe, builder, handler)</code></li><li><code>Yargs.command({ command, describe, builder, handler })</code></li></ol></li></ol><p><strong>lerna</strong></p><ul><li>Lerna 是基于 git+npm 的多<code>package</code> 项目管理工具</li><li>实现原理 <ul><li>通过 <code>import-local</code> 优先调用本地 lerna 命令</li><li>通过 <code>Yargs</code> 生成脚手架，先注册全局属性，再注册命令，最后通过 <code>parse</code> 方法解析参数</li><li><code>lerna</code> 命令注册时需要传入 <code>builder</code> 和 <code>handler</code> 两个方法，<code>builder</code> 方法用于注册命令专属的 <code>options</code>，<code>handler</code> 用来处理命令的业务逻辑</li><li><code>lerna</code> 通过配置 <code>npm</code> 本地依赖的方式来进行本地开发，具体写法是在 <code>package.json</code> 的依赖中写入：<code>file:your-local-module-path</code> ，在 <code>lerna publish</code> 时会自动将该路径替换</li></ul></li></ul><p><strong><code>Node.js</code> 模块路径解析流程</strong></p><p>见上</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Guing/FED-DOC/docs/19-体系/慕课网前端架构师/1-脚手架/2周 脚手架架构设计和框架搭建/101-其他人的笔记.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/2周 脚手架架构设计和框架搭建/总结"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">总结</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/FED-DOC/docs/体系/慕课网前端架构师/脚手架/30周 脚手架发布模块云构建系统开发/WebSocket 快速入门"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">WebSocket 快速入门</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#站在前端研发视角分析开发脚手架的必要性" class="table-of-contents__link toc-highlight">站在前端研发视角，分析开发脚手架的必要性</a><ul><li><a href="#开发过程的共有操作" class="table-of-contents__link toc-highlight">开发过程的共有操作</a></li><li><a href="#脚手架的核心价值" class="table-of-contents__link toc-highlight">脚手架的核心价值</a></li><li><a href="#和自动化工具的区别" class="table-of-contents__link toc-highlight">和自动化工具的区别</a></li></ul></li><li><a href="#从使用的角度理解什么是脚手架" class="table-of-contents__link toc-highlight">从使用的角度理解什么是脚手架</a><ul><li><a href="#脚手架简介" class="table-of-contents__link toc-highlight">脚手架简介</a></li><li><a href="#脚手架执行原理" class="table-of-contents__link toc-highlight">脚手架执行原理</a></li><li><a href="#开发脚手架的步骤" class="table-of-contents__link toc-highlight">开发脚手架的步骤</a></li><li><a href="#需要解决的问题" class="table-of-contents__link toc-highlight">需要解决的问题</a></li></ul></li><li><a href="#脚手架原理进阶" class="table-of-contents__link toc-highlight">脚手架原理进阶</a></li><li><a href="#脚手架的开发流程" class="table-of-contents__link toc-highlight">脚手架的开发流程</a><ul><li><a href="#开发流程" class="table-of-contents__link toc-highlight">开发流程</a></li><li><a href="#安装使用" class="table-of-contents__link toc-highlight">安装使用</a></li></ul></li><li><a href="#脚手架开发难点" class="table-of-contents__link toc-highlight">脚手架开发难点</a><ul><li><a href="#脚手架本地调试" class="table-of-contents__link toc-highlight">脚手架本地调试</a></li><li><a href="#npm-link--npm-unlink" class="table-of-contents__link toc-highlight">npm link &amp; npm unlink</a></li></ul></li><li><a href="#脚手架命令注册和参数解析" class="table-of-contents__link toc-highlight">脚手架命令注册和参数解析</a></li><li><a href="#使用lerna进行脚手架开发" class="table-of-contents__link toc-highlight">使用lerna进行脚手架开发</a><ul><li><a href="#lerna解决的问题" class="table-of-contents__link toc-highlight">lerna解决的问题</a></li><li><a href="#lerna与架构" class="table-of-contents__link toc-highlight">lerna与架构</a></li><li><a href="#lerna-开发脚手架流程" class="table-of-contents__link toc-highlight">lerna 开发脚手架流程</a></li><li><a href="#创建-npm-organazition" class="table-of-contents__link toc-highlight">创建 npm Organazition</a></li><li><a href="#创建-lerna-repo" class="table-of-contents__link toc-highlight">创建 lerna repo</a></li><li><a href="#lerna-命令解释" class="table-of-contents__link toc-highlight">lerna 命令解释</a></li><li><a href="#lerna项目发布问题说明" class="table-of-contents__link toc-highlight">lerna项目发布问题说明</a></li></ul></li><li><a href="#lerna-源码阅读" class="table-of-contents__link toc-highlight">lerna 源码阅读</a><ul><li><a href="#准备源码" class="table-of-contents__link toc-highlight">准备源码</a></li><li><a href="#源码学到的知识点" class="table-of-contents__link toc-highlight">源码学到的知识点</a></li><li><a href="#yargs-用法" class="table-of-contents__link toc-highlight">yargs 用法</a></li><li><a href="#lerna-命令的执行流程" class="table-of-contents__link toc-highlight">lerna 命令的执行流程</a></li></ul></li><li><a href="#import-local" class="table-of-contents__link toc-highlight">import-local</a><ul><li><a href="#优秀的文件操作库" class="table-of-contents__link toc-highlight">优秀的文件操作库</a></li><li><a href="#nodejs-模块路径解析流程" class="table-of-contents__link toc-highlight"><code>Node.js</code> 模块路径解析流程</a></li><li><a href="#正则表达式" class="table-of-contents__link toc-highlight">正则表达式</a></li></ul></li><li><a href="#简历和总结" class="table-of-contents__link toc-highlight">简历和总结</a><ul><li><a href="#面试官询问细节的回答" class="table-of-contents__link toc-highlight">面试官询问细节的回答</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">笔记</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/FED-DOC/docs/intro">前端</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Guing" target="_blank" rel="noopener noreferrer" class="footer__link-item">关于我<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/FED-DOC/blog">博客</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 FED-DOCS, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/FED-DOC/assets/js/runtime~main.d2e3a023.js"></script>
<script src="/FED-DOC/assets/js/main.0b039734.js"></script>
</body>
</html>